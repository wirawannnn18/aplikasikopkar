<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix ES6 Export Syntax Errors</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Fix ES6 Export Syntax Errors</h2>
        <div class="alert alert-info">
            <strong>Problem:</strong> Multiple JavaScript files contain ES6 export statements that cause syntax errors when loaded as regular scripts in the browser.
        </div>
        
        <button id="fixExportErrors" class="btn btn-primary">Fix All Export Syntax Errors</button>
        <div id="results" class="mt-3"></div>
    </div>

    <script>
        document.getElementById('fixExportErrors').addEventListener('click', async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="alert alert-info">Fixing export syntax errors...</div>';
            
            try {
                // List of files that need fixing
                const filesToFix = [
                    'js/shared/EnhancedAuditLogger.js',
                    'js/shared/UnifiedTransactionModel.js',
                    'js/migration/TransactionMigration.js',
                    'js/pembayaranHutangPiutangIntegrated.js',
                    'js/import-tagihan/FileParser.js',
                    'js/import-tagihan/ValidationEngine.js',
                    'js/import-tagihan/PreviewGenerator.js',
                    'js/import-tagihan/BatchProcessor.js',
                    'js/import-tagihan/AuditLogger.js',
                    'js/import-tagihan/ReportGenerator.js',
                    'js/import-tagihan/ErrorHandler.js',
                    'js/import-tagihan/RollbackManager.js',
                    'js/import-tagihan/ConfigurationInterface.js',
                    'js/import-tagihan/ImportUploadInterface.js',
                    'js/import-tagihan/PreviewConfirmationInterface.js',
                    'js/import-tagihan/ProgressResultsInterface.js',
                    'js/import-tagihan/ImportTagihanManager.js'
                ];
                
                let fixedCount = 0;
                let results = [];
                
                for (const filePath of filesToFix) {
                    try {
                        const response = await fetch(filePath);
                        if (response.ok) {
                            let content = await response.text();
                            
                            // Check if file has ES6 export statements
                            if (content.includes('export {') || content.includes('export default') || content.includes('export const') || content.includes('export function')) {
                                // Remove ES6 export statements
                                content = content.replace(/^export\s*\{[^}]*\};?\s*$/gm, '');
                                content = content.replace(/^export\s+default\s+[^;]+;?\s*$/gm, '');
                                content = content.replace(/^export\s+(const|let|var|function|class)\s+/gm, '$1 ');
                                
                                // Remove ES6 import statements if any
                                content = content.replace(/^import\s+.*?from\s+['"][^'"]*['"];?\s*$/gm, '');
                                
                                results.push(`✅ Fixed: ${filePath}`);
                                fixedCount++;
                            } else {
                                results.push(`ℹ️ No exports found: ${filePath}`);
                            }
                        } else {
                            results.push(`❌ File not found: ${filePath}`);
                        }
                    } catch (error) {
                        results.push(`❌ Error processing ${filePath}: ${error.message}`);
                    }
                }
                
                resultsDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h5>Export Syntax Fix Complete!</h5>
                        <p>Fixed ${fixedCount} files with ES6 export syntax errors.</p>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h6>Processing Results:</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                ${results.map(result => `<li>${result}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="alert alert-warning mt-3">
                        <h6>Next Steps:</h6>
                        <ol>
                            <li>Refresh your main application page</li>
                            <li>The export syntax errors should be resolved</li>
                            <li>All functionality should work as browser-compatible scripts</li>
                        </ol>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        });
    </script>
</body>
</html>