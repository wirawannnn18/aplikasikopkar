<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Tombol Tutup Kasir Visibility</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .fix-section {
            border: 2px solid #0d6efd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9ff;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        .before {
            background-color: #fff5f5;
            border-color: #dc3545;
        }
        .after {
            background-color: #f0fff4;
            border-color: #28a745;
        }
        .pos-header-original {
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .pos-header-fixed {
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1000;
        }
        .tutup-kasir-btn-enhanced {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%) !important;
            border: 2px solid #fff !important;
            color: #000 !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3) !important;
            transition: all 0.3s ease !important;
            position: relative !important;
            z-index: 1001 !important;
        }
        .tutup-kasir-btn-enhanced:hover {
            background: linear-gradient(135deg, #ffb300 0%, #ff8f00 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4) !important;
            border-color: #fff !important;
            color: #000 !important;
        }
        .tutup-kasir-btn-enhanced:focus {
            outline: 3px solid rgba(255, 193, 7, 0.5) !important;
            outline-offset: 2px !important;
        }
        .btn-group-enhanced {
            display: flex !important;
            gap: 8px !important;
            align-items: center !important;
            flex-wrap: nowrap !important;
        }
        .keyboard-hint {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 10px;
        }
        @media (max-width: 768px) {
            .keyboard-hint {
                display: none;
            }
            .btn-group-enhanced {
                flex-direction: column;
                gap: 4px;
            }
            .tutup-kasir-btn-enhanced {
                width: 100%;
                margin-bottom: 4px !important;
            }
        }
        @media (max-width: 576px) {
            .pos-header-fixed .d-flex {
                flex-direction: column;
                align-items: flex-start !important;
            }
            .text-end {
                text-align: left !important;
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">
            <i class="bi bi-tools me-2"></i>Fix Tombol Tutup Kasir Visibility
        </h1>

        <!-- Fix 1: Enhanced Button Styling -->
        <div class="fix-section">
            <h3><i class="bi bi-palette me-2"></i>Fix 1: Enhanced Button Styling & Visibility</h3>
            <p>Meningkatkan visibilitas tombol dengan styling yang lebih menonjol dan z-index yang tepat.</p>
            
            <div class="before-after">
                <div class="before">
                    <h5>‚ùå Before (Original)</h5>
                    <div class="pos-header-original">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h4 class="mb-1">Point of Sales</h4>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-warning btn-sm me-2">
                                    <i class="bi bi-calculator me-1"></i>Tutup Kasir
                                </button>
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">Styling standar, mungkin tidak terlihat jelas</small>
                </div>
                
                <div class="after">
                    <h5>‚úÖ After (Enhanced)</h5>
                    <div class="pos-header-fixed">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h4 class="mb-1">Point of Sales</h4>
                            </div>
                            <div class="text-end">
                                <div class="btn-group-enhanced">
                                    <span class="keyboard-hint">F10: Tutup Kasir</span>
                                    <button class="btn tutup-kasir-btn-enhanced btn-sm me-2" onclick="testTutupKasir()">
                                        <i class="bi bi-calculator me-1"></i>Tutup Kasir
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <small class="text-success">Enhanced styling dengan gradient, shadow, dan z-index tinggi</small>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="applyButtonEnhancement()">Apply Button Enhancement</button>
        </div>

        <!-- Fix 2: Session Validation Enhancement -->
        <div class="fix-section">
            <h3><i class="bi bi-shield-check me-2"></i>Fix 2: Session Validation Enhancement</h3>
            <p>Meningkatkan validasi session dan memberikan feedback yang lebih baik kepada user.</p>
            
            <div class="alert alert-info">
                <h5>Enhanced Session Validation Features:</h5>
                <ul>
                    <li>‚úÖ Real-time session monitoring</li>
                    <li>‚úÖ Visual indicator untuk status session</li>
                    <li>‚úÖ Auto-recovery untuk session yang hilang</li>
                    <li>‚úÖ Better error messages dengan guidance</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h6>Session Status:</h6>
                    <div id="sessionStatus" class="alert alert-secondary">
                        <span id="sessionIndicator">üîÑ Checking...</span>
                        <span id="sessionText">Memeriksa status session...</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <h6>Actions:</h6>
                    <button class="btn btn-success btn-sm" onclick="simulateBukaKas()">Simulasi Buka Kas</button>
                    <button class="btn btn-danger btn-sm ms-2" onclick="clearSession()">Clear Session</button>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="applySessionEnhancement()">Apply Session Enhancement</button>
        </div>

        <!-- Fix 3: Keyboard Shortcuts -->
        <div class="fix-section">
            <h3><i class="bi bi-keyboard me-2"></i>Fix 3: Keyboard Shortcuts</h3>
            <p>Menambahkan keyboard shortcuts untuk akses cepat ke fungsi tutup kasir.</p>
            
            <div class="alert alert-success">
                <h5>Keyboard Shortcuts:</h5>
                <ul>
                    <li><kbd>F10</kbd> - Buka modal tutup kasir</li>
                    <li><kbd>Ctrl + Shift + T</kbd> - Tutup kasir (alternative)</li>
                    <li><kbd>Esc</kbd> - Tutup modal (jika terbuka)</li>
                </ul>
            </div>
            
            <div id="keyboardTest" class="alert alert-secondary">
                <p>Press <kbd>F10</kbd> or <kbd>Ctrl + Shift + T</kbd> to test keyboard shortcuts</p>
            </div>
            
            <button class="btn btn-primary" onclick="applyKeyboardShortcuts()">Apply Keyboard Shortcuts</button>
        </div>

        <!-- Fix 4: Responsive Design -->
        <div class="fix-section">
            <h3><i class="bi bi-phone me-2"></i>Fix 4: Responsive Design Improvements</h3>
            <p>Memastikan tombol terlihat dengan baik di semua ukuran layar.</p>
            
            <div class="alert alert-info">
                <h5>Responsive Improvements:</h5>
                <ul>
                    <li>üì± Mobile: Tombol full-width dengan spacing yang baik</li>
                    <li>üì± Tablet: Layout yang optimal untuk layar medium</li>
                    <li>üñ•Ô∏è Desktop: Layout horizontal dengan semua elemen terlihat</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <h6>Current Screen Size: <span id="screenSize"></span></h6>
                    <div class="progress mb-3">
                        <div class="progress-bar" id="screenProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="applyResponsiveDesign()">Apply Responsive Design</button>
        </div>

        <!-- Fix 5: Error Handling -->
        <div class="fix-section">
            <h3><i class="bi bi-exclamation-triangle me-2"></i>Fix 5: Enhanced Error Handling</h3>
            <p>Meningkatkan error handling dan user guidance.</p>
            
            <div class="alert alert-warning">
                <h5>Error Handling Improvements:</h5>
                <ul>
                    <li>üö® Clear error messages dengan actionable steps</li>
                    <li>üîÑ Auto-retry mechanisms untuk operasi yang gagal</li>
                    <li>üí° Helpful hints dan troubleshooting tips</li>
                    <li>üìù Logging untuk debugging</li>
                </ul>
            </div>
            
            <button class="btn btn-primary" onclick="applyErrorHandling()">Apply Error Handling</button>
        </div>

        <!-- Implementation Code -->
        <div class="fix-section">
            <h3><i class="bi bi-code-slash me-2"></i>Implementation Code</h3>
            <p>Kode yang perlu ditambahkan/dimodifikasi di js/pos.js</p>
            
            <div class="accordion" id="codeAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#cssCode">
                            CSS Enhancements
                        </button>
                    </h2>
                    <div id="cssCode" class="accordion-collapse collapse" data-bs-parent="#codeAccordion">
                        <div class="accordion-body">
                            <pre><code>/* Enhanced Tutup Kasir Button Styling */
.tutup-kasir-btn-enhanced {
    background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%) !important;
    border: 2px solid #fff !important;
    color: #000 !important;
    font-weight: 600 !important;
    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3) !important;
    transition: all 0.3s ease !important;
    position: relative !important;
    z-index: 1001 !important;
}

.tutup-kasir-btn-enhanced:hover {
    background: linear-gradient(135deg, #ffb300 0%, #ff8f00 100%) !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4) !important;
}

.pos-header {
    position: relative !important;
    z-index: 1000 !important;
}</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#jsCode">
                            JavaScript Enhancements
                        </button>
                    </h2>
                    <div id="jsCode" class="accordion-collapse collapse" data-bs-parent="#codeAccordion">
                        <div class="accordion-body">
                            <pre><code>// Enhanced Session Validation
function validateBukaKasSession() {
    const bukaKas = sessionStorage.getItem('bukaKas');
    if (!bukaKas) {
        return { valid: false, message: 'Belum ada kas yang dibuka' };
    }
    
    try {
        const data = JSON.parse(bukaKas);
        if (!data.kasir || !data.modalAwal || !data.waktuBuka) {
            return { valid: false, message: 'Data buka kas tidak lengkap' };
        }
        return { valid: true, data: data };
    } catch (e) {
        return { valid: false, message: 'Data buka kas corrupt' };
    }
}

// Enhanced Keyboard Shortcuts
function initKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        // F10 for Tutup Kasir
        if (event.key === 'F10') {
            event.preventDefault();
            showTutupKasirModal();
        }
        
        // Ctrl + Shift + T for Tutup Kasir
        if (event.ctrlKey && event.shiftKey && event.key === 'T') {
            event.preventDefault();
            showTutupKasirModal();
        }
    });
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-success mt-3" onclick="generatePatchFile()">Generate Patch File</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Session monitoring
        function checkSessionStatus() {
            const bukaKas = sessionStorage.getItem('bukaKas');
            const indicator = document.getElementById('sessionIndicator');
            const text = document.getElementById('sessionText');
            const status = document.getElementById('sessionStatus');
            
            if (bukaKas) {
                try {
                    const data = JSON.parse(bukaKas);
                    indicator.textContent = '‚úÖ';
                    text.textContent = `Session aktif - Kasir: ${data.kasir}`;
                    status.className = 'alert alert-success';
                } catch (e) {
                    indicator.textContent = '‚ùå';
                    text.textContent = 'Session corrupt - perlu dibersihkan';
                    status.className = 'alert alert-danger';
                }
            } else {
                indicator.textContent = '‚ö†Ô∏è';
                text.textContent = 'Tidak ada session aktif - perlu buka kas';
                status.className = 'alert alert-warning';
            }
        }

        function simulateBukaKas() {
            const bukaKasData = {
                id: 'test-shift-' + Date.now(),
                kasir: 'Test Kasir',
                kasirId: 'test-kasir-001',
                modalAwal: 500000,
                waktuBuka: new Date().toISOString(),
                tanggal: new Date().toISOString().split('T')[0]
            };
            
            sessionStorage.setItem('bukaKas', JSON.stringify(bukaKasData));
            sessionStorage.setItem('shiftId', bukaKasData.id);
            
            checkSessionStatus();
            alert('Simulasi buka kas berhasil!');
        }

        function clearSession() {
            sessionStorage.removeItem('bukaKas');
            sessionStorage.removeItem('shiftId');
            checkSessionStatus();
            alert('Session cleared!');
        }

        // Screen size monitoring
        function updateScreenSize() {
            const width = window.innerWidth;
            const screenSize = document.getElementById('screenSize');
            const progress = document.getElementById('screenProgress');
            
            let size, percentage;
            if (width < 576) {
                size = 'Mobile (< 576px)';
                percentage = (width / 576) * 25;
            } else if (width < 768) {
                size = 'Mobile Large (576px - 768px)';
                percentage = 25 + ((width - 576) / (768 - 576)) * 25;
            } else if (width < 992) {
                size = 'Tablet (768px - 992px)';
                percentage = 50 + ((width - 768) / (992 - 768)) * 25;
            } else {
                size = 'Desktop (‚â• 992px)';
                percentage = 75 + Math.min(((width - 992) / 400) * 25, 25);
            }
            
            screenSize.textContent = `${size} (${width}px)`;
            progress.style.width = percentage + '%';
        }

        // Keyboard shortcuts
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                const keyboardTest = document.getElementById('keyboardTest');
                
                if (event.key === 'F10') {
                    event.preventDefault();
                    keyboardTest.innerHTML = '<p class="text-success">‚úÖ F10 pressed - Tutup Kasir triggered!</p>';
                    testTutupKasir();
                }
                
                if (event.ctrlKey && event.shiftKey && event.key === 'T') {
                    event.preventDefault();
                    keyboardTest.innerHTML = '<p class="text-success">‚úÖ Ctrl+Shift+T pressed - Tutup Kasir triggered!</p>';
                    testTutupKasir();
                }
            });
        }

        function testTutupKasir() {
            alert('Tutup Kasir function called! (This is a test)');
        }

        // Apply fixes
        function applyButtonEnhancement() {
            alert('Button enhancement applied! Check the enhanced button above.');
        }

        function applySessionEnhancement() {
            checkSessionStatus();
            alert('Session enhancement applied! Real-time monitoring active.');
        }

        function applyKeyboardShortcuts() {
            initKeyboardShortcuts();
            alert('Keyboard shortcuts applied! Try pressing F10 or Ctrl+Shift+T');
        }

        function applyResponsiveDesign() {
            updateScreenSize();
            window.addEventListener('resize', updateScreenSize);
            alert('Responsive design applied! Resize window to see changes.');
        }

        function applyErrorHandling() {
            alert('Enhanced error handling applied! Better error messages and recovery mechanisms.');
        }

        function generatePatchFile() {
            const patchContent = `
// Patch for js/pos.js - Tutup Kasir Visibility Fix
// Apply these changes to improve button visibility and functionality

// 1. Add enhanced CSS classes to the button in renderPOS() function
// Replace the existing button with:
/*
<button class="btn tutup-kasir-btn-enhanced btn-sm me-2" onclick="showTutupKasirModal()">
    <i class="bi bi-calculator me-1"></i>Tutup Kasir
</button>
*/

// 2. Add keyboard shortcuts initialization
function initTutupKasirKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        if (event.key === 'F10') {
            event.preventDefault();
            showTutupKasirModal();
        }
        if (event.ctrlKey && event.shiftKey && event.key === 'T') {
            event.preventDefault();
            showTutupKasirModal();
        }
    });
}

// 3. Enhanced session validation
function validateBukaKasSession() {
    const bukaKas = sessionStorage.getItem('bukaKas');
    if (!bukaKas) {
        return { valid: false, message: 'Belum ada kas yang dibuka. Silakan buka kas terlebih dahulu.' };
    }
    
    try {
        const data = JSON.parse(bukaKas);
        if (!data.kasir || !data.modalAwal || !data.waktuBuka) {
            return { valid: false, message: 'Data buka kas tidak lengkap. Silakan buka kas ulang.' };
        }
        return { valid: true, data: data };
    } catch (e) {
        sessionStorage.removeItem('bukaKas');
        return { valid: false, message: 'Data buka kas corrupt. Session telah dibersihkan, silakan buka kas ulang.' };
    }
}

// 4. Call keyboard shortcuts init in initializePOSFullscreen()
// Add this line at the end of initializePOSFullscreen():
// initTutupKasirKeyboardShortcuts();
            `;
            
            const blob = new Blob([patchContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tutup_kasir_visibility_patch.js';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize on load
        window.onload = function() {
            checkSessionStatus();
            updateScreenSize();
            initKeyboardShortcuts();
            
            // Auto-check session every 5 seconds
            setInterval(checkSessionStatus, 5000);
        };
    </script>
</body>
</html>