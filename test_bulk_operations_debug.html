<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Bulk Operations - Task 8</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Debug Bulk Operations - Task 8</h2>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Bulk Operations Test</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults"></div>
                        
                        <div class="mt-3">
                            <button id="testBulkOperations" class="btn btn-primary">Test Bulk Operations</button>
                            <button id="clearStorage" class="btn btn-warning">Clear Storage</button>
                            <button id="initTestData" class="btn btn-success">Initialize Test Data</button>
                        </div>
                        
                        <div class="mt-4">
                            <h6>Test Data Table</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" id="selectAllCheckbox"></th>
                                            <th>Kode</th>
                                            <th>Nama</th>
                                            <th>Kategori</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="testDataTable">
                                        <!-- Test data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Bulk operations toolbar will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { BulkOperationsManager } from './js/master-barang/BulkOperationsManager.js';

        let bulkManager;
        
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const alertClass = type === 'error' ? 'alert-danger' : 
                              type === 'success' ? 'alert-success' : 'alert-info';
            results.innerHTML += `<div class="alert ${alertClass} alert-dismissible fade show">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`;
        }

        function clearStorage() {
            try {
                localStorage.removeItem('master_barang');
                localStorage.removeItem('kategori_barang');
                localStorage.removeItem('satuan_barang');
                log('Storage cleared successfully', 'success');
            } catch (error) {
                log(`Error clearing storage: ${error.message}`, 'error');
            }
        }

        function initTestData() {
            try {
                // Initialize test categories
                const kategoris = [
                    { id: 'kat-001', nama: 'Makanan', status: 'aktif' },
                    { id: 'kat-002', nama: 'Minuman', status: 'aktif' },
                    { id: 'kat-003', nama: 'Elektronik', status: 'aktif' }
                ];
                localStorage.setItem('kategori_barang', JSON.stringify(kategoris));

                // Initialize test units
                const satuans = [
                    { id: 'sat-001', nama: 'Pcs', status: 'aktif' },
                    { id: 'sat-002', nama: 'Box', status: 'aktif' },
                    { id: 'sat-003', nama: 'Kg', status: 'aktif' }
                ];
                localStorage.setItem('satuan_barang', JSON.stringify(satuans));

                // Initialize test products
                const barangs = [
                    {
                        id: 'brg-001',
                        kode: 'TEST-001',
                        nama: 'Test Product 1',
                        kategori_id: 'kat-001',
                        kategori_nama: 'Makanan',
                        satuan_id: 'sat-001',
                        satuan_nama: 'Pcs',
                        status: 'aktif',
                        stok_minimum: 10
                    },
                    {
                        id: 'brg-002',
                        kode: 'TEST-002',
                        nama: 'Test Product 2',
                        kategori_id: 'kat-002',
                        kategori_nama: 'Minuman',
                        satuan_id: 'sat-002',
                        satuan_nama: 'Box',
                        status: 'aktif',
                        stok_minimum: 5
                    },
                    {
                        id: 'brg-003',
                        kode: 'TEST-003',
                        nama: 'Test Product 3',
                        kategori_id: 'kat-003',
                        kategori_nama: 'Elektronik',
                        satuan_id: 'sat-003',
                        satuan_nama: 'Kg',
                        status: 'nonaktif',
                        stok_minimum: 2
                    }
                ];
                localStorage.setItem('master_barang', JSON.stringify(barangs));

                log('Test data initialized successfully', 'success');
                renderTestData();
            } catch (error) {
                log(`Error initializing test data: ${error.message}`, 'error');
            }
        }

        function renderTestData() {
            try {
                const barangs = JSON.parse(localStorage.getItem('master_barang') || '[]');
                const tbody = document.getElementById('testDataTable');
                
                tbody.innerHTML = barangs.map(barang => `
                    <tr>
                        <td><input type="checkbox" class="item-checkbox" value="${barang.id}"></td>
                        <td>${barang.kode}</td>
                        <td>${barang.nama}</td>
                        <td>${barang.kategori_nama}</td>
                        <td><span class="badge bg-${barang.status === 'aktif' ? 'success' : 'secondary'}">${barang.status}</span></td>
                    </tr>
                `).join('');
                
                log('Test data rendered successfully', 'success');
            } catch (error) {
                log(`Error rendering test data: ${error.message}`, 'error');
            }
        }

        function testBulkOperations() {
            try {
                log('Starting bulk operations test...', 'info');
                
                // Initialize bulk operations manager
                bulkManager = new BulkOperationsManager();
                bulkManager.initialize();
                
                log('BulkOperationsManager initialized successfully', 'success');
                
                // Test selection functionality
                const checkboxes = document.querySelectorAll('.item-checkbox');
                if (checkboxes.length > 0) {
                    checkboxes[0].checked = true;
                    checkboxes[0].dispatchEvent(new Event('change'));
                    log('Selection test completed', 'success');
                }
                
                // Test bulk operation availability
                const isAvailable = bulkManager.isBulkOperationAvailable();
                log(`Bulk operations available: ${isAvailable}`, isAvailable ? 'success' : 'info');
                
                // Test bulk operation options
                const options = bulkManager.getBulkOperationOptions();
                log(`Available bulk operations: ${options.length}`, 'info');
                
                // Test progress info
                const progressInfo = bulkManager.getProgressInfo();
                log(`Progress info: ${JSON.stringify(progressInfo)}`, 'info');
                
                log('All bulk operations tests completed successfully!', 'success');
                
            } catch (error) {
                log(`Error testing bulk operations: ${error.message}`, 'error');
                console.error('Bulk operations test error:', error);
            }
        }

        // Event listeners
        document.getElementById('testBulkOperations').addEventListener('click', testBulkOperations);
        document.getElementById('clearStorage').addEventListener('click', clearStorage);
        document.getElementById('initTestData').addEventListener('click', initTestData);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, ready for testing', 'info');
            renderTestData();
        });
    </script>
</body>
</html>