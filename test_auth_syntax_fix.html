<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth.js Syntax Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .card-header {
            background: linear-gradient(135deg, #2d6a4f 0%, #52b788 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 1.5rem;
        }
        .test-result {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 10px;
            border-left: 4px solid;
        }
        .test-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .test-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .test-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="card">
            <div class="card-header text-center">
                <h3><i class="bi bi-bug me-2"></i>Auth.js Syntax Error Fix Test</h3>
                <p class="mb-0">Testing for syntax errors and validation</p>
            </div>
            <div class="card-body">
                <div id="testResults">
                    <div class="test-result test-warning">
                        <i class="bi bi-clock me-2"></i>
                        <strong>Status:</strong> Running tests...
                    </div>
                </div>

                <div class="mt-4">
                    <h5><i class="bi bi-list-check me-2"></i>Test Cases</h5>
                    <ul>
                        <li>Load auth.js file</li>
                        <li>Check for syntax errors</li>
                        <li>Test password validation function</li>
                        <li>Test regex patterns</li>
                        <li>Validate all functions are accessible</li>
                    </ul>
                </div>

                <div class="mt-4">
                    <h5><i class="bi bi-terminal me-2"></i>Console Output</h5>
                    <div id="consoleOutput" class="code-block">
                        Initializing tests...
                    </div>
                </div>

                <div class="mt-4">
                    <button class="btn btn-primary" onclick="runTests()">
                        <i class="bi bi-play me-2"></i>Run Tests
                    </button>
                    <button class="btn btn-success" onclick="testPasswordValidation()">
                        <i class="bi bi-shield-check me-2"></i>Test Password Validation
                    </button>
                    <button class="btn btn-info" onclick="checkFunctions()">
                        <i class="bi bi-gear me-2"></i>Check Functions
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let consoleOutput = document.getElementById('consoleOutput');
        let testResults = document.getElementById('testResults');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function showResult(message, type = 'success') {
            const iconClass = type === 'success' ? 'bi-check-circle' : 
                             type === 'error' ? 'bi-x-circle' : 'bi-exclamation-triangle';
            
            testResults.innerHTML += `
                <div class="test-result test-${type}">
                    <i class="${iconClass} me-2"></i>
                    <strong>${type.toUpperCase()}:</strong> ${message}
                </div>
            `;
        }

        function runTests() {
            log('Starting comprehensive tests...');
            testResults.innerHTML = '';
            
            // Test 1: Check if auth.js loads without errors
            try {
                log('Test 1: Loading auth.js script...');
                
                // Create script element to load auth.js
                const script = document.createElement('script');
                script.src = 'js/auth.js';
                script.onload = function() {
                    log('✓ auth.js loaded successfully');
                    showResult('auth.js loaded without syntax errors', 'success');
                    continueTests();
                };
                script.onerror = function(error) {
                    log('✗ Failed to load auth.js: ' + error.message);
                    showResult('Failed to load auth.js: ' + error.message, 'error');
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                log('✗ Error in test setup: ' + error.message);
                showResult('Error in test setup: ' + error.message, 'error');
            }
        }

        function continueTests() {
            // Test 2: Check if functions are defined
            log('Test 2: Checking function definitions...');
            
            const expectedFunctions = [
                'validatePasswordStrength',
                'hashPassword',
                'verifyPassword',
                'handleLogin',
                'renderMenu',
                'showAlert'
            ];
            
            let functionsOk = true;
            expectedFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`✓ Function ${funcName} is defined`);
                } else {
                    log(`✗ Function ${funcName} is NOT defined`);
                    functionsOk = false;
                }
            });
            
            if (functionsOk) {
                showResult('All expected functions are defined', 'success');
            } else {
                showResult('Some functions are missing', 'warning');
            }
            
            // Test 3: Test password validation
            testPasswordValidation();
        }

        function testPasswordValidation() {
            log('Test 3: Testing password validation...');
            
            try {
                if (typeof validatePasswordStrength === 'function') {
                    // Test with various passwords
                    const testPasswords = [
                        'weak',
                        'StrongPass123!',
                        'admin123',
                        'VeryStrongPassword123!@#'
                    ];
                    
                    testPasswords.forEach(password => {
                        try {
                            const result = validatePasswordStrength(password);
                            log(`✓ Password "${password}" validation: ${result.strengthText} (${result.score}/100)`);
                        } catch (error) {
                            log(`✗ Error validating password "${password}": ${error.message}`);
                            showResult(`Password validation error: ${error.message}`, 'error');
                            return;
                        }
                    });
                    
                    showResult('Password validation function works correctly', 'success');
                } else {
                    log('✗ validatePasswordStrength function not found');
                    showResult('validatePasswordStrength function not found', 'error');
                }
            } catch (error) {
                log('✗ Error in password validation test: ' + error.message);
                showResult('Error in password validation test: ' + error.message, 'error');
            }
        }

        function checkFunctions() {
            log('Checking all available functions...');
            
            const allFunctions = [];
            for (let prop in window) {
                if (typeof window[prop] === 'function' && prop.indexOf('validate') !== -1 || 
                    prop.indexOf('render') !== -1 || prop.indexOf('show') !== -1 || 
                    prop.indexOf('handle') !== -1) {
                    allFunctions.push(prop);
                }
            }
            
            log('Available functions: ' + allFunctions.join(', '));
            showResult(`Found ${allFunctions.length} relevant functions`, 'success');
        }

        // Auto-run tests on page load
        window.addEventListener('load', function() {
            log('Page loaded, ready to run tests');
            log('Click "Run Tests" to start comprehensive testing');
        });

        // Catch any global errors
        window.addEventListener('error', function(event) {
            log('✗ Global error caught: ' + event.error.message);
            log('Error at line: ' + event.lineno + ', column: ' + event.colno);
            log('File: ' + event.filename);
            showResult(`Global JavaScript error: ${event.error.message} at line ${event.lineno}`, 'error');
        });
    </script>
</body>
</html>