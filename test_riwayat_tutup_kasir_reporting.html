<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Riwayat Tutup Kasir Reporting System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .test-section {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .test-result {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .test-success {
            background-color: #d1edff;
            border: 1px solid #0ea5e9;
            color: #0369a1;
        }
        .test-error {
            background-color: #fee2e2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }
        .test-info {
            background-color: #f0f9ff;
            border: 1px solid #38bdf8;
            color: #0284c7;
        }
        .sample-data {
            max-height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 0.5rem;
            font-family: monospace;
            font-size: 0.75rem;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #22c55e; }
        .status-warning { background-color: #f59e0b; }
        .status-error { background-color: #ef4444; }
        .status-info { background-color: #3b82f6; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h3 mb-0">
                        <i class="bi bi-clipboard-data me-2"></i>
                        Test Riwayat Tutup Kasir Reporting System
                    </h1>
                    <div>
                        <button class="btn btn-success btn-sm" onclick="runAllTests()">
                            <i class="bi bi-play-fill me-1"></i>Run All Tests
                        </button>
                        <button class="btn btn-warning btn-sm ms-2" onclick="clearAllData()">
                            <i class="bi bi-trash me-1"></i>Clear Data
                        </button>
                    </div>
                </div>

                <!-- Test Status Overview -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h6 class="card-title">Total Tests</h6>
                                <h4 id="totalTests">0</h4>
                                <small>Test scenarios</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h6 class="card-title">Passed</h6>
                                <h4 id="passedTests">0</h4>
                                <small>Successful tests</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-danger text-white">
                            <div class="card-body">
                                <h6 class="card-title">Failed</h6>
                                <h4 id="failedTests">0</h4>
                                <small>Failed tests</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h6 class="card-title">Data Quality</h6>
                                <h4 id="dataQuality">0%</h4>
                                <small>Completeness</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Sections -->
                <div class="row">
                    <div class="col-lg-6">
                        <!-- Test 1: Data Generation and Storage -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test1Status"></span>
                                Test 1: Sample Data Generation
                            </h5>
                            <p class="text-muted">Generate sample riwayat tutup kasir data for testing</p>
                            <button class="btn btn-primary btn-sm" onclick="generateSampleData()">
                                <i class="bi bi-database-add me-1"></i>Generate Sample Data
                            </button>
                            <button class="btn btn-secondary btn-sm ms-2" onclick="viewStoredData()">
                                <i class="bi bi-eye me-1"></i>View Stored Data
                            </button>
                            <div id="test1Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 2: Data Completeness Validation -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test2Status"></span>
                                Test 2: Data Completeness Validation
                            </h5>
                            <p class="text-muted">Test Property 8: Riwayat data completeness validation</p>
                            <button class="btn btn-primary btn-sm" onclick="testDataCompleteness()">
                                <i class="bi bi-check-circle me-1"></i>Test Data Completeness
                            </button>
                            <button class="btn btn-warning btn-sm ms-2" onclick="generateIncompleteData()">
                                <i class="bi bi-exclamation-triangle me-1"></i>Generate Incomplete Data
                            </button>
                            <div id="test2Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 3: Filtering and Search -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test3Status"></span>
                                Test 3: Filtering and Search
                            </h5>
                            <p class="text-muted">Test filtering by kasir, date range, and search functionality</p>
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control form-control-sm" id="testFilterKasir" placeholder="Filter by kasir">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control form-control-sm" id="testFilterSearch" placeholder="Search term">
                                </div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="testFiltering()">
                                <i class="bi bi-funnel me-1"></i>Test Filtering
                            </button>
                            <button class="btn btn-secondary btn-sm ms-2" onclick="testSearch()">
                                <i class="bi bi-search me-1"></i>Test Search
                            </button>
                            <div id="test3Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 4: Sorting -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test4Status"></span>
                                Test 4: Sorting Functionality
                            </h5>
                            <p class="text-muted">Test sorting by different fields and directions</p>
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <select class="form-control form-control-sm" id="testSortField">
                                        <option value="tanggalTutup">Tanggal Tutup</option>
                                        <option value="kasir">Kasir</option>
                                        <option value="totalPenjualan">Total Penjualan</option>
                                        <option value="selisih">Selisih</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <select class="form-control form-control-sm" id="testSortDirection">
                                        <option value="desc">Descending</option>
                                        <option value="asc">Ascending</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="testSorting()">
                                <i class="bi bi-sort-down me-1"></i>Test Sorting
                            </button>
                            <div id="test4Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 5: Pagination -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test5Status"></span>
                                Test 5: Pagination
                            </h5>
                            <p class="text-muted">Test pagination with different page sizes</p>
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <input type="number" class="form-control form-control-sm" id="testPageSize" value="5" min="1" max="50">
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control form-control-sm" id="testPageNumber" value="1" min="1">
                                </div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="testPagination()">
                                <i class="bi bi-collection me-1"></i>Test Pagination
                            </button>
                            <div id="test5Result" class="test-result" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <!-- Test 6: Export Functionality -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test6Status"></span>
                                Test 6: Export Functionality
                            </h5>
                            <p class="text-muted">Test CSV and PDF export capabilities</p>
                            <button class="btn btn-success btn-sm" onclick="testCSVExport()">
                                <i class="bi bi-file-earmark-spreadsheet me-1"></i>Test CSV Export
                            </button>
                            <button class="btn btn-danger btn-sm ms-2" onclick="testPDFExport()">
                                <i class="bi bi-file-earmark-pdf me-1"></i>Test PDF Export
                            </button>
                            <div id="test6Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 7: Summary Statistics -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test7Status"></span>
                                Test 7: Summary Statistics
                            </h5>
                            <p class="text-muted">Test summary calculation accuracy</p>
                            <button class="btn btn-primary btn-sm" onclick="testSummaryStatistics()">
                                <i class="bi bi-graph-up me-1"></i>Test Summary Stats
                            </button>
                            <div id="test7Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 8: Error Handling -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test8Status"></span>
                                Test 8: Error Handling
                            </h5>
                            <p class="text-muted">Test error handling for corrupted or invalid data</p>
                            <button class="btn btn-warning btn-sm" onclick="testErrorHandling()">
                                <i class="bi bi-exclamation-triangle me-1"></i>Test Error Handling
                            </button>
                            <button class="btn btn-danger btn-sm ms-2" onclick="corruptStorageData()">
                                <i class="bi bi-bug me-1"></i>Corrupt Storage
                            </button>
                            <div id="test8Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 9: Performance -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test9Status"></span>
                                Test 9: Performance Testing
                            </h5>
                            <p class="text-muted">Test performance with large datasets</p>
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <input type="number" class="form-control form-control-sm" id="testDataSize" value="100" min="10" max="1000">
                                </div>
                                <div class="col-md-6">
                                    <span class="form-text">Records to generate</span>
                                </div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="testPerformance()">
                                <i class="bi bi-speedometer2 me-1"></i>Test Performance
                            </button>
                            <div id="test9Result" class="test-result" style="display: none;"></div>
                        </div>

                        <!-- Test 10: Integration -->
                        <div class="test-section">
                            <h5>
                                <span class="status-indicator status-info" id="test10Status"></span>
                                Test 10: UI Integration
                            </h5>
                            <p class="text-muted">Test full UI rendering and interaction</p>
                            <button class="btn btn-primary btn-sm" onclick="testUIIntegration()">
                                <i class="bi bi-display me-1"></i>Test UI Integration
                            </button>
                            <button class="btn btn-secondary btn-sm ms-2" onclick="clearUIContainer()">
                                <i class="bi bi-x-circle me-1"></i>Clear UI
                            </button>
                            <div id="test10Result" class="test-result" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Sample Data Display -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Sample Data Preview</h6>
                            </div>
                            <div class="card-body">
                                <div id="sampleDataDisplay" class="sample-data">
                                    No data generated yet. Click "Generate Sample Data" to create test data.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- UI Integration Container -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Riwayat Tutup Kasir UI Integration Test</h6>
                            </div>
                            <div class="card-body">
                                <div id="riwayatTutupKasirContainer">
                                    UI integration test will appear here when "Test UI Integration" is clicked.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Riwayat Reporting System -->
    <script src="js/riwayat-tutup-kasir-reporting.js"></script>

    <script>
        // Test tracking
        let testResults = {
            total: 10,
            passed: 0,
            failed: 0,
            dataQuality: 0
        };

        // Update test status display
        function updateTestStatus() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('dataQuality').textContent = testResults.dataQuality.toFixed(1) + '%';
        }

        // Set test status indicator
        function setTestStatus(testNumber, status) {
            const indicator = document.getElementById(`test${testNumber}Status`);
            indicator.className = `status-indicator status-${status}`;
        }

        // Show test result
        function showTestResult(testNumber, success, message, details = null) {
            const resultDiv = document.getElementById(`test${testNumber}Result`);
            resultDiv.style.display = 'block';
            resultDiv.className = `test-result ${success ? 'test-success' : 'test-error'}`;
            
            let content = `<strong>${success ? '✅ PASS' : '❌ FAIL'}:</strong> ${message}`;
            if (details) {
                content += `<br><small>${details}</small>`;
            }
            resultDiv.innerHTML = content;
            
            setTestStatus(testNumber, success ? 'success' : 'error');
            
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            updateTestStatus();
        }

        // Generate sample riwayat data
        function generateSampleData() {
            try {
                const sampleData = [];
                const kasirNames = ['John Doe', 'Jane Smith', 'Bob Wilson', 'Alice Brown', 'Charlie Davis'];
                const kasirIds = ['JD001', 'JS002', 'BW003', 'AB004', 'CD005'];
                
                for (let i = 0; i < 20; i++) {
                    const kasirIndex = Math.floor(Math.random() * kasirNames.length);
                    const baseDate = new Date('2024-01-01');
                    baseDate.setDate(baseDate.getDate() + i);
                    
                    const waktuBuka = new Date(baseDate);
                    waktuBuka.setHours(8, 0, 0, 0);
                    
                    const waktuTutup = new Date(baseDate);
                    waktuTutup.setHours(17, 0, 0, 0);
                    
                    const modalAwal = 1000000;
                    const totalPenjualan = Math.floor(Math.random() * 10000000) + 1000000;
                    const totalCash = Math.floor(totalPenjualan * (0.6 + Math.random() * 0.3));
                    const totalKredit = totalPenjualan - totalCash;
                    const kasSeharusnya = modalAwal + totalCash;
                    const kasAktual = kasSeharusnya + (Math.floor(Math.random() * 200000) - 100000);
                    const selisih = kasAktual - kasSeharusnya;
                    
                    sampleData.push({
                        id: `tutup-kasir-${Date.now()}-${i}`,
                        shiftId: `shift-${Date.now()}-${i}`,
                        kasir: kasirNames[kasirIndex],
                        kasirId: kasirIds[kasirIndex],
                        waktuBuka: waktuBuka.toISOString(),
                        waktuTutup: waktuTutup.toISOString(),
                        modalAwal: modalAwal,
                        totalPenjualan: totalPenjualan,
                        totalCash: totalCash,
                        totalKredit: totalKredit,
                        kasSeharusnya: kasSeharusnya,
                        kasAktual: kasAktual,
                        selisih: selisih,
                        jumlahTransaksi: Math.floor(Math.random() * 100) + 10,
                        tanggalTutup: baseDate.toISOString().split('T')[0],
                        keteranganSelisih: selisih !== 0 ? (selisih > 0 ? 'Kelebihan kas' : 'Kekurangan kas') : ''
                    });
                }
                
                // Store in localStorage
                localStorage.setItem('riwayatTutupKas', JSON.stringify(sampleData));
                
                // Update display
                document.getElementById('sampleDataDisplay').innerHTML = 
                    `<strong>Generated ${sampleData.length} sample records:</strong><br>` +
                    JSON.stringify(sampleData.slice(0, 2), null, 2) + 
                    `<br>... and ${sampleData.length - 2} more records`;
                
                showTestResult(1, true, `Generated ${sampleData.length} sample riwayat records`, 
                    `Data stored in localStorage with key 'riwayatTutupKas'`);
                
            } catch (error) {
                showTestResult(1, false, 'Failed to generate sample data', error.message);
            }
        }

        // View stored data
        function viewStoredData() {
            try {
                const data = localStorage.getItem('riwayatTutupKas');
                if (!data) {
                    document.getElementById('sampleDataDisplay').innerHTML = 'No data found in localStorage';
                    return;
                }
                
                const parsedData = JSON.parse(data);
                document.getElementById('sampleDataDisplay').innerHTML = 
                    `<strong>Found ${parsedData.length} stored records:</strong><br>` +
                    JSON.stringify(parsedData.slice(0, 3), null, 2) + 
                    (parsedData.length > 3 ? `<br>... and ${parsedData.length - 3} more records` : '');
                
            } catch (error) {
                document.getElementById('sampleDataDisplay').innerHTML = `Error loading data: ${error.message}`;
            }
        }

        // Test data completeness validation
        function testDataCompleteness() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const rawData = reporting.loadRiwayatData();
                
                if (rawData.length === 0) {
                    showTestResult(2, false, 'No data available for testing', 'Generate sample data first');
                    return;
                }
                
                const validation = reporting.validateDataCompleteness(rawData);
                
                // Test Property 8: All records should be validated
                const allRecordsValidated = validation.totalRecords === rawData.length;
                const hasValidationResults = validation.validationResults.length === rawData.length;
                const percentageCalculated = validation.completenessPercentage >= 0 && validation.completenessPercentage <= 100;
                const countsMatch = validation.completeRecords + validation.incompleteRecords === validation.totalRecords;
                
                const success = allRecordsValidated && hasValidationResults && percentageCalculated && countsMatch;
                
                testResults.dataQuality = validation.completenessPercentage;
                updateTestStatus();
                
                showTestResult(2, success, 
                    `Data completeness validation ${success ? 'passed' : 'failed'}`,
                    `Total: ${validation.totalRecords}, Complete: ${validation.completeRecords}, ` +
                    `Incomplete: ${validation.incompleteRecords}, Quality: ${validation.completenessPercentage.toFixed(1)}%`);
                
            } catch (error) {
                showTestResult(2, false, 'Data completeness test failed', error.message);
            }
        }

        // Generate incomplete data for testing
        function generateIncompleteData() {
            try {
                const incompleteData = [
                    {
                        id: 'incomplete-1',
                        kasir: 'Incomplete User',
                        // Missing many required fields
                        modalAwal: 'not-a-number',
                        waktuBuka: 'invalid-date'
                    },
                    {
                        // Missing id
                        shiftId: null,
                        kasir: '',
                        totalPenjualan: NaN,
                        selisih: undefined
                    }
                ];
                
                // Add to existing data
                const existingData = JSON.parse(localStorage.getItem('riwayatTutupKas') || '[]');
                const combinedData = [...existingData, ...incompleteData];
                localStorage.setItem('riwayatTutupKas', JSON.stringify(combinedData));
                
                showTestResult(2, true, `Added ${incompleteData.length} incomplete records for testing`,
                    'These records should be identified as incomplete during validation');
                
            } catch (error) {
                showTestResult(2, false, 'Failed to generate incomplete data', error.message);
            }
        }

        // Test filtering functionality
        function testFiltering() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const kasirFilter = document.getElementById('testFilterKasir').value;
                
                const filters = kasirFilter ? { kasir: kasirFilter } : {};
                const processedData = reporting.getProcessedRiwayatData({ filters });
                
                // Verify filtering worked
                let filterSuccess = true;
                if (kasirFilter) {
                    filterSuccess = processedData.data.every(record => 
                        record.kasir.toLowerCase().includes(kasirFilter.toLowerCase())
                    );
                }
                
                showTestResult(3, filterSuccess,
                    `Filtering test ${filterSuccess ? 'passed' : 'failed'}`,
                    `Filter: "${kasirFilter || 'none'}", Results: ${processedData.data.length} records`);
                
            } catch (error) {
                showTestResult(3, false, 'Filtering test failed', error.message);
            }
        }

        // Test search functionality
        function testSearch() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const searchTerm = document.getElementById('testFilterSearch').value;
                
                const filters = searchTerm ? { search: searchTerm } : {};
                const processedData = reporting.getProcessedRiwayatData({ filters });
                
                showTestResult(3, true,
                    `Search test completed`,
                    `Search: "${searchTerm || 'none'}", Results: ${processedData.data.length} records`);
                
            } catch (error) {
                showTestResult(3, false, 'Search test failed', error.message);
            }
        }

        // Test sorting functionality
        function testSorting() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const sortField = document.getElementById('testSortField').value;
                const sortDirection = document.getElementById('testSortDirection').value;
                
                const sort = { field: sortField, direction: sortDirection };
                const processedData = reporting.getProcessedRiwayatData({ sort });
                
                // Verify sorting worked (check first few records)
                let sortSuccess = true;
                if (processedData.data.length > 1) {
                    for (let i = 0; i < Math.min(3, processedData.data.length - 1); i++) {
                        const current = processedData.data[i][sortField];
                        const next = processedData.data[i + 1][sortField];
                        
                        if (sortDirection === 'asc' && current > next) {
                            sortSuccess = false;
                            break;
                        }
                        if (sortDirection === 'desc' && current < next) {
                            sortSuccess = false;
                            break;
                        }
                    }
                }
                
                showTestResult(4, sortSuccess,
                    `Sorting test ${sortSuccess ? 'passed' : 'failed'}`,
                    `Sort: ${sortField} ${sortDirection}, Records: ${processedData.data.length}`);
                
            } catch (error) {
                showTestResult(4, false, 'Sorting test failed', error.message);
            }
        }

        // Test pagination
        function testPagination() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const pageSize = parseInt(document.getElementById('testPageSize').value);
                const pageNumber = parseInt(document.getElementById('testPageNumber').value);
                
                const processedData = reporting.getProcessedRiwayatData({ 
                    page: pageNumber, 
                    itemsPerPage: pageSize 
                });
                
                const pagination = processedData.pagination;
                const paginationValid = 
                    pagination.currentPage === pageNumber &&
                    pagination.itemsPerPage === pageSize &&
                    processedData.data.length <= pageSize;
                
                showTestResult(5, paginationValid,
                    `Pagination test ${paginationValid ? 'passed' : 'failed'}`,
                    `Page ${pagination.currentPage}/${pagination.totalPages}, ` +
                    `Items: ${processedData.data.length}/${pagination.totalItems}`);
                
            } catch (error) {
                showTestResult(5, false, 'Pagination test failed', error.message);
            }
        }

        // Test CSV export
        function testCSVExport() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                
                // Mock the download function to test CSV generation
                const originalDownload = reporting.downloadFile;
                let csvContent = '';
                reporting.downloadFile = function(content, filename, mimeType) {
                    csvContent = content;
                };
                
                reporting.exportToCSV();
                
                // Restore original function
                reporting.downloadFile = originalDownload;
                
                const hasHeaders = csvContent.includes('Tanggal Tutup,Kasir');
                const hasData = csvContent.split('\n').length > 1;
                
                showTestResult(6, hasHeaders && hasData,
                    `CSV export test ${hasHeaders && hasData ? 'passed' : 'failed'}`,
                    `Generated CSV with ${csvContent.split('\n').length - 1} data rows`);
                
            } catch (error) {
                showTestResult(6, false, 'CSV export test failed', error.message);
            }
        }

        // Test PDF export
        function testPDFExport() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                
                // Mock window.open to test PDF generation
                const originalOpen = window.open;
                let pdfGenerated = false;
                window.open = function() {
                    pdfGenerated = true;
                    return {
                        document: {
                            write: function() {},
                            close: function() {}
                        },
                        focus: function() {},
                        print: function() {}
                    };
                };
                
                reporting.exportToPDF();
                
                // Restore original function
                window.open = originalOpen;
                
                showTestResult(6, pdfGenerated,
                    `PDF export test ${pdfGenerated ? 'passed' : 'failed'}`,
                    'PDF generation process initiated successfully');
                
            } catch (error) {
                showTestResult(6, false, 'PDF export test failed', error.message);
            }
        }

        // Test summary statistics
        function testSummaryStatistics() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const processedData = reporting.getProcessedRiwayatData();
                const summary = processedData.summary;
                
                const summaryValid = 
                    typeof summary.totalRecords === 'number' &&
                    typeof summary.totalPenjualan === 'number' &&
                    typeof summary.totalSelisih === 'number' &&
                    typeof summary.averageSelisih === 'number' &&
                    summary.recordsWithSelisih + summary.recordsWithoutSelisih === summary.totalRecords;
                
                showTestResult(7, summaryValid,
                    `Summary statistics test ${summaryValid ? 'passed' : 'failed'}`,
                    `Records: ${summary.totalRecords}, Total Sales: Rp ${summary.totalPenjualan.toLocaleString('id-ID')}, ` +
                    `Total Selisih: Rp ${summary.totalSelisih.toLocaleString('id-ID')}`);
                
            } catch (error) {
                showTestResult(7, false, 'Summary statistics test failed', error.message);
            }
        }

        // Test error handling
        function testErrorHandling() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                
                // Test with empty data
                reporting.setMockData = function() { return []; };
                const emptyResult = reporting.loadRiwayatData();
                
                // Test with corrupted data
                localStorage.setItem('riwayatTutupKas', 'invalid-json');
                const corruptedResult = reporting.loadRiwayatData();
                
                // Restore valid data
                generateSampleData();
                
                const errorHandlingWorked = Array.isArray(emptyResult) && Array.isArray(corruptedResult);
                
                showTestResult(8, errorHandlingWorked,
                    `Error handling test ${errorHandlingWorked ? 'passed' : 'failed'}`,
                    'System gracefully handled empty and corrupted data');
                
            } catch (error) {
                showTestResult(8, false, 'Error handling test failed', error.message);
            }
        }

        // Corrupt storage data for testing
        function corruptStorageData() {
            localStorage.setItem('riwayatTutupKas', 'corrupted-json-data');
            showTestResult(8, true, 'Storage data corrupted for testing', 'Use "Test Error Handling" to verify graceful handling');
        }

        // Test performance
        function testPerformance() {
            try {
                const dataSize = parseInt(document.getElementById('testDataSize').value);
                const startTime = performance.now();
                
                // Generate large dataset
                const largeData = [];
                for (let i = 0; i < dataSize; i++) {
                    largeData.push({
                        id: `perf-test-${i}`,
                        shiftId: `shift-${i}`,
                        kasir: `Kasir ${i % 10}`,
                        kasirId: `K${String(i % 10).padStart(3, '0')}`,
                        waktuBuka: new Date().toISOString(),
                        waktuTutup: new Date().toISOString(),
                        modalAwal: 1000000,
                        totalPenjualan: Math.random() * 10000000,
                        totalCash: Math.random() * 5000000,
                        totalKredit: Math.random() * 5000000,
                        kasSeharusnya: Math.random() * 6000000,
                        kasAktual: Math.random() * 6000000,
                        selisih: Math.random() * 200000 - 100000,
                        jumlahTransaksi: Math.floor(Math.random() * 100),
                        tanggalTutup: new Date().toISOString().split('T')[0]
                    });
                }
                
                localStorage.setItem('riwayatTutupKas', JSON.stringify(largeData));
                
                // Test processing performance
                const reporting = new RiwayatTutupKasirReporting();
                const processedData = reporting.getProcessedRiwayatData();
                
                const endTime = performance.now();
                const processingTime = endTime - startTime;
                
                const performanceGood = processingTime < 1000; // Less than 1 second
                
                showTestResult(9, performanceGood,
                    `Performance test ${performanceGood ? 'passed' : 'failed'}`,
                    `Processed ${dataSize} records in ${processingTime.toFixed(2)}ms`);
                
            } catch (error) {
                showTestResult(9, false, 'Performance test failed', error.message);
            }
        }

        // Test UI integration
        function testUIIntegration() {
            try {
                const reporting = new RiwayatTutupKasirReporting();
                const processedData = reporting.getProcessedRiwayatData();
                
                // Render the UI
                reporting.renderRiwayatTable(processedData, 'riwayatTutupKasirContainer');
                
                // Check if UI elements were created
                const container = document.getElementById('riwayatTutupKasirContainer');
                const hasTable = container.querySelector('table') !== null;
                const hasPagination = container.querySelector('.pagination') !== null;
                const hasFilters = container.querySelector('#filterKasir') !== null;
                const hasSummary = container.querySelector('.card.bg-primary') !== null;
                
                const uiIntegrationSuccess = hasTable && hasFilters && hasSummary;
                
                showTestResult(10, uiIntegrationSuccess,
                    `UI integration test ${uiIntegrationSuccess ? 'passed' : 'failed'}`,
                    `Table: ${hasTable}, Filters: ${hasFilters}, Summary: ${hasSummary}, Pagination: ${hasPagination}`);
                
            } catch (error) {
                showTestResult(10, false, 'UI integration test failed', error.message);
            }
        }

        // Clear UI container
        function clearUIContainer() {
            document.getElementById('riwayatTutupKasirContainer').innerHTML = 
                'UI integration test will appear here when "Test UI Integration" is clicked.';
        }

        // Run all tests
        function runAllTests() {
            // Reset test results
            testResults = { total: 10, passed: 0, failed: 0, dataQuality: 0 };
            updateTestStatus();
            
            // Clear all result displays
            for (let i = 1; i <= 10; i++) {
                document.getElementById(`test${i}Result`).style.display = 'none';
                setTestStatus(i, 'info');
            }
            
            // Run tests in sequence with delays
            setTimeout(() => generateSampleData(), 100);
            setTimeout(() => testDataCompleteness(), 500);
            setTimeout(() => testFiltering(), 1000);
            setTimeout(() => testSorting(), 1500);
            setTimeout(() => testPagination(), 2000);
            setTimeout(() => testCSVExport(), 2500);
            setTimeout(() => testPDFExport(), 3000);
            setTimeout(() => testSummaryStatistics(), 3500);
            setTimeout(() => testErrorHandling(), 4000);
            setTimeout(() => testPerformance(), 4500);
            setTimeout(() => testUIIntegration(), 5000);
        }

        // Clear all data
        function clearAllData() {
            localStorage.removeItem('riwayatTutupKas');
            document.getElementById('sampleDataDisplay').innerHTML = 
                'No data generated yet. Click "Generate Sample Data" to create test data.';
            clearUIContainer();
            
            // Reset test results
            testResults = { total: 10, passed: 0, failed: 0, dataQuality: 0 };
            updateTestStatus();
            
            // Clear all result displays
            for (let i = 1; i <= 10; i++) {
                document.getElementById(`test${i}Result`).style.display = 'none';
                setTestStatus(i, 'info');
            }
        }

        // Initialize
        updateTestStatus();
        viewStoredData();
    </script>
</body>
</html>