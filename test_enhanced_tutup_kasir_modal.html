<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Tutup Kasir Modal</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .test-header {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #000;
            padding: 20px;
            text-align: center;
        }
        
        .scenario-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .scenario-card:hover {
            border-color: #ffc107;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }
        
        .scenario-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
        }
        
        .scenario-body {
            padding: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-ready { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        
        .btn-test {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-card">
            <div class="test-header">
                <h2><i class="bi bi-gear-fill me-2"></i>Enhanced Tutup Kasir Modal - Test Suite</h2>
                <p class="mb-0">Task 3: Enhance modal tutup kasir interface dan user experience</p>
            </div>
            
            <div class="p-4">
                <!-- Test Status -->
                <div class="alert alert-info mb-4">
                    <h5><i class="bi bi-info-circle me-2"></i>Test Information</h5>
                    <p class="mb-2">This test suite validates the enhanced tutup kasir modal functionality including:</p>
                    <ul class="mb-0">
                        <li>Better responsive design for various screen sizes</li>
                        <li>Clearer instructions and guidance for kasir</li>
                        <li>Better error handling and validation feedback</li>
                        <li>Loading states and progress indicators</li>
                        <li>Enhanced accessibility features</li>
                    </ul>
                </div>
                
                <!-- Test Scenarios -->
                <h4 class="mb-3">Test Scenarios</h4>
                
                <!-- Scenario 1: Valid Session -->
                <div class="scenario-card">
                    <div class="scenario-header" data-bs-toggle="collapse" data-bs-target="#scenario1">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-indicator status-ready"></span>
                                <strong>Scenario 1: Valid Session with Sales Data</strong>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <div class="collapse show" id="scenario1">
                        <div class="scenario-body">
                            <p><strong>Description:</strong> Test modal with valid buka kas session and sample sales data</p>
                            <p><strong>Expected:</strong> Modal opens with complete shift information, sales summary, and interactive kas input</p>
                            <button class="btn btn-test" onclick="testValidSession()">
                                <i class="bi bi-play-fill me-1"></i>Run Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scenario 2: No Session -->
                <div class="scenario-card">
                    <div class="scenario-header" data-bs-toggle="collapse" data-bs-target="#scenario2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-indicator status-warning"></span>
                                <strong>Scenario 2: No Session Data</strong>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <div class="collapse" id="scenario2">
                        <div class="scenario-body">
                            <p><strong>Description:</strong> Test error handling when no buka kas session exists</p>
                            <p><strong>Expected:</strong> Enhanced error message with guidance and action button</p>
                            <button class="btn btn-test" onclick="testNoSession()">
                                <i class="bi bi-play-fill me-1"></i>Run Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scenario 3: Corrupted Session -->
                <div class="scenario-card">
                    <div class="scenario-header" data-bs-toggle="collapse" data-bs-target="#scenario3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-indicator status-error"></span>
                                <strong>Scenario 3: Corrupted Session Data</strong>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <div class="collapse" id="scenario3">
                        <div class="scenario-body">
                            <p><strong>Description:</strong> Test error handling with corrupted JSON session data</p>
                            <p><strong>Expected:</strong> Session cleanup and clear error message with recovery guidance</p>
                            <button class="btn btn-test" onclick="testCorruptedSession()">
                                <i class="bi bi-play-fill me-1"></i>Run Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scenario 4: Kas Calculation -->
                <div class="scenario-card">
                    <div class="scenario-header" data-bs-toggle="collapse" data-bs-target="#scenario4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-indicator status-ready"></span>
                                <strong>Scenario 4: Kas Calculation & Validation</strong>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <div class="collapse" id="scenario4">
                        <div class="scenario-body">
                            <p><strong>Description:</strong> Test kas aktual input, difference calculation, and validation</p>
                            <p><strong>Expected:</strong> Real-time calculation, visual feedback, and conditional keterangan field</p>
                            <button class="btn btn-test" onclick="testKasCalculation()">
                                <i class="bi bi-play-fill me-1"></i>Run Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scenario 5: Responsive Design -->
                <div class="scenario-card">
                    <div class="scenario-header" data-bs-toggle="collapse" data-bs-target="#scenario5">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-indicator status-ready"></span>
                                <strong>Scenario 5: Responsive Design Test</strong>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <div class="collapse" id="scenario5">
                        <div class="scenario-body">
                            <p><strong>Description:</strong> Test modal responsiveness on different screen sizes</p>
                            <p><strong>Expected:</strong> Modal adapts properly to mobile, tablet, and desktop viewports</p>
                            <button class="btn btn-test" onclick="testResponsiveDesign()">
                                <i class="bi bi-play-fill me-1"></i>Run Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Test Results -->
                <div class="mt-4">
                    <h4>Test Results</h4>
                    <div id="testResults" class="alert alert-secondary">
                        <p class="mb-0">No tests run yet. Click on test buttons above to start testing.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mock Functions -->
    <script>
        // Mock localStorage and sessionStorage
        const mockStorage = {
            data: {},
            getItem: function(key) { return this.data[key] || null; },
            setItem: function(key, value) { this.data[key] = value; },
            removeItem: function(key) { delete this.data[key]; },
            clear: function() { this.data = {}; }
        };
        
        if (typeof localStorage === 'undefined') {
            window.localStorage = mockStorage;
        }
        if (typeof sessionStorage === 'undefined') {
            window.sessionStorage = mockStorage;
        }
        
        // Mock functions
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function showAlert(message, type) {
            console.log(`Alert [${type}]: ${message}`);
            updateTestResults(`Alert shown: ${message}`, type === 'error' ? 'danger' : 'success');
        }
        
        function addJurnal(keterangan, entries, referensi) {
            console.log('Journal entry created:', { keterangan, entries, referensi });
        }
        
        function navigateTo(page) {
            console.log('Navigate to:', page);
        }
        
        function exitPOSFullscreen() {
            console.log('Exit POS fullscreen');
        }
        
        // Test result helper
        function updateTestResults(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'danger': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';
            
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.className = `alert ${alertClass}`;
            resultsDiv.innerHTML = `
                <div class="d-flex justify-content-between">
                    <span>${message}</span>
                    <small class="text-muted">${timestamp}</small>
                </div>
            `;
        }
    </script>
    
    <!-- Load Enhanced Modal Scripts -->
    <script src="js/enhanced-tutup-kasir-modal.js"></script>
    <script src="js/enhanced-tutup-kasir-process.js"></script>
    
    <!-- Test Functions -->
    <script>
        // Test Scenario 1: Valid Session
        function testValidSession() {
            updateTestResults('Running: Valid Session Test...', 'info');
            
            // Setup valid session data
            const validSessionData = {
                id: 'shift_' + generateId(),
                kasir: 'John Doe',
                kasirId: 'kasir_001',
                modalAwal: 500000,
                waktuBuka: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(), // 4 hours ago
                tanggal: new Date().toISOString().split('T')[0]
            };
            
            // Setup sample sales data
            const sampleSales = [
                {
                    id: 'sale_1',
                    tanggal: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    total: 150000,
                    status: 'cash'
                },
                {
                    id: 'sale_2',
                    tanggal: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
                    total: 75000,
                    status: 'kredit'
                },
                {
                    id: 'sale_3',
                    tanggal: new Date().toISOString(),
                    total: 200000,
                    status: 'cash'
                }
            ];
            
            sessionStorage.setItem('bukaKas', JSON.stringify(validSessionData));
            localStorage.setItem('penjualan', JSON.stringify(sampleSales));
            
            try {
                showTutupKasirModalEnhanced();
                updateTestResults('✅ Valid session test completed - Modal should be displayed with complete data', 'success');
            } catch (error) {
                updateTestResults('❌ Valid session test failed: ' + error.message, 'danger');
            }
        }
        
        // Test Scenario 2: No Session
        function testNoSession() {
            updateTestResults('Running: No Session Test...', 'info');
            
            // Clear session data
            sessionStorage.removeItem('bukaKas');
            sessionStorage.removeItem('shiftId');
            
            try {
                showTutupKasirModalEnhanced();
                updateTestResults('✅ No session test completed - Error message should be displayed', 'success');
            } catch (error) {
                updateTestResults('❌ No session test failed: ' + error.message, 'danger');
            }
        }
        
        // Test Scenario 3: Corrupted Session
        function testCorruptedSession() {
            updateTestResults('Running: Corrupted Session Test...', 'info');
            
            // Set corrupted session data
            sessionStorage.setItem('bukaKas', '{"invalid": json, missing quotes}');
            
            try {
                showTutupKasirModalEnhanced();
                updateTestResults('✅ Corrupted session test completed - Session should be cleaned and error shown', 'success');
            } catch (error) {
                updateTestResults('❌ Corrupted session test failed: ' + error.message, 'danger');
            }
        }
        
        // Test Scenario 4: Kas Calculation
        function testKasCalculation() {
            updateTestResults('Running: Kas Calculation Test...', 'info');
            
            // First setup valid session
            testValidSession();
            
            setTimeout(() => {
                try {
                    const kasInput = document.getElementById('kasAktual');
                    if (kasInput) {
                        // Test different kas values
                        kasInput.value = 650000; // Exact amount
                        kasInput.dispatchEvent(new Event('input'));
                        
                        setTimeout(() => {
                            kasInput.value = 700000; // More than expected
                            kasInput.dispatchEvent(new Event('input'));
                            
                            setTimeout(() => {
                                kasInput.value = 600000; // Less than expected
                                kasInput.dispatchEvent(new Event('input'));
                                
                                updateTestResults('✅ Kas calculation test completed - Check modal for real-time calculations', 'success');
                            }, 500);
                        }, 500);
                    } else {
                        updateTestResults('❌ Kas calculation test failed - Modal not found', 'danger');
                    }
                } catch (error) {
                    updateTestResults('❌ Kas calculation test failed: ' + error.message, 'danger');
                }
            }, 1000);
        }
        
        // Test Scenario 5: Responsive Design
        function testResponsiveDesign() {
            updateTestResults('Running: Responsive Design Test...', 'info');
            
            // First setup valid session
            testValidSession();
            
            setTimeout(() => {
                try {
                    const modal = document.getElementById('tutupKasirModal');
                    if (modal) {
                        // Test different viewport sizes
                        const originalWidth = window.innerWidth;
                        
                        // Simulate mobile
                        Object.defineProperty(window, 'innerWidth', { value: 375, configurable: true });
                        window.dispatchEvent(new Event('resize'));
                        
                        setTimeout(() => {
                            // Simulate tablet
                            Object.defineProperty(window, 'innerWidth', { value: 768, configurable: true });
                            window.dispatchEvent(new Event('resize'));
                            
                            setTimeout(() => {
                                // Restore original
                                Object.defineProperty(window, 'innerWidth', { value: originalWidth, configurable: true });
                                window.dispatchEvent(new Event('resize'));
                                
                                updateTestResults('✅ Responsive design test completed - Modal should adapt to different screen sizes', 'success');
                            }, 500);
                        }, 500);
                    } else {
                        updateTestResults('❌ Responsive design test failed - Modal not found', 'danger');
                    }
                } catch (error) {
                    updateTestResults('❌ Responsive design test failed: ' + error.message, 'danger');
                }
            }, 1000);
        }
        
        // Initialize test environment
        document.addEventListener('DOMContentLoaded', function() {
            updateTestResults('Test environment initialized. Ready to run tests.', 'info');
        });
    </script>
</body>
</html>