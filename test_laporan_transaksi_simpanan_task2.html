<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 2 - Main Report Rendering</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .test-header {
            background: linear-gradient(135deg, #2d6a4f 0%, #52b788 100%);
            color: white;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <div class="container">
            <h1><i class="bi bi-clipboard-check me-2"></i>Test Task 2: Main Report Rendering</h1>
            <p class="mb-0">Testing renderLaporanTransaksiSimpananAnggota() function</p>
        </div>
    </div>
    
    <div class="container">
        <div class="test-section">
            <h3>üìã Test Setup</h3>
            <button class="btn btn-primary" onclick="setupTestData()">Setup Test Data</button>
            <button class="btn btn-secondary" onclick="clearTestData()">Clear Test Data</button>
            <div id="setupResult"></div>
        </div>
        
        <div class="test-section">
            <h3>üé® Test 1: Render Main Report</h3>
            <button class="btn btn-success" onclick="testRenderReport()">Render Report</button>
            <div id="test1Result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Test 2: Verify Statistics Cards</h3>
            <button class="btn btn-info" onclick="testStatisticsCards()">Test Statistics</button>
            <div id="test2Result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã Test 3: Verify Data Table</h3>
            <button class="btn btn-warning" onclick="testDataTable()">Test Table</button>
            <div id="test3Result"></div>
        </div>
        
        <div class="test-section">
            <h3>üîò Test 4: Test Action Buttons</h3>
            <button class="btn btn-primary" onclick="testActionButtons()">Test Buttons</button>
            <div id="test4Result"></div>
        </div>
        
        <!-- Main Content Container -->
        <div id="mainContent"></div>
    </div>

    <!-- Load dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/koperasi.js"></script>
    <script src="js/laporanTransaksiSimpananAnggota.js"></script>
    
    <script>
        // Test data setup
        function setupTestData() {
            const result = document.getElementById('setupResult');
            
            try {
                // Setup anggota
                const anggota = [
                    {
                        id: 'ang001',
                        nik: '3201010101010001',
                        nama: 'Budi Santoso',
                        noKartu: 'K001',
                        departemen: 'IT',
                        tipeAnggota: 'Anggota',
                        status: 'Aktif'
                    },
                    {
                        id: 'ang002',
                        nik: '3201010101010002',
                        nama: 'Siti Aminah',
                        noKartu: 'K002',
                        departemen: 'Finance',
                        tipeAnggota: 'Non-Anggota',
                        status: 'Aktif'
                    },
                    {
                        id: 'ang003',
                        nik: '3201010101010003',
                        nama: 'Ahmad Keluar',
                        noKartu: 'K003',
                        departemen: 'HR',
                        tipeAnggota: 'Anggota',
                        status: 'Aktif',
                        statusKeanggotaan: 'Keluar'
                    }
                ];
                localStorage.setItem('anggota', JSON.stringify(anggota));
                
                // Setup penjualan
                const penjualan = [
                    { id: 'trx001', anggotaId: 'ang001', metode: 'cash', total: 100000, status: 'lunas' },
                    { id: 'trx002', anggotaId: 'ang001', metode: 'bon', total: 200000, status: 'kredit' },
                    { id: 'trx003', anggotaId: 'ang002', metode: 'cash', total: 150000, status: 'lunas' },
                    { id: 'trx004', anggotaId: 'ang002', metode: 'bon', total: 300000, status: 'kredit' }
                ];
                localStorage.setItem('penjualan', JSON.stringify(penjualan));
                
                // Setup simpanan
                const simpananPokok = [
                    { id: 'sp001', anggotaId: 'ang001', jumlah: 1000000, tanggal: '2024-01-01' },
                    { id: 'sp002', anggotaId: 'ang002', jumlah: 1000000, tanggal: '2024-01-01' }
                ];
                localStorage.setItem('simpananPokok', JSON.stringify(simpananPokok));
                
                const simpananWajib = [
                    { id: 'sw001', anggotaId: 'ang001', jumlah: 50000, periode: '2024-01', tanggal: '2024-01-15' },
                    { id: 'sw002', anggotaId: 'ang002', jumlah: 50000, periode: '2024-01', tanggal: '2024-01-15' }
                ];
                localStorage.setItem('simpananWajib', JSON.stringify(simpananWajib));
                
                const simpananSukarela = [
                    { id: 'ss001', anggotaId: 'ang001', jumlah: 500000, tanggal: '2024-01-20' },
                    { id: 'ss002', anggotaId: 'ang002', jumlah: 300000, tanggal: '2024-01-25' }
                ];
                localStorage.setItem('simpananSukarela', JSON.stringify(simpananSukarela));
                
                result.innerHTML = '<div class="test-result success">‚úÖ Test data berhasil di-setup!</div>';
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function clearTestData() {
            localStorage.removeItem('anggota');
            localStorage.removeItem('penjualan');
            localStorage.removeItem('simpananPokok');
            localStorage.removeItem('simpananWajib');
            localStorage.removeItem('simpananSukarela');
            
            document.getElementById('setupResult').innerHTML = 
                '<div class="test-result success">‚ÑπÔ∏è Test data cleared</div>';
            document.getElementById('mainContent').innerHTML = '';
        }
        
        function testRenderReport() {
            const result = document.getElementById('test1Result');
            
            try {
                // Render the report
                renderLaporanTransaksiSimpananAnggota();
                
                // Check if mainContent has content
                const mainContent = document.getElementById('mainContent');
                if (mainContent && mainContent.innerHTML.trim() !== '') {
                    result.innerHTML = '<div class="test-result success">‚úÖ Report rendered successfully!</div>';
                } else {
                    result.innerHTML = '<div class="test-result error">‚ùå Report rendering failed - no content</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testStatisticsCards() {
            const result = document.getElementById('test2Result');
            let html = '';
            
            try {
                // Check if statistics cards exist
                const statTotalAnggota = document.getElementById('statTotalAnggota');
                const statTotalTransaksi = document.getElementById('statTotalTransaksi');
                const statTotalSimpanan = document.getElementById('statTotalSimpanan');
                const statTotalOutstanding = document.getElementById('statTotalOutstanding');
                
                if (statTotalAnggota) {
                    html += `<div class="test-result success">‚úÖ Total Anggota Card: ${statTotalAnggota.textContent}</div>`;
                } else {
                    html += '<div class="test-result error">‚ùå Total Anggota Card not found</div>';
                }
                
                if (statTotalTransaksi) {
                    html += `<div class="test-result success">‚úÖ Total Transaksi Card: ${statTotalTransaksi.textContent}</div>`;
                } else {
                    html += '<div class="test-result error">‚ùå Total Transaksi Card not found</div>';
                }
                
                if (statTotalSimpanan) {
                    html += `<div class="test-result success">‚úÖ Total Simpanan Card: ${statTotalSimpanan.textContent}</div>`;
                } else {
                    html += '<div class="test-result error">‚ùå Total Simpanan Card not found</div>';
                }
                
                if (statTotalOutstanding) {
                    html += `<div class="test-result success">‚úÖ Total Outstanding Card: ${statTotalOutstanding.textContent}</div>`;
                } else {
                    html += '<div class="test-result error">‚ùå Total Outstanding Card not found</div>';
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testDataTable() {
            const result = document.getElementById('test3Result');
            let html = '';
            
            try {
                const table = document.getElementById('tableLaporanAnggota');
                const tbody = document.getElementById('tbodyLaporanAnggota');
                
                if (table) {
                    html += '<div class="test-result success">‚úÖ Table exists</div>';
                    
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr');
                        html += `<div class="test-result success">‚úÖ Table has ${rows.length} rows</div>`;
                        
                        // Check if anggota keluar is excluded
                        const hasKeluarAnggota = Array.from(rows).some(row => 
                            row.textContent.includes('Ahmad Keluar')
                        );
                        
                        if (!hasKeluarAnggota) {
                            html += '<div class="test-result success">‚úÖ Anggota Keluar correctly excluded</div>';
                        } else {
                            html += '<div class="test-result error">‚ùå Anggota Keluar should be excluded</div>';
                        }
                    } else {
                        html += '<div class="test-result error">‚ùå Table body not found</div>';
                    }
                } else {
                    html += '<div class="test-result error">‚ùå Table not found</div>';
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testActionButtons() {
            const result = document.getElementById('test4Result');
            let html = '';
            
            try {
                // Test detail buttons
                const detailButtons = document.querySelectorAll('button[onclick^="showDetailTransaksi"]');
                const simpananButtons = document.querySelectorAll('button[onclick^="showDetailSimpanan"]');
                
                html += `<div class="test-result success">‚úÖ Found ${detailButtons.length} detail transaksi buttons</div>`;
                html += `<div class="test-result success">‚úÖ Found ${simpananButtons.length} detail simpanan buttons</div>`;
                
                // Test if buttons are clickable (placeholder functions should show alert)
                if (detailButtons.length > 0) {
                    html += '<div class="test-result success">‚úÖ Detail buttons are rendered</div>';
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
