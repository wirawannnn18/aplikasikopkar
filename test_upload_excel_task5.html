<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upload Excel Task 5 - Data Preview & UI</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .test-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .test-result {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.25rem 0;
        }
        
        .test-success {
            background-color: #d1edff;
            border-left: 4px solid #0d6efd;
        }
        
        .test-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .preview-table {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .validation-badge {
            font-size: 0.75rem;
            margin-left: 0.25rem;
        }
        
        .modal-xl {
            max-width: 90%;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-vial me-2"></i>Test Upload Excel Task 5
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-arrow-left me-1"></i>Kembali ke Menu Utama
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="mb-0">
                    <i class="fas fa-clipboard-check me-3 text-primary"></i>Test Task 5: Data Preview & UI
                </h1>
                <p class="text-muted mt-2">Testing interactive data preview table, wizard interface, and template functionality</p>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-play me-2"></i>Test Controls</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" id="testUIManager">
                                    <i class="fas fa-table me-2"></i>Test UI Manager
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-success w-100" id="testTemplateManager">
                                    <i class="fas fa-file-download me-2"></i>Test Template Manager
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-info w-100" id="testWizardNavigation">
                                    <i class="fas fa-route me-2"></i>Test Wizard Navigation
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-warning w-100" id="runAllTests">
                                    <i class="fas fa-play-circle me-2"></i>Run All Tests
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Results -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-list-check me-2"></i>Test Results</h5>
                        <span class="badge bg-secondary" id="testCounter">0 tests run</span>
                    </div>
                    <div class="card-body" id="testResults">
                        <div class="text-center text-muted">
                            <i class="fas fa-info-circle fa-2x mb-2"></i>
                            <p>Click a test button to start testing</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Preview Demo -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Interactive Preview Demo</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" id="loadSampleData">
                                <i class="fas fa-database me-1"></i>Load Sample Data
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="showDocumentation">
                                <i class="fas fa-book me-1"></i>Show Documentation
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Filter Controls -->
                        <div class="row mb-3" id="filterContainer" style="display: none;">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchInput" placeholder="Cari data...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="categoryFilter">
                                    <option value="">Semua Kategori</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="unitFilter">
                                    <option value="">Semua Satuan</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-secondary w-100" id="clearFiltersBtn">
                                    <i class="fas fa-times me-1"></i>Clear
                                </button>
                            </div>
                        </div>

                        <!-- Preview Table -->
                        <div class="preview-table">
                            <table class="table table-striped table-hover" id="previewTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th><input type="checkbox" id="selectAll" class="form-check-input"></th>
                                        <th style="cursor: pointer;">Kode <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Nama <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Kategori <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Satuan <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Harga Beli <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Stok <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th style="cursor: pointer;">Supplier <i class="fas fa-sort ms-2 text-muted"></i></th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                    <tr>
                                        <td colspan="9" class="text-center text-muted">
                                            <i class="fas fa-info-circle me-2"></i>Click "Load Sample Data" to see interactive preview
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Selection Info -->
                        <div class="mt-3" id="selectionInfo" style="display: none;">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <span id="selectionText">0 items selected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Core Components -->
    <script src="js/upload-excel/types.js"></script>
    <script src="js/upload-excel/UIManager.js"></script>
    <script src="js/upload-excel/TemplateManager.js"></script>
    
    <!-- Test Script -->
    <script>
        // Global variables
        let uiManager;
        let templateManager;
        let testCount = 0;
        let sampleData = [];

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test Upload Excel Task 5 - Initializing...');
            
            try {
                // Initialize managers
                uiManager = new UIManager();
                templateManager = new TemplateManager();
                
                // Setup event listeners
                setupEventListeners();
                
                console.log('Test Upload Excel Task 5 - Ready!');
            } catch (error) {
                console.error('Error initializing test application:', error);
                addTestResult('Initialization Error', error.message, false);
            }
        });

        // Setup event listeners
        function setupEventListeners() {
            // Test buttons
            document.getElementById('testUIManager').addEventListener('click', testUIManager);
            document.getElementById('testTemplateManager').addEventListener('click', testTemplateManager);
            document.getElementById('testWizardNavigation').addEventListener('click', testWizardNavigation);
            document.getElementById('runAllTests').addEventListener('click', runAllTests);
            
            // Demo buttons
            document.getElementById('loadSampleData').addEventListener('click', loadSampleData);
            document.getElementById('showDocumentation').addEventListener('click', showDocumentation);
            
            // Filter controls
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('unitFilter').addEventListener('change', applyFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
            
            // Table sorting
            const headers = document.querySelectorAll('#previewTable th[style*="cursor"]');
            headers.forEach((header, index) => {
                header.addEventListener('click', () => sortTable(index - 1)); // -1 for checkbox column
            });
            
            // Select all checkbox
            document.getElementById('selectAll').addEventListener('change', toggleSelectAll);
        }

        // Test UI Manager functionality
        function testUIManager() {
            addTestResult('UI Manager Test', 'Starting UI Manager tests...', true);
            
            try {
                // Test 1: Initialize UI Manager
                const testUIManager = new UIManager();
                addTestResult('UI Manager Init', 'UI Manager initialized successfully', true);
                
                // Test 2: Set sample data
                const testData = generateTestData(10);
                testUIManager.setUploadedData(testData);
                addTestResult('Set Data', `Set ${testData.length} records successfully`, true);
                
                // Test 3: Test sorting
                const sortedData = testUIManager.sortTable(0); // Sort by kode
                if (sortedData && sortedData.length === testData.length) {
                    addTestResult('Table Sorting', 'Table sorting works correctly', true);
                } else {
                    addTestResult('Table Sorting', 'Table sorting failed', false);
                }
                
                // Test 4: Test filtering
                const filteredData = testUIManager.applyFilters({ search: 'BRG' });
                if (Array.isArray(filteredData)) {
                    addTestResult('Data Filtering', `Filtering returned ${filteredData.length} results`, true);
                } else {
                    addTestResult('Data Filtering', 'Filtering failed', false);
                }
                
                // Test 5: Test row selection
                testUIManager.selectRows([0, 1, 2], true);
                const selectedRows = testUIManager.getSelectedRows();
                if (selectedRows.length === 3) {
                    addTestResult('Row Selection', 'Row selection works correctly', true);
                } else {
                    addTestResult('Row Selection', 'Row selection failed', false);
                }
                
                // Test 6: Test statistics
                const stats = testUIManager.getTableStatistics();
                if (stats && typeof stats.total === 'number') {
                    addTestResult('Table Statistics', `Statistics: ${stats.total} total, ${stats.selected} selected`, true);
                } else {
                    addTestResult('Table Statistics', 'Statistics generation failed', false);
                }
                
                addTestResult('UI Manager Test', 'UI Manager tests completed successfully', true);
                
            } catch (error) {
                addTestResult('UI Manager Test', `Error: ${error.message}`, false);
            }
        }

        // Test Template Manager functionality
        function testTemplateManager() {
            addTestResult('Template Manager Test', 'Starting Template Manager tests...', true);
            
            try {
                // Test 1: Initialize Template Manager
                const testTemplateManager = new TemplateManager();
                addTestResult('Template Manager Init', 'Template Manager initialized successfully', true);
                
                // Test 2: Generate CSV content
                const csvContent = testTemplateManager.generateCSVContent(testTemplateManager.templateData);
                if (csvContent && csvContent.length > 0) {
                    addTestResult('CSV Generation', `Generated CSV with ${csvContent.split('\n').length - 1} lines`, true);
                } else {
                    addTestResult('CSV Generation', 'CSV generation failed', false);
                }
                
                // Test 3: Template download
                const downloadSuccess = testTemplateManager.downloadCSVTemplate('test_template.csv');
                addTestResult('Template Download', downloadSuccess ? 'Download successful' : 'Download failed', downloadSuccess);
                
                // Test 4: Template validation
                const testData = generateTestData(5);
                const validation = testTemplateManager.validateTemplateStructure(testData);
                if (validation && typeof validation.valid === 'boolean') {
                    addTestResult('Template Validation', `Validation result: ${validation.valid ? 'Valid' : 'Invalid'}`, true);
                } else {
                    addTestResult('Template Validation', 'Validation failed', false);
                }
                
                // Test 5: Template statistics
                const stats = testTemplateManager.getTemplateStatistics();
                if (stats && typeof stats.recordCount === 'number') {
                    addTestResult('Template Statistics', `${stats.recordCount} records, ${stats.categories.length} categories`, true);
                } else {
                    addTestResult('Template Statistics', 'Statistics generation failed', false);
                }
                
                // Test 6: Documentation search
                const searchResults = testTemplateManager.searchDocumentation('kode');
                if (Array.isArray(searchResults)) {
                    addTestResult('Documentation Search', `Found ${searchResults.length} results for 'kode'`, true);
                } else {
                    addTestResult('Documentation Search', 'Search failed', false);
                }
                
                // Test 7: Field help
                const fieldHelp = testTemplateManager.getFieldHelp('kode');
                if (fieldHelp && fieldHelp.name === 'kode') {
                    addTestResult('Field Help', 'Field help generation works correctly', true);
                } else {
                    addTestResult('Field Help', 'Field help generation failed', false);
                }
                
                addTestResult('Template Manager Test', 'Template Manager tests completed successfully', true);
                
            } catch (error) {
                addTestResult('Template Manager Test', `Error: ${error.message}`, false);
            }
        }

        // Test Wizard Navigation (mock implementation)
        function testWizardNavigation() {
            addTestResult('Wizard Navigation Test', 'Starting Wizard Navigation tests...', true);
            
            try {
                // Mock wizard manager for testing
                const wizardManager = {
                    currentStep: 1,
                    maxSteps: 4,
                    stepData: {
                        1: { completed: false, valid: false },
                        2: { completed: false, valid: false },
                        3: { completed: false, valid: false },
                        4: { completed: false, valid: false }
                    },
                    
                    goToStep: function(step) {
                        if (step >= 1 && step <= this.maxSteps) {
                            this.currentStep = step;
                            return true;
                        }
                        return false;
                    },
                    
                    completeStep: function(step) {
                        if (this.stepData[step]) {
                            this.stepData[step].completed = true;
                            this.stepData[step].valid = true;
                            return true;
                        }
                        return false;
                    },
                    
                    getProgress: function() {
                        const completed = Object.values(this.stepData).filter(s => s.completed).length;
                        return {
                            currentStep: this.currentStep,
                            completedSteps: completed,
                            totalSteps: this.maxSteps,
                            progressPercentage: (completed / this.maxSteps) * 100
                        };
                    }
                };
                
                // Test 1: Initial state
                addTestResult('Wizard Init', `Started at step ${wizardManager.currentStep}`, true);
                
                // Test 2: Step navigation
                const navSuccess = wizardManager.goToStep(2);
                if (navSuccess && wizardManager.currentStep === 2) {
                    addTestResult('Step Navigation', 'Navigation to step 2 successful', true);
                } else {
                    addTestResult('Step Navigation', 'Navigation failed', false);
                }
                
                // Test 3: Step completion
                const completeSuccess = wizardManager.completeStep(2);
                if (completeSuccess && wizardManager.stepData[2].completed) {
                    addTestResult('Step Completion', 'Step 2 completed successfully', true);
                } else {
                    addTestResult('Step Completion', 'Step completion failed', false);
                }
                
                // Test 4: Progress tracking
                const progress = wizardManager.getProgress();
                if (progress && progress.completedSteps === 1) {
                    addTestResult('Progress Tracking', `Progress: ${progress.progressPercentage}%`, true);
                } else {
                    addTestResult('Progress Tracking', 'Progress tracking failed', false);
                }
                
                // Test 5: Invalid navigation
                const invalidNav = wizardManager.goToStep(10);
                if (!invalidNav && wizardManager.currentStep === 2) {
                    addTestResult('Invalid Navigation', 'Invalid navigation properly rejected', true);
                } else {
                    addTestResult('Invalid Navigation', 'Invalid navigation not handled', false);
                }
                
                addTestResult('Wizard Navigation Test', 'Wizard Navigation tests completed successfully', true);
                
            } catch (error) {
                addTestResult('Wizard Navigation Test', `Error: ${error.message}`, false);
            }
        }

        // Run all tests
        function runAllTests() {
            clearTestResults();
            addTestResult('All Tests', 'Starting comprehensive test suite...', true);
            
            setTimeout(() => testUIManager(), 100);
            setTimeout(() => testTemplateManager(), 500);
            setTimeout(() => testWizardNavigation(), 900);
            
            setTimeout(() => {
                addTestResult('All Tests', 'All tests completed!', true);
            }, 1300);
        }

        // Load sample data for demo
        function loadSampleData() {
            try {
                sampleData = generateTestData(15);
                uiManager.setUploadedData(sampleData);
                
                // Show filter controls
                document.getElementById('filterContainer').style.display = 'flex';
                document.getElementById('selectionInfo').style.display = 'block';
                
                // Render table
                renderPreviewTable(sampleData);
                
                addTestResult('Sample Data', `Loaded ${sampleData.length} sample records`, true);
            } catch (error) {
                addTestResult('Sample Data', `Error loading sample data: ${error.message}`, false);
            }
        }

        // Show documentation modal
        function showDocumentation() {
            try {
                templateManager.showDocumentation();
                addTestResult('Documentation', 'Documentation modal opened', true);
            } catch (error) {
                addTestResult('Documentation', `Error showing documentation: ${error.message}`, false);
            }
        }

        // Render preview table
        function renderPreviewTable(data) {
            const tableBody = document.getElementById('previewTableBody');
            tableBody.innerHTML = '';
            
            // Populate filter options
            populateFilterOptions(data);
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <input type="checkbox" class="form-check-input row-select" data-index="${index}">
                    </td>
                    <td>
                        <span class="fw-bold">${escapeHtml(row.kode)}</span>
                    </td>
                    <td>${escapeHtml(row.nama)}</td>
                    <td>
                        <span class="badge bg-secondary">${escapeHtml(row.kategori)}</span>
                    </td>
                    <td>
                        <span class="badge bg-info">${escapeHtml(row.satuan)}</span>
                    </td>
                    <td>${formatCurrency(row.harga_beli)}</td>
                    <td>${formatNumber(row.stok)}</td>
                    <td>${escapeHtml(row.supplier || '-')}</td>
                    <td>
                        <span class="badge bg-success">
                            <i class="fas fa-check me-1"></i>Valid
                        </span>
                    </td>
                `;
                
                // Add click handler for row details
                tr.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox') {
                        showRowDetails(row, index);
                    }
                });
                
                tableBody.appendChild(tr);
            });
            
            // Setup row selection handlers
            document.querySelectorAll('.row-select').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectionInfo);
            });
            
            updateSelectionInfo();
        }

        // Populate filter options
        function populateFilterOptions(data) {
            const categories = [...new Set(data.map(row => row.kategori))];
            const units = [...new Set(data.map(row => row.satuan))];
            
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">Semua Kategori</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
            
            const unitFilter = document.getElementById('unitFilter');
            unitFilter.innerHTML = '<option value="">Semua Satuan</option>';
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = unit;
                unitFilter.appendChild(option);
            });
        }

        // Apply filters
        function applyFilters() {
            if (!sampleData.length) return;
            
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const unitFilter = document.getElementById('unitFilter').value;
            
            const filteredData = sampleData.filter(row => {
                const searchMatch = !searchTerm || 
                    Object.values(row).some(value => 
                        value && value.toString().toLowerCase().includes(searchTerm)
                    );
                
                const categoryMatch = !categoryFilter || row.kategori === categoryFilter;
                const unitMatch = !unitFilter || row.satuan === unitFilter;
                
                return searchMatch && categoryMatch && unitMatch;
            });
            
            renderPreviewTable(filteredData);
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('unitFilter').value = '';
            
            if (sampleData.length) {
                renderPreviewTable(sampleData);
            }
        }

        // Sort table
        function sortTable(columnIndex) {
            if (!sampleData.length) return;
            
            const columnNames = ['kode', 'nama', 'kategori', 'satuan', 'harga_beli', 'stok', 'supplier'];
            const columnName = columnNames[columnIndex];
            
            if (!columnName) return;
            
            const sortedData = [...sampleData].sort((a, b) => {
                let aVal = a[columnName] || '';
                let bVal = b[columnName] || '';
                
                if (columnName === 'harga_beli' || columnName === 'stok') {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                } else {
                    aVal = aVal.toString().toLowerCase();
                    bVal = bVal.toString().toLowerCase();
                }
                
                return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
            });
            
            renderPreviewTable(sortedData);
        }

        // Toggle select all
        function toggleSelectAll(e) {
            const checkboxes = document.querySelectorAll('.row-select');
            checkboxes.forEach(checkbox => {
                checkbox.checked = e.target.checked;
            });
            updateSelectionInfo();
        }

        // Update selection info
        function updateSelectionInfo() {
            const selectedCount = document.querySelectorAll('.row-select:checked').length;
            const totalCount = document.querySelectorAll('.row-select').length;
            
            document.getElementById('selectionText').textContent = 
                `${selectedCount} of ${totalCount} items selected`;
        }

        // Show row details modal
        function showRowDetails(row, index) {
            const modalHtml = `
                <div class="modal fade" id="rowDetailsModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Detail Data Barang - ${escapeHtml(row.kode)}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Data Barang</h6>
                                        <table class="table table-sm">
                                            <tr><td><strong>Kode:</strong></td><td>${escapeHtml(row.kode)}</td></tr>
                                            <tr><td><strong>Nama:</strong></td><td>${escapeHtml(row.nama)}</td></tr>
                                            <tr><td><strong>Kategori:</strong></td><td>${escapeHtml(row.kategori)}</td></tr>
                                            <tr><td><strong>Satuan:</strong></td><td>${escapeHtml(row.satuan)}</td></tr>
                                            <tr><td><strong>Harga Beli:</strong></td><td>${formatCurrency(row.harga_beli)}</td></tr>
                                            <tr><td><strong>Stok:</strong></td><td>${formatNumber(row.stok)}</td></tr>
                                            <tr><td><strong>Supplier:</strong></td><td>${escapeHtml(row.supplier || '-')}</td></tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Status Validasi</h6>
                                        <div class="alert alert-success">
                                            <i class="fas fa-check me-2"></i>Semua data valid
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal
            const existingModal = document.getElementById('rowDetailsModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add new modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('rowDetailsModal'));
            modal.show();
        }

        // Generate test data
        function generateTestData(count) {
            const categories = ['makanan', 'minuman', 'alat-tulis', 'elektronik', 'kebersihan'];
            const units = ['pcs', 'kg', 'liter', 'box', 'botol'];
            const suppliers = ['PT Supplier A', 'CV Supplier B', 'Toko Supplier C', 'UD Supplier D'];
            
            const data = [];
            for (let i = 1; i <= count; i++) {
                data.push({
                    kode: `BRG${String(i).padStart(3, '0')}`,
                    nama: `Produk Test ${i}`,
                    kategori: categories[Math.floor(Math.random() * categories.length)],
                    satuan: units[Math.floor(Math.random() * units.length)],
                    harga_beli: Math.floor(Math.random() * 100000) + 1000,
                    stok: Math.floor(Math.random() * 100),
                    supplier: suppliers[Math.floor(Math.random() * suppliers.length)]
                });
            }
            return data;
        }

        // Add test result
        function addTestResult(testName, message, success) {
            testCount++;
            
            const resultsContainer = document.getElementById('testResults');
            
            // Clear initial message
            if (testCount === 1) {
                resultsContainer.innerHTML = '';
            }
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-success' : 'test-error'}`;
            resultDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas ${success ? 'fa-check-circle text-success' : 'fa-times-circle text-danger'} me-2"></i>
                        <strong>${testName}:</strong> ${message}
                    </div>
                    <small class="text-muted">${new Date().toLocaleTimeString()}</small>
                </div>
            `;
            
            resultsContainer.appendChild(resultDiv);
            
            // Update counter
            document.getElementById('testCounter').textContent = `${testCount} tests run`;
            
            // Scroll to bottom
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }

        // Clear test results
        function clearTestResults() {
            testCount = 0;
            document.getElementById('testResults').innerHTML = `
                <div class="text-center text-muted">
                    <i class="fas fa-info-circle fa-2x mb-2"></i>
                    <p>Running tests...</p>
                </div>
            `;
            document.getElementById('testCounter').textContent = '0 tests run';
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount || 0);
        }

        function formatNumber(number) {
            return new Intl.NumberFormat('id-ID').format(number || 0);
        }
    </script>
</body>
</html>