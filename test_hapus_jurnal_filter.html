<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Hapus Jurnal dengan Filter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test Fitur Hapus Jurnal dengan Filter</h2>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Setup Test Data</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="setupTestData()">Setup Test Data</button>
                <button class="btn btn-secondary ms-2" onclick="clearTestData()">Clear Test Data</button>
                <button class="btn btn-info ms-2" onclick="showCurrentData()">Show Current Data</button>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Test Results</h5>
            </div>
            <div class="card-body">
                <div id="testResults"></div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Manual Test</h5>
            </div>
            <div class="card-body">
                <p>Untuk test manual:</p>
                <ol>
                    <li>Klik "Setup Test Data" untuk membuat data test</li>
                    <li>Login sebagai super admin (superadmin/super123)</li>
                    <li>Buka menu Jurnal</li>
                    <li>Coba filter berdasarkan tanggal</li>
                    <li>Klik tombol hapus pada salah satu jurnal</li>
                    <li>Isi alasan penghapusan</li>
                    <li>Konfirmasi penghapusan</li>
                    <li>Verifikasi jurnal terhapus dan saldo COA ter-update</li>
                </ol>
                <a href="index.html" class="btn btn-success">Buka Aplikasi</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/filterHapusJurnal.js"></script>
    
    <script>
        function setupTestData() {
            // Setup user
            const users = [
                {
                    id: 'user1',
                    username: 'superadmin',
                    password: 'super123',
                    nama: 'Super Admin',
                    role: 'administrator'
                }
            ];
            localStorage.setItem('users', JSON.stringify(users));
            
            // Setup COA
            const coa = [
                { kode: '1-1000', nama: 'Kas', tipe: 'Aset', saldo: 10000000 },
                { kode: '1-1100', nama: 'Bank', tipe: 'Aset', saldo: 5000000 },
                { kode: '4-1000', nama: 'Pendapatan Penjualan', tipe: 'Pendapatan', saldo: 0 },
                { kode: '5-1000', nama: 'Beban Operasional', tipe: 'Beban', saldo: 0 }
            ];
            localStorage.setItem('coa', JSON.stringify(coa));
            
            // Setup Jurnal
            const jurnal = [
                {
                    id: 'jurnal1',
                    tanggal: '2024-01-15',
                    keterangan: 'Penjualan Tunai',
                    entries: [
                        { akun: '1-1000', debit: 1000000, kredit: 0 },
                        { akun: '4-1000', debit: 0, kredit: 1000000 }
                    ],
                    reconciled: false,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                },
                {
                    id: 'jurnal2',
                    tanggal: '2024-01-20',
                    keterangan: 'Pembayaran Beban',
                    entries: [
                        { akun: '5-1000', debit: 500000, kredit: 0 },
                        { akun: '1-1000', debit: 0, kredit: 500000 }
                    ],
                    reconciled: false,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                },
                {
                    id: 'jurnal3',
                    tanggal: '2024-02-10',
                    keterangan: 'Transfer ke Bank',
                    entries: [
                        { akun: '1-1100', debit: 2000000, kredit: 0 },
                        { akun: '1-1000', debit: 0, kredit: 2000000 }
                    ],
                    reconciled: false,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                }
            ];
            localStorage.setItem('jurnal', JSON.stringify(jurnal));
            
            // Initialize audit log
            localStorage.setItem('auditLog', JSON.stringify([]));
            
            // Initialize closed periods
            localStorage.setItem('closedPeriods', JSON.stringify([]));
            
            showMessage('Test data berhasil dibuat!', 'success');
            showCurrentData();
        }
        
        function clearTestData() {
            localStorage.removeItem('jurnal');
            localStorage.removeItem('coa');
            localStorage.removeItem('auditLog');
            localStorage.removeItem('closedPeriods');
            localStorage.removeItem('currentUser');
            showMessage('Test data berhasil dihapus!', 'info');
            document.getElementById('testResults').innerHTML = '';
        }
        
        function showCurrentData() {
            const jurnal = JSON.parse(localStorage.getItem('jurnal') || '[]');
            const coa = JSON.parse(localStorage.getItem('coa') || '[]');
            const auditLog = JSON.parse(localStorage.getItem('auditLog') || '[]');
            
            let html = '<h6>Data Jurnal:</h6>';
            html += '<pre>' + JSON.stringify(jurnal, null, 2) + '</pre>';
            
            html += '<h6 class="mt-3">Data COA:</h6>';
            html += '<pre>' + JSON.stringify(coa, null, 2) + '</pre>';
            
            html += '<h6 class="mt-3">Audit Log:</h6>';
            html += '<pre>' + JSON.stringify(auditLog, null, 2) + '</pre>';
            
            document.getElementById('testResults').innerHTML = html;
        }
        
        function showMessage(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.getElementById('testResults').prepend(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
