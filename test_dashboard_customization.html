<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Customization Test</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Dashboard Styles -->
    <link href="css/dashboard-responsive.css" rel="stylesheet">
    <link href="css/dashboard-customization.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        
        #dashboard-container {
            position: relative;
            min-height: 600px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dashboard-widget {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            min-height: 150px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .widget-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
            color: #333;
        }
        
        .widget-content {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 4px;
            color: #666;
        }
        
        .test-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.active {
            background: #28a745;
        }
        
        .status-indicator.inactive {
            background: #dc3545;
        }
        
        .demo-kpi {
            text-align: center;
        }
        
        .demo-kpi .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .demo-kpi .kpi-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .demo-chart {
            height: 120px;
            background: linear-gradient(45deg, #007bff, #6610f2);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Dashboard Customization Test</h2>
                    <button id="customize-dashboard-btn" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Customize Dashboard
                    </button>
                </div>
            </div>
        </div>
        
        <div id="dashboard-container">
            <!-- Sample Widgets -->
            <div id="widget-1" class="dashboard-widget" data-type="kpi" style="width: 250px; height: 180px; position: absolute; top: 20px; left: 20px;">
                <div class="widget-header">
                    <h5 class="widget-title">Total Members</h5>
                </div>
                <div class="widget-content demo-kpi">
                    <div>
                        <div class="kpi-value">1,247</div>
                        <div class="kpi-label">Active Members</div>
                    </div>
                </div>
            </div>
            
            <div id="widget-2" class="dashboard-widget" data-type="chart" style="width: 300px; height: 200px; position: absolute; top: 20px; left: 290px;">
                <div class="widget-header">
                    <h5 class="widget-title">Monthly Revenue</h5>
                </div>
                <div class="widget-content">
                    <div class="demo-chart">
                        Chart Visualization
                    </div>
                </div>
            </div>
            
            <div id="widget-3" class="dashboard-widget" data-type="kpi" style="width: 250px; height: 180px; position: absolute; top: 20px; left: 610px;">
                <div class="widget-header">
                    <h5 class="widget-title">Total Savings</h5>
                </div>
                <div class="widget-content demo-kpi">
                    <div>
                        <div class="kpi-value">Rp 2.5M</div>
                        <div class="kpi-label">Total Amount</div>
                    </div>
                </div>
            </div>
            
            <div id="widget-4" class="dashboard-widget" data-type="table" style="width: 400px; height: 220px; position: absolute; top: 240px; left: 20px;">
                <div class="widget-header">
                    <h5 class="widget-title">Recent Transactions</h5>
                </div>
                <div class="widget-content">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-01-15</td>
                                <td>Deposit</td>
                                <td>Rp 500K</td>
                            </tr>
                            <tr>
                                <td>2024-01-14</td>
                                <td>Loan</td>
                                <td>Rp 1M</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="widget-5" class="dashboard-widget" data-type="gauge" style="width: 280px; height: 220px; position: absolute; top: 240px; left: 440px;">
                <div class="widget-header">
                    <h5 class="widget-title">Financial Health</h5>
                </div>
                <div class="widget-content demo-kpi">
                    <div>
                        <div class="kpi-value" style="color: #28a745;">85%</div>
                        <div class="kpi-label">Health Score</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Test Controls -->
    <div class="test-controls">
        <h6>Test Controls</h6>
        <div class="mb-2">
            <span class="status-indicator" id="customization-status"></span>
            <span id="customization-text">Customization: Inactive</span>
        </div>
        <div class="d-grid gap-2">
            <button id="test-add-widget" class="btn btn-sm btn-outline-primary">Test Add Widget</button>
            <button id="test-save-layout" class="btn btn-sm btn-outline-success">Test Save Layout</button>
            <button id="test-reset-layout" class="btn btn-sm btn-outline-warning">Test Reset Layout</button>
            <button id="test-themes" class="btn btn-sm btn-outline-info">Test Themes</button>
        </div>
    </div>
    
    <!-- Mock Dashboard Controller -->
    <script>
        // Mock Dashboard Controller for testing
        class MockDashboardController {
            constructor() {
                this.currentUser = { id: 'test-user' };
                this.widgetManager = new MockWidgetManager();
            }
            
            loadDefaultLayout() {
                console.log('Loading default layout...');
                // Reset widgets to original positions
                const widgets = [
                    { id: 'widget-1', x: 20, y: 20, width: 250, height: 180 },
                    { id: 'widget-2', x: 290, y: 20, width: 300, height: 200 },
                    { id: 'widget-3', x: 610, y: 20, width: 250, height: 180 },
                    { id: 'widget-4', x: 20, y: 240, width: 400, height: 220 },
                    { id: 'widget-5', x: 440, y: 240, width: 280, height: 220 }
                ];
                
                widgets.forEach(w => {
                    const widget = document.getElementById(w.id);
                    if (widget) {
                        widget.style.left = w.x + 'px';
                        widget.style.top = w.y + 'px';
                        widget.style.width = w.width + 'px';
                        widget.style.height = w.height + 'px';
                        widget.style.position = 'absolute';
                    }
                });
            }
        }
        
        class MockWidgetManager {
            constructor() {
                this.widgetCounter = 6;
            }
            
            async createWidget(type, config) {
                const widgetId = `widget-${this.widgetCounter++}`;
                const widget = document.createElement('div');
                widget.id = widgetId;
                widget.className = 'dashboard-widget';
                widget.dataset.type = type;
                widget.style.width = config.size.width + 'px';
                widget.style.height = config.size.height + 'px';
                widget.style.position = 'absolute';
                widget.style.left = config.position.x + 'px';
                widget.style.top = config.position.y + 'px';
                
                widget.innerHTML = `
                    <div class="widget-header">
                        <h5 class="widget-title">${config.title}</h5>
                    </div>
                    <div class="widget-content">
                        <div style="text-align: center; color: #666;">
                            New ${type} widget
                        </div>
                    </div>
                `;
                
                document.getElementById('dashboard-container').appendChild(widget);
                return widget;
            }
            
            removeWidget(widgetId) {
                console.log('Removing widget:', widgetId);
            }
            
            updateWidgetConfig(widgetId, config) {
                console.log('Updating widget config:', widgetId, config);
            }
            
            refreshWidget(widgetId) {
                console.log('Refreshing widget:', widgetId);
            }
        }
    </script>
    
    <!-- Dashboard Customizer -->
    <script src="js/dashboard/DashboardCustomizer.js"></script>
    
    <script>
        // Initialize dashboard customizer
        const mockController = new MockDashboardController();
        const customizer = new DashboardCustomizer(mockController);
        
        // Update status indicator
        function updateStatus() {
            const statusIndicator = document.getElementById('customization-status');
            const statusText = document.getElementById('customization-text');
            
            if (customizer.isCustomizationMode()) {
                statusIndicator.className = 'status-indicator active';
                statusText.textContent = 'Customization: Active';
            } else {
                statusIndicator.className = 'status-indicator inactive';
                statusText.textContent = 'Customization: Inactive';
            }
        }
        
        // Update status initially and on changes
        updateStatus();
        setInterval(updateStatus, 1000);
        
        // Test controls
        document.getElementById('test-add-widget').addEventListener('click', () => {
            if (customizer.isCustomizationMode()) {
                customizer.showAddWidgetModal();
            } else {
                alert('Please enter customization mode first');
            }
        });
        
        document.getElementById('test-save-layout').addEventListener('click', () => {
            customizer.saveLayout();
        });
        
        document.getElementById('test-reset-layout').addEventListener('click', () => {
            customizer.resetLayout();
        });
        
        document.getElementById('test-themes').addEventListener('click', () => {
            const widgets = document.querySelectorAll('.dashboard-widget');
            const themes = ['default', 'dark', 'light', 'colorful'];
            
            widgets.forEach((widget, index) => {
                const theme = themes[index % themes.length];
                widget.className = widget.className.replace(/theme-\w+/g, '');
                widget.classList.add(`theme-${theme}`);
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'e':
                        e.preventDefault();
                        document.getElementById('customize-dashboard-btn').click();
                        break;
                    case 's':
                        e.preventDefault();
                        if (customizer.isCustomizationMode()) {
                            customizer.saveLayout();
                        }
                        break;
                    case 'Escape':
                        if (customizer.isCustomizationMode()) {
                            customizer.exitCustomizationMode();
                        }
                        break;
                }
            }
        });
        
        // Log events for testing
        console.log('Dashboard Customization Test initialized');
        console.log('Available keyboard shortcuts:');
        console.log('- Ctrl+E: Toggle customization mode');
        console.log('- Ctrl+S: Save layout (in customization mode)');
        console.log('- Escape: Exit customization mode');
    </script>
</body>
</html>