<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS System - Improved Design</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style>
        /* Enhanced POS Styles */
        .pos-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9f5f0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .pos-header {
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(45, 106, 79, 0.3);
        }

        .pos-search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(45, 106, 79, 0.1);
            margin-bottom: 20px;
        }

        .pos-search-input {
            border: 3px solid #e9f5f0;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .pos-search-input:focus {
            border-color: #52b788;
            box-shadow: 0 0 0 0.25rem rgba(82, 183, 136, 0.25);
            transform: translateY(-2px);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .product-card:hover {
            transform: translateY(-5px);
            border-color: #52b788;
            box-shadow: 0 8px 25px rgba(82, 183, 136, 0.2);
        }

        .product-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #52b788, #74c69d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-size: 1.5rem;
        }

        .product-name {
            font-weight: 600;
            color: #2d6a4f;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .product-price {
            color: #52b788;
            font-weight: bold;
            font-size: 1rem;
        }

        .product-stock {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .cart-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(45, 106, 79, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .cart-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9f5f0;
        }

        .cart-icon {
            background: linear-gradient(135deg, #52b788, #74c69d);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .member-select {
            background: #f8f9fa;
            border: 2px solid #e9f5f0;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
        }

        .member-dropdown {
            position: relative;
        }

        .member-input {
            border: 2px solid #e9f5f0;
            border-radius: 8px;
            padding: 10px 15px;
            width: 100%;
        }

        .member-dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e9f5f0;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .member-option {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s;
        }

        .member-option:hover {
            background-color: #e9f5f0;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: #2d6a4f;
            font-size: 0.9rem;
        }

        .cart-item-price {
            color: #52b788;
            font-size: 0.8rem;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            background: #e9f5f0;
            color: #2d6a4f;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: #52b788;
            color: white;
        }

        .qty-display {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
        }

        .cart-total {
            background: linear-gradient(135deg, #e9f5f0, #f8f9fa);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .total-amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2d6a4f;
            text-align: center;
        }

        .payment-section {
            margin-bottom: 20px;
        }

        .payment-method {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .payment-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9f5f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .payment-btn.active {
            border-color: #52b788;
            background: #e9f5f0;
            color: #2d6a4f;
        }

        .cash-input-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .cash-input {
            border: 2px solid #e9f5f0;
            border-radius: 8px;
            padding: 12px;
            width: 100%;
            font-size: 1.1rem;
            text-align: right;
        }

        .quick-cash {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-cash-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .quick-cash-btn:hover {
            background: #e9f5f0;
        }

        .change-display {
            background: linear-gradient(135deg, #52b788, #74c69d);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-pay {
            background: linear-gradient(135deg, #52b788, #74c69d);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .btn-pay:hover {
            background: linear-gradient(135deg, #2d6a4f, #52b788);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(82, 183, 136, 0.3);
        }

        .btn-clear {
            background: #dc3545;
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
        }

        .btn-clear:hover {
            background: #c82333;
        }

        .empty-cart {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .no-products {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .no-products i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .pos-container {
                padding: 10px;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }

            .cart-section {
                position: static;
                margin-top: 20px;
            }

            .total-amount {
                font-size: 1.5rem;
            }
        }

        /* Animation */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="pos-container">
        <!-- Header -->
        <div class="pos-header fade-in">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1"><i class="bi bi-shop me-2"></i>Point of Sales</h2>
                    <p class="mb-0 opacity-75">Sistem Kasir Koperasi Karyawan</p>
                </div>
                <div class="text-end">
                    <button class="btn btn-outline-light btn-sm" onclick="exitFullScreen()">
                        <i class="bi bi-fullscreen-exit me-1"></i>Exit Fullscreen
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Product Search & Display -->
            <div class="col-lg-8">
                <!-- Search Section -->
                <div class="pos-search-section fade-in">
                    <h5 class="mb-3"><i class="bi bi-search me-2"></i>Cari Produk</h5>
                    <input type="text" class="pos-search-input" id="productSearch" 
                           placeholder="Ketik nama produk atau scan barcode..." 
                           onkeyup="searchProducts(event)">
                    
                    <!-- Product Grid -->
                    <div class="product-grid" id="productGrid">
                        <!-- Products will be loaded here -->
                    </div>
                    
                    <!-- No Products Message -->
                    <div class="no-products" id="noProducts" style="display: none;">
                        <i class="bi bi-box-seam"></i>
                        <h5>Tidak ada produk ditemukan</h5>
                        <p>Coba kata kunci lain atau scan barcode produk</p>
                    </div>
                </div>
            </div>

            <!-- Cart Section -->
            <div class="col-lg-4">
                <div class="cart-section fade-in">
                    <!-- Cart Header -->
                    <div class="cart-header">
                        <div class="cart-icon">
                            <i class="bi bi-cart3"></i>
                        </div>
                        <div>
                            <h5 class="mb-0">Keranjang Belanja</h5>
                            <small class="text-muted">Total <span id="cartCount">0</span> item</small>
                        </div>
                    </div>

                    <!-- Member Selection -->
                    <div class="member-select">
                        <label class="form-label mb-2"><i class="bi bi-person me-1"></i>Pilih Anggota</label>
                        <div class="member-dropdown">
                            <input type="text" class="member-input" id="memberSearch" 
                                   placeholder="Ketik nama atau NIK anggota..." 
                                   onfocus="showMemberDropdown()" 
                                   onkeyup="filterMembers(event)">
                            <div class="member-dropdown-list" id="memberDropdown">
                                <!-- Member options will be loaded here -->
                            </div>
                            <input type="hidden" id="selectedMember">
                        </div>
                    </div>

                    <!-- Cart Items -->
                    <div class="cart-items" id="cartItems">
                        <div class="empty-cart">
                            <i class="bi bi-cart-x"></i>
                            <h6>Keranjang Kosong</h6>
                            <p>Pilih produk untuk memulai transaksi</p>
                        </div>
                    </div>

                    <!-- Cart Total -->
                    <div class="cart-total">
                        <div class="total-amount" id="totalAmount">Rp 0</div>
                    </div>

                    <!-- Payment Method -->
                    <div class="payment-section">
                        <label class="form-label mb-2"><i class="bi bi-credit-card me-1"></i>Metode Pembayaran</label>
                        <div class="payment-method">
                            <div class="payment-btn active" onclick="selectPaymentMethod('cash')">
                                <i class="bi bi-cash me-1"></i>Cash
                            </div>
                            <div class="payment-btn" onclick="selectPaymentMethod('credit')">
                                <i class="bi bi-credit-card me-1"></i>Kredit
                            </div>
                        </div>

                        <!-- Cash Payment Section -->
                        <div class="cash-input-section" id="cashSection">
                            <label class="form-label mb-2">Uang Bayar</label>
                            <input type="number" class="cash-input" id="cashInput" 
                                   placeholder="0" onkeyup="calculateChange()">
                            <div class="quick-cash">
                                <button class="quick-cash-btn" onclick="setExactAmount()">Pas</button>
                                <button class="quick-cash-btn" onclick="addAmount(50000)">50K</button>
                                <button class="quick-cash-btn" onclick="addAmount(100000)">100K</button>
                                <button class="quick-cash-btn" onclick="addAmount(200000)">200K</button>
                            </div>
                            <div class="change-display mt-3" id="changeDisplay">
                                Kembalian: Rp 0
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="btn-pay" onclick="processPayment()">
                            <i class="bi bi-check-circle me-2"></i>Bayar Sekarang
                        </button>
                        <button class="btn-clear" onclick="clearCart()">
                            <i class="bi bi-trash me-2"></i>Kosongkan Keranjang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data - replace with actual data from localStorage
        let products = [
            { id: 1, name: 'Beras Premium 5kg', price: 75000, stock: 25, barcode: '1234567890' },
            { id: 2, name: 'Minyak Goreng 2L', price: 35000, stock: 15, barcode: '2345678901' },
            { id: 3, name: 'Gula Pasir 1kg', price: 15000, stock: 30, barcode: '3456789012' },
            { id: 4, name: 'Tepung Terigu 1kg', price: 12000, stock: 20, barcode: '4567890123' },
            { id: 5, name: 'Kopi Bubuk 200g', price: 25000, stock: 10, barcode: '5678901234' },
            { id: 6, name: 'Teh Celup 25pcs', price: 8000, stock: 40, barcode: '6789012345' }
        ];

        let members = [
            { id: '', name: 'Umum (Cash)', nik: '' },
            { id: 1, name: 'Ahmad Suryadi', nik: '3201234567890001' },
            { id: 2, name: 'Siti Nurhaliza', nik: '3201234567890002' },
            { id: 3, name: 'Budi Santoso', nik: '3201234567890003' }
        ];

        let cart = [];
        let selectedPaymentMethod = 'cash';

        // Initialize POS
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            loadMembers();
            updateCartDisplay();
        });

        // Load products
        function loadProducts(searchQuery = '') {
            const productGrid = document.getElementById('productGrid');
            const noProducts = document.getElementById('noProducts');
            
            let filteredProducts = products;
            if (searchQuery) {
                filteredProducts = products.filter(p => 
                    p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    p.barcode.includes(searchQuery)
                );
            }

            if (filteredProducts.length === 0) {
                productGrid.style.display = 'none';
                noProducts.style.display = 'block';
                return;
            }

            productGrid.style.display = 'grid';
            noProducts.style.display = 'none';

            productGrid.innerHTML = filteredProducts.map(product => `
                <div class="product-card" onclick="addToCart(${product.id})">
                    <div class="product-image">
                        <i class="bi bi-box"></i>
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${formatRupiah(product.price)}</div>
                    <div class="product-stock">Stok: ${product.stock}</div>
                </div>
            `).join('');
        }

        // Load members
        function loadMembers() {
            const memberDropdown = document.getElementById('memberDropdown');
            memberDropdown.innerHTML = members.map(member => `
                <div class="member-option" onclick="selectMember('${member.id}', '${member.name}', '${member.nik}')">
                    <strong>${member.name}</strong>
                    ${member.nik ? `<br><small class="text-muted">NIK: ${member.nik}</small>` : ''}
                </div>
            `).join('');
        }

        // Search products
        function searchProducts(event) {
            const query = event.target.value.trim();
            
            if (event.key === 'Enter' && query) {
                // Try barcode exact match
                const product = products.find(p => p.barcode === query);
                if (product) {
                    addToCart(product.id);
                    event.target.value = '';
                    loadProducts();
                    return;
                }
            }
            
            loadProducts(query);
        }

        // Show member dropdown
        function showMemberDropdown() {
            document.getElementById('memberDropdown').style.display = 'block';
        }

        // Filter members
        function filterMembers(event) {
            const query = event.target.value.toLowerCase();
            const options = document.querySelectorAll('.member-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                option.style.display = text.includes(query) ? 'block' : 'none';
            });
        }

        // Select member
        function selectMember(id, name, nik) {
            document.getElementById('memberSearch').value = name;
            document.getElementById('selectedMember').value = id;
            document.getElementById('memberDropdown').style.display = 'none';
        }

        // Hide dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('memberDropdown');
            const input = document.getElementById('memberSearch');
            
            if (!dropdown.contains(event.target) && !input.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Add to cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) {
                alert('Produk tidak tersedia atau stok habis');
                return;
            }

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.qty < product.stock) {
                    existingItem.qty++;
                } else {
                    alert('Stok tidak mencukupi');
                    return;
                }
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    qty: 1,
                    stock: product.stock
                });
            }

            updateCartDisplay();
        }

        // Update cart display
        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const totalAmount = document.getElementById('totalAmount');

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="bi bi-cart-x"></i>
                        <h6>Keranjang Kosong</h6>
                        <p>Pilih produk untuk memulai transaksi</p>
                    </div>
                `;
                cartCount.textContent = '0';
                totalAmount.textContent = 'Rp 0';
                return;
            }

            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${formatRupiah(item.price)} x ${item.qty}</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="qty-btn" onclick="updateQty(${item.id}, -1)">
                            <i class="bi bi-dash"></i>
                        </button>
                        <div class="qty-display">${item.qty}</div>
                        <button class="qty-btn" onclick="updateQty(${item.id}, 1)">
                            <i class="bi bi-plus"></i>
                        </button>
                        <button class="qty-btn" onclick="removeFromCart(${item.id})" style="background: #dc3545; color: white; margin-left: 8px;">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);

            cartCount.textContent = totalItems;
            totalAmount.textContent = formatRupiah(total);

            calculateChange();
        }

        // Update quantity
        function updateQty(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;

            const newQty = item.qty + change;
            if (newQty <= 0) {
                removeFromCart(productId);
                return;
            }

            if (newQty > item.stock) {
                alert('Stok tidak mencukupi');
                return;
            }

            item.qty = newQty;
            updateCartDisplay();
        }

        // Remove from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        // Clear cart
        function clearCart() {
            if (cart.length === 0) return;
            
            if (confirm('Yakin ingin mengosongkan keranjang?')) {
                cart = [];
                updateCartDisplay();
            }
        }

        // Select payment method
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            const cashSection = document.getElementById('cashSection');
            cashSection.style.display = method === 'cash' ? 'block' : 'none';
        }

        // Set exact amount
        function setExactAmount() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            document.getElementById('cashInput').value = total;
            calculateChange();
        }

        // Add amount
        function addAmount(amount) {
            const currentAmount = parseFloat(document.getElementById('cashInput').value) || 0;
            document.getElementById('cashInput').value = currentAmount + amount;
            calculateChange();
        }

        // Calculate change
        function calculateChange() {
            if (selectedPaymentMethod !== 'cash') return;

            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const cash = parseFloat(document.getElementById('cashInput').value) || 0;
            const change = cash - total;

            const changeDisplay = document.getElementById('changeDisplay');
            
            if (change < 0) {
                changeDisplay.textContent = 'Uang kurang: ' + formatRupiah(Math.abs(change));
                changeDisplay.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
            } else {
                changeDisplay.textContent = 'Kembalian: ' + formatRupiah(change);
                changeDisplay.style.background = 'linear-gradient(135deg, #52b788, #74c69d)';
            }
        }

        // Process payment
        function processPayment() {
            if (cart.length === 0) {
                alert('Keranjang kosong');
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);

            if (selectedPaymentMethod === 'cash') {
                const cash = parseFloat(document.getElementById('cashInput').value) || 0;
                if (cash < total) {
                    alert('Uang bayar kurang dari total belanja');
                    return;
                }
            }

            // Process payment logic here
            alert('Pembayaran berhasil diproses!');
            
            // Clear cart after successful payment
            cart = [];
            updateCartDisplay();
            document.getElementById('cashInput').value = '';
            calculateChange();
        }

        // Format rupiah
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Exit fullscreen
        function exitFullScreen() {
            // Add exit fullscreen logic here
            alert('Keluar dari mode fullscreen');
        }
    </script>
</body>
</html>