<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Reset Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Reset Data Integration</h1>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Integration Tests</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-3" onclick="runTests()">Run Tests</button>
                <div id="testResults"></div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>Manual Test</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-success" onclick="testRenderResetPage()">Test Render Reset Page</button>
                <div id="mainContent" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/backup.js"></script>
    <script src="js/auditLogger.js"></script>
    <script src="js/resetDataKoperasi.js"></script>
    <script src="js/resetDataUI.js"></script>

    <script>
        // Setup test user
        localStorage.setItem('currentUser', JSON.stringify({
            username: 'admin',
            nama: 'Test Admin',
            name: 'Test Admin',
            role: 'super_admin'
        }));

        // Setup test koperasi
        localStorage.setItem('koperasi', JSON.stringify({
            id: 'KOP001',
            nama: 'Koperasi Test',
            alamat: 'Jl. Test No. 123'
        }));

        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h6>Running tests...</h6>';
            
            let html = '';
            
            // Test 1: Check if classes are loaded
            html += '<div class="alert alert-' + (typeof CategoryManager !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ CategoryManager: ' + (typeof CategoryManager !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            html += '<div class="alert alert-' + (typeof ResetService !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ ResetService: ' + (typeof ResetService !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            html += '<div class="alert alert-' + (typeof ResetValidationService !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ ResetValidationService: ' + (typeof ResetValidationService !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            html += '<div class="alert alert-' + (typeof SetupWizardService !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ SetupWizardService: ' + (typeof SetupWizardService !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            html += '<div class="alert alert-' + (typeof renderResetDataPage !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ renderResetDataPage: ' + (typeof renderResetDataPage !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            html += '<div class="alert alert-' + (typeof RESET_CONSTANTS !== 'undefined' ? 'success' : 'danger') + '">';
            html += '✓ RESET_CONSTANTS: ' + (typeof RESET_CONSTANTS !== 'undefined' ? 'Loaded' : 'NOT LOADED');
            html += '</div>';
            
            // Test 2: Try to instantiate classes
            try {
                const cm = new CategoryManager();
                const categories = cm.getAllCategories();
                html += '<div class="alert alert-success">';
                html += '✓ CategoryManager instantiation: SUCCESS (' + categories.length + ' categories)';
                html += '</div>';
            } catch (e) {
                html += '<div class="alert alert-danger">';
                html += '✗ CategoryManager instantiation: FAILED - ' + e.message;
                html += '</div>';
            }
            
            try {
                const rs = new ResetService();
                html += '<div class="alert alert-success">';
                html += '✓ ResetService instantiation: SUCCESS';
                html += '</div>';
            } catch (e) {
                html += '<div class="alert alert-danger">';
                html += '✗ ResetService instantiation: FAILED - ' + e.message;
                html += '</div>';
            }
            
            results.innerHTML = html;
        }

        function testRenderResetPage() {
            try {
                if (typeof renderResetDataPage === 'function') {
                    renderResetDataPage();
                    alert('Reset page rendered successfully! Check the "Manual Test" section below.');
                } else {
                    alert('ERROR: renderResetDataPage function not found!');
                }
            } catch (e) {
                alert('ERROR: ' + e.message);
                console.error(e);
            }
        }

        // Auto-run tests on load
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>

