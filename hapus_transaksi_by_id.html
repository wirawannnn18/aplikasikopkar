<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hapus Transaksi by ID</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">Hapus Transaksi by ID</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Peringatan:</strong> Tool ini akan menghapus transaksi secara permanen tanpa validasi tambahan.
                        </div>

                        <div class="mb-3">
                            <label for="transactionId" class="form-label">Transaction ID:</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="transactionId" 
                                   value="mia5rs5vrewuw5ft58a"
                                   placeholder="Masukkan ID transaksi">
                        </div>

                        <div id="transactionInfo" class="mb-3"></div>

                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="searchTransaction()">
                                <i class="fas fa-search"></i> Cari Transaksi
                            </button>
                            <button class="btn btn-danger" onclick="deleteTransaction()" id="deleteBtn" disabled>
                                <i class="fas fa-trash"></i> Hapus Transaksi
                            </button>
                        </div>

                        <div id="result" class="mt-3"></div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">Semua Transaksi</h6>
                    </div>
                    <div class="card-body">
                        <div id="allTransactions" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <script>
        let currentTransaction = null;

        // Load all transactions on page load
        window.onload = function() {
            loadAllTransactions();
            searchTransaction();
        };

        function loadAllTransactions() {
            const transactions = JSON.parse(localStorage.getItem('posTransactions') || '[]');
            const container = document.getElementById('allTransactions');
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-muted">Tidak ada transaksi</p>';
                return;
            }

            let html = '<div class="list-group">';
            transactions.forEach(t => {
                html += `
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${t.noTransaksi || t.id}</strong><br>
                                <small class="text-muted">ID: ${t.id}</small><br>
                                <small>Tanggal: ${t.tanggal || 'N/A'}</small><br>
                                <small>Total: Rp ${(t.total || 0).toLocaleString('id-ID')}</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" 
                                    onclick="document.getElementById('transactionId').value='${t.id}'; searchTransaction();">
                                Pilih
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function searchTransaction() {
            const transactionId = document.getElementById('transactionId').value.trim();
            const resultDiv = document.getElementById('result');
            const infoDiv = document.getElementById('transactionInfo');
            const deleteBtn = document.getElementById('deleteBtn');
            
            if (!transactionId) {
                resultDiv.innerHTML = '<div class="alert alert-warning">Masukkan ID transaksi</div>';
                deleteBtn.disabled = true;
                return;
            }

            const transactions = JSON.parse(localStorage.getItem('posTransactions') || '[]');
            const transaction = transactions.find(t => t.id === transactionId);

            if (!transaction) {
                infoDiv.innerHTML = '<div class="alert alert-danger">Transaksi tidak ditemukan</div>';
                currentTransaction = null;
                deleteBtn.disabled = true;
                resultDiv.innerHTML = '';
                return;
            }

            currentTransaction = transaction;
            deleteBtn.disabled = false;

            // Display transaction info
            infoDiv.innerHTML = `
                <div class="alert alert-info">
                    <h6>Informasi Transaksi:</h6>
                    <table class="table table-sm table-borderless mb-0">
                        <tr>
                            <td><strong>ID:</strong></td>
                            <td>${transaction.id}</td>
                        </tr>
                        <tr>
                            <td><strong>No Transaksi:</strong></td>
                            <td>${transaction.noTransaksi || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td><strong>Tanggal:</strong></td>
                            <td>${transaction.tanggal || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td><strong>Total:</strong></td>
                            <td>Rp ${(transaction.total || 0).toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td><strong>Kasir:</strong></td>
                            <td>${transaction.kasir || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td><strong>Metode:</strong></td>
                            <td>${transaction.metode || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td><strong>Items:</strong></td>
                            <td>${transaction.items ? transaction.items.length : 0} item(s)</td>
                        </tr>
                    </table>
                </div>
            `;
            resultDiv.innerHTML = '';
        }

        function deleteTransaction() {
            if (!currentTransaction) {
                alert('Tidak ada transaksi yang dipilih');
                return;
            }

            if (!confirm(`Apakah Anda yakin ingin menghapus transaksi ${currentTransaction.noTransaksi || currentTransaction.id}?`)) {
                return;
            }

            const transactionId = currentTransaction.id;
            const transactions = JSON.parse(localStorage.getItem('posTransactions') || '[]');
            const index = transactions.findIndex(t => t.id === transactionId);

            if (index === -1) {
                document.getElementById('result').innerHTML = 
                    '<div class="alert alert-danger">Transaksi tidak ditemukan</div>';
                return;
            }

            // Delete transaction
            const deleted = transactions.splice(index, 1);
            localStorage.setItem('posTransactions', JSON.stringify(transactions));

            // Show success message
            document.getElementById('result').innerHTML = `
                <div class="alert alert-success">
                    <h6>Transaksi berhasil dihapus!</h6>
                    <p class="mb-0">ID: ${deleted[0].id}</p>
                    <p class="mb-0">No Transaksi: ${deleted[0].noTransaksi || 'N/A'}</p>
                </div>
            `;

            // Clear form
            document.getElementById('transactionInfo').innerHTML = '';
            document.getElementById('deleteBtn').disabled = true;
            currentTransaction = null;

            // Reload transaction list
            loadAllTransactions();
        }
    </script>
</body>
</html>
