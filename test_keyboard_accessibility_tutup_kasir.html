<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Keyboard Accessibility Tutup Kasir</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #0d6efd;
        }
        
        .shortcut-demo {
            background: #e3f2fd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .accessibility-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .keyboard-help {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        kbd {
            background-color: #212529;
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.875em;
        }
        
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }
        
        .focus-indicator {
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
        }
        
        .test-status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .test-status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-status.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="accessibility-indicator" id="accessibilityIndicator">
        <i class="bi bi-universal-access me-1"></i>
        Accessibility Ready
    </div>

    <div class="test-container">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="bi bi-keyboard me-2"></i>
                    Test Keyboard Accessibility Tutup Kasir
                </h1>
                <p class="lead">
                    Halaman ini untuk menguji implementasi keyboard shortcuts dan fitur aksesibilitas 
                    untuk fungsi tutup kasir di sistem POS.
                </p>
            </div>
        </div>

        <!-- Setup Test Environment -->
        <div class="test-section">
            <h3><i class="bi bi-gear me-2"></i>Setup Test Environment</h3>
            <p>Klik tombol di bawah untuk menyiapkan environment testing:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary mb-2" onclick="setupTestEnvironment()">
                        <i class="bi bi-play-circle me-1"></i>Setup Test Environment
                    </button>
                    <button class="btn btn-success mb-2" onclick="simulateBukaKas()">
                        <i class="bi bi-unlock me-1"></i>Simulasi Buka Kas
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-info mb-2" onclick="testAccessibilityFeatures()">
                        <i class="bi bi-universal-access me-1"></i>Test Accessibility
                    </button>
                    <button class="btn btn-warning mb-2" onclick="clearTestData()">
                        <i class="bi bi-trash me-1"></i>Clear Test Data
                    </button>
                </div>
            </div>
            
            <div id="setupStatus" class="test-status info" style="display: none;">
                <i class="bi bi-info-circle me-1"></i>
                <span id="setupMessage">Initializing...</span>
            </div>
        </div>

        <!-- Keyboard Shortcuts Testing -->
        <div class="test-section">
            <h3><i class="bi bi-keyboard me-2"></i>Keyboard Shortcuts Testing</h3>
            <p>Test berbagai keyboard shortcuts yang tersedia:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="shortcut-demo">
                        <h5>Primary Shortcuts</h5>
                        <ul class="list-unstyled">
                            <li><kbd>F10</kbd> - Buka modal tutup kasir</li>
                            <li><kbd>F1</kbd> - Tampilkan bantuan keyboard</li>
                            <li><kbd>Esc</kbd> - Tutup modal (saat modal terbuka)</li>
                        </ul>
                        <button class="btn btn-sm btn-outline-primary" onclick="testPrimaryShortcuts()">
                            Test Primary Shortcuts
                        </button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="shortcut-demo">
                        <h5>Alternative Shortcuts</h5>
                        <ul class="list-unstyled">
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>T</kbd> - Tutup kasir</li>
                            <li><kbd>Alt</kbd> + <kbd>T</kbd> - Tutup kasir</li>
                            <li><kbd>Tab</kbd> / <kbd>Shift</kbd> + <kbd>Tab</kbd> - Navigasi</li>
                        </ul>
                        <button class="btn btn-sm btn-outline-secondary" onclick="testAlternativeShortcuts()">
                            Test Alternative Shortcuts
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="shortcutTestResults" class="mt-3"></div>
        </div>

        <!-- Accessibility Features Testing -->
        <div class="test-section">
            <h3><i class="bi bi-universal-access me-2"></i>Accessibility Features Testing</h3>
            <p>Test fitur aksesibilitas yang diimplementasikan:</p>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="bi bi-eye me-1"></i>ARIA Labels</h6>
                        </div>
                        <div class="card-body">
                            <p class="small">Test ARIA labels dan descriptions</p>
                            <button class="btn btn-sm btn-outline-info" onclick="testAriaLabels()">
                                Test ARIA
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="bi bi-cursor me-1"></i>Focus Management</h6>
                        </div>
                        <div class="card-body">
                            <p class="small">Test focus management dan tab navigation</p>
                            <button class="btn btn-sm btn-outline-info" onclick="testFocusManagement()">
                                Test Focus
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="bi bi-volume-up me-1"></i>Screen Reader</h6>
                        </div>
                        <div class="card-body">
                            <p class="small">Test screen reader announcements</p>
                            <button class="btn btn-sm btn-outline-info" onclick="testScreenReaderAnnouncements()">
                                Test Announcements
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="accessibilityTestResults" class="mt-3"></div>
        </div>

        <!-- Manual Testing Instructions -->
        <div class="test-section">
            <h3><i class="bi bi-list-check me-2"></i>Manual Testing Instructions</h3>
            <div class="keyboard-help">
                <h5>Langkah-langkah Manual Testing:</h5>
                <ol>
                    <li><strong>Setup:</strong> Klik "Setup Test Environment" dan "Simulasi Buka Kas"</li>
                    <li><strong>F10 Test:</strong> Tekan <kbd>F10</kbd> untuk membuka modal tutup kasir</li>
                    <li><strong>Tab Navigation:</strong> Gunakan <kbd>Tab</kbd> dan <kbd>Shift</kbd>+<kbd>Tab</kbd> untuk navigasi</li>
                    <li><strong>Escape Test:</strong> Tekan <kbd>Esc</kbd> untuk menutup modal</li>
                    <li><strong>Alternative Shortcuts:</strong> Test <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd> dan <kbd>Alt</kbd>+<kbd>T</kbd></li>
                    <li><strong>Help:</strong> Tekan <kbd>F1</kbd> untuk melihat bantuan keyboard</li>
                    <li><strong>Screen Reader:</strong> Aktifkan screen reader untuk test pengumuman suara</li>
                </ol>
            </div>
        </div>

        <!-- Test Results -->
        <div class="test-section">
            <h3><i class="bi bi-clipboard-check me-2"></i>Test Results</h3>
            <div id="testResults">
                <div class="test-status info">
                    <i class="bi bi-info-circle me-1"></i>
                    Belum ada test yang dijalankan. Klik tombol test di atas untuk memulai.
                </div>
            </div>
        </div>
    </div>

    <!-- Mock Tutup Kasir Modal -->
    <div class="modal fade" id="tutupKasirModal" tabindex="-1" aria-labelledby="tutupKasirModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" id="tutupKasirModalLabel">
                        <i class="bi bi-calculator me-2"></i>Tutup Kasir
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informasi Shift</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td>Kasir:</td>
                                    <td><strong id="shiftKasir">Test Kasir</strong></td>
                                </tr>
                                <tr>
                                    <td>Waktu Buka:</td>
                                    <td><strong id="shiftWaktuBuka">08:00</strong></td>
                                </tr>
                                <tr>
                                    <td>Modal Awal:</td>
                                    <td><strong id="shiftModalAwal">Rp 500,000</strong></td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Ringkasan Penjualan</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td>Total Penjualan:</td>
                                    <td><strong>Rp 1,250,000</strong></td>
                                </tr>
                                <tr>
                                    <td>Penjualan Cash:</td>
                                    <td><strong>Rp 800,000</strong></td>
                                </tr>
                                <tr>
                                    <td>Kas Seharusnya:</td>
                                    <td><strong>Rp 1,300,000</strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="kasAktual" class="form-label">Kas Aktual <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="kasAktual" 
                                       aria-label="Jumlah kas aktual yang dihitung"
                                       aria-describedby="kasAktualHelp"
                                       aria-required="true"
                                       placeholder="Masukkan jumlah kas aktual">
                                <div id="kasAktualHelp" class="form-text">
                                    Masukkan jumlah uang kas yang ada di kasir saat ini
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="keteranganSelisih" class="form-label">Keterangan Selisih</label>
                                <textarea class="form-control" id="keteranganSelisih" rows="3"
                                          aria-label="Keterangan selisih kas"
                                          aria-describedby="keteranganHelp"
                                          placeholder="Berikan keterangan jika ada selisih"></textarea>
                                <div id="keteranganHelp" class="form-text">
                                    Berikan keterangan jika terdapat selisih kas
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Batal
                    </button>
                    <button type="button" class="btn btn-success" id="prosesTutupKasirBtn"
                            aria-label="Proses tutup kasir"
                            aria-describedby="processBtnHelp">
                        <i class="bi bi-check-circle me-1"></i>Proses Tutup Kasir
                    </button>
                    <div id="processBtnHelp" class="sr-only">
                        Tekan Enter atau klik untuk memproses tutup kasir
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/keyboard-accessibility-tutup-kasir.js"></script>
    
    <script>
        // Mock functions for testing
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.test-container').insertBefore(alertDiv, document.querySelector('.test-container').firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        function showTutupKasirModal() {
            const modal = new bootstrap.Modal(document.getElementById('tutupKasirModal'));
            modal.show();
            
            // Trigger custom event for accessibility manager
            document.dispatchEvent(new CustomEvent('shown.bs.modal', {
                detail: { target: document.getElementById('tutupKasirModal') }
            }));
        }
        
        function prosesTutupKasir() {
            showAlert('Tutup kasir berhasil diproses (simulasi)', 'success');
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('tutupKasirModal'));
            if (modal) {
                modal.hide();
            }
        }
        
        // Test functions
        function setupTestEnvironment() {
            updateStatus('setupStatus', 'Setting up test environment...', 'info');
            
            // Initialize accessibility manager
            setTimeout(() => {
                if (!window.tutupKasirAccessibilityManager) {
                    window.tutupKasirAccessibilityManager = new TutupKasirAccessibilityManager();
                }
                updateStatus('setupStatus', 'Test environment ready!', 'success');
            }, 1000);
        }
        
        function simulateBukaKas() {
            const bukaKasData = {
                id: 'test-shift-001',
                kasir: 'Test Kasir',
                kasirId: 'kasir001',
                modalAwal: 500000,
                waktuBuka: new Date().toISOString(),
                tanggal: new Date().toISOString().split('T')[0]
            };
            
            sessionStorage.setItem('bukaKas', JSON.stringify(bukaKasData));
            updateStatus('setupStatus', 'Buka kas simulation completed!', 'success');
        }
        
        function testPrimaryShortcuts() {
            const results = document.getElementById('shortcutTestResults');
            results.innerHTML = `
                <div class="test-status info">
                    <h6>Testing Primary Shortcuts:</h6>
                    <ul>
                        <li>✓ F10 shortcut registered</li>
                        <li>✓ F1 help shortcut registered</li>
                        <li>✓ Escape shortcut registered</li>
                    </ul>
                    <p><strong>Manual Test:</strong> Tekan F10 untuk membuka modal, Esc untuk menutup, F1 untuk bantuan.</p>
                </div>
            `;
        }
        
        function testAlternativeShortcuts() {
            const results = document.getElementById('shortcutTestResults');
            results.innerHTML = `
                <div class="test-status info">
                    <h6>Testing Alternative Shortcuts:</h6>
                    <ul>
                        <li>✓ Ctrl+Shift+T shortcut registered</li>
                        <li>✓ Alt+T shortcut registered</li>
                        <li>✓ Tab navigation implemented</li>
                    </ul>
                    <p><strong>Manual Test:</strong> Tekan Ctrl+Shift+T atau Alt+T untuk membuka modal.</p>
                </div>
            `;
        }
        
        function testAccessibilityFeatures() {
            const results = document.getElementById('accessibilityTestResults');
            results.innerHTML = `
                <div class="test-status success">
                    <h6>Accessibility Features Status:</h6>
                    <ul>
                        <li>✓ ARIA live region created</li>
                        <li>✓ Focus management implemented</li>
                        <li>✓ Screen reader announcements ready</li>
                        <li>✓ Keyboard navigation available</li>
                    </ul>
                </div>
            `;
        }
        
        function testAriaLabels() {
            const modal = document.getElementById('tutupKasirModal');
            const hasAriaLabels = modal.hasAttribute('aria-labelledby') && 
                                 modal.hasAttribute('aria-describedby');
            
            updateTestResults('ARIA Labels Test', hasAriaLabels ? 'PASS' : 'FAIL', 
                            hasAriaLabels ? 'Modal has proper ARIA labels' : 'Missing ARIA labels');
        }
        
        function testFocusManagement() {
            // Test if focus management is working
            const focusableElements = document.querySelectorAll('input, button, textarea, select, a[href]');
            const hasFocusableElements = focusableElements.length > 0;
            
            updateTestResults('Focus Management Test', hasFocusableElements ? 'PASS' : 'FAIL',
                            `Found ${focusableElements.length} focusable elements`);
        }
        
        function testScreenReaderAnnouncements() {
            const liveRegion = document.getElementById('tutupKasirLiveRegion');
            const hasLiveRegion = liveRegion !== null;
            
            updateTestResults('Screen Reader Test', hasLiveRegion ? 'PASS' : 'FAIL',
                            hasLiveRegion ? 'ARIA live region found' : 'ARIA live region missing');
        }
        
        function clearTestData() {
            sessionStorage.clear();
            localStorage.clear();
            updateStatus('setupStatus', 'Test data cleared', 'info');
        }
        
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            const messageElement = document.getElementById(elementId.replace('Status', 'Message'));
            
            element.className = `test-status ${type}`;
            element.style.display = 'block';
            
            if (messageElement) {
                messageElement.textContent = message;
            }
        }
        
        function updateTestResults(testName, status, details) {
            const results = document.getElementById('testResults');
            const statusClass = status === 'PASS' ? 'success' : 'error';
            const icon = status === 'PASS' ? 'check-circle' : 'x-circle';
            
            results.innerHTML += `
                <div class="test-status ${statusClass}">
                    <i class="bi bi-${icon} me-1"></i>
                    <strong>${testName}:</strong> ${status} - ${details}
                </div>
            `;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            
            // Auto-setup after a delay
            setTimeout(() => {
                setupTestEnvironment();
                simulateBukaKas();
            }, 2000);
        });
        
        // Listen for keyboard events to show feedback
        document.addEventListener('keydown', function(event) {
            const keyInfo = document.createElement('div');
            keyInfo.className = 'alert alert-info alert-dismissible fade show position-fixed';
            keyInfo.style.top = '100px';
            keyInfo.style.right = '20px';
            keyInfo.style.zIndex = '9999';
            keyInfo.innerHTML = `
                Key pressed: <kbd>${event.key}</kbd>
                ${event.ctrlKey ? ' + <kbd>Ctrl</kbd>' : ''}
                ${event.shiftKey ? ' + <kbd>Shift</kbd>' : ''}
                ${event.altKey ? ' + <kbd>Alt</kbd>' : ''}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(keyInfo);
            
            setTimeout(() => {
                keyInfo.remove();
            }, 3000);
        });
    </script>
</body>
</html>