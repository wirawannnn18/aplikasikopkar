<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 1.1 - Property Test: Period Validation Consistency</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .test-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .test-success {
            border-left: 4px solid #28a745;
        }
        .test-error {
            border-left: 4px solid #dc3545;
        }
        .test-warning {
            border-left: 4px solid #ffc107;
        }
        .log-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .metric-card {
            text-align: center;
            padding: 1.5rem;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <div class="test-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0"><i class="fas fa-calendar-check me-3"></i>Task 1.1 - Property Test</h1>
                    <p class="mb-0 mt-2">Period Validation Consistency - Memvalidasi konsistensi validasi periode</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light" onclick="window.history.back()">
                        <i class="fas fa-arrow-left me-2"></i>Kembali
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Test Summary -->
        <div class="card test-card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Test Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-success" id="totalPassed">0</div>
                            <div class="text-muted">Tests Passed</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-danger" id="totalFailed">0</div>
                            <div class="text-muted">Tests Failed</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-info" id="totalIterations">0</div>
                            <div class="text-muted">Total Iterations</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-warning" id="totalProperties">8</div>
                            <div class="text-muted">Properties Tested</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="card test-card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-play me-2"></i>Test Execution</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-success me-2" onclick="runAllTests()">
                    <i class="fas fa-rocket me-1"></i>Run All Property Tests
                </button>
                <button class="btn btn-info me-2" onclick="runSingleProperty()">
                    <i class="fas fa-cog me-1"></i>Run Single Property
                </button>
                <button class="btn btn-warning me-2" onclick="runEdgeCases()">
                    <i class="fas fa-exclamation-triangle me-1"></i>Test Edge Cases
                </button>
                <button class="btn btn-secondary me-2" onclick="clearResults()">
                    <i class="fas fa-broom me-1"></i>Clear Results
                </button>
            </div>
        </div>

        <!-- Test Results -->
        <div class="card test-card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-list-check me-2"></i>Property Test Results</h5>
            </div>
            <div class="card-body">
                <div id="testResults">
                    <div class="text-muted">Hasil property tests akan muncul di sini...</div>
                </div>
            </div>
        </div>

        <!-- Test Log -->
        <div class="card test-card">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>Test Execution Log</h5>
                <button class="btn btn-sm btn-outline-light" onclick="clearLog()">
                    <i class="fas fa-trash me-1"></i>Clear Log
                </button>
            </div>
            <div class="card-body p-0">
                <div id="testLog" class="log-output">
                    <div class="text-muted">Test execution log akan muncul di sini...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test framework variables
        let testResults = {
            passed: 0,
            failed: 0,
            iterations: 0,
            properties: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('=== Task 1.1 Property Test Initialized ===', 'info');
            log('Period Validation Consistency Test Suite', 'info');
            updateMetrics();
        });

        // Logging function
        function log(message, type = 'info') {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = {
                'info': 'text-info',
                'success': 'text-success',
                'error': 'text-danger',
                'warning': 'text-warning'
            };
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> <span class="${typeClass[type] || 'text-dark'}">${message}</span>`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Mock validation functions
        function validatePeriod(periodType, periodData) {
            if (!periodType) return false;
            
            switch (periodType) {
                case 'daily':
                    return periodData.date && 
                           periodData.date instanceof Date && 
                           !isNaN(periodData.date.getTime());
                
                case 'monthly':
                    return periodData.month && 
                           periodData.year &&
                           periodData.month >= 1 && 
                           periodData.month <= 12 &&
                           periodData.year >= 2020 && 
                           periodData.year <= 2030;
                
                case 'yearly':
                    return periodData.year &&
                           periodData.year >= 2020 && 
                           periodData.year <= 2030;
                
                default:
                    return false;
            }
        }

        function getAvailableData(periodType, periodData) {
            const currentDate = new Date();
            
            switch (periodType) {
                case 'daily':
                    return periodData.date <= currentDate;
                
                case 'monthly':
                    const monthEnd = new Date(periodData.year, periodData.month, 0);
                    return monthEnd <= currentDate;
                
                case 'yearly':
                    const yearEnd = new Date(periodData.year, 11, 31);
                    return yearEnd <= currentDate;
                
                default:
                    return false;
            }
        }

        // Property test implementations
        async function runAllTests() {
            log('=== Starting All Property Tests ===', 'info');
            
            // Reset results
            testResults = { passed: 0, failed: 0, iterations: 0, properties: [] };
            
            const properties = [
                { name: 'Property 1.1: Valid daily periods', test: testValidDailyPeriods },
                { name: 'Property 1.2: Valid monthly periods', test: testValidMonthlyPeriods },
                { name: 'Property 1.3: Valid yearly periods', test: testValidYearlyPeriods },
                { name: 'Property 1.4: Invalid period types', test: testInvalidPeriodTypes },
                { name: 'Property 1.5: Validation consistency', test: testValidationConsistency },
                { name: 'Property 1.6: Data availability consistency', test: testDataAvailabilityConsistency },
                { name: 'Property 1.7: Edge cases handling', test: testEdgeCases },
                { name: 'Property 1.8: Missing fields handling', test: testMissingFields }
            ];

            for (const property of properties) {
                try {
                    log(`Running ${property.name}...`, 'info');
                    const result = await property.test();
                    
                    if (result.success) {
                        testResults.passed++;
                        log(`✅ PASS: ${property.name} (${result.iterations} iterations)`, 'success');
                    } else {
                        testResults.failed++;
                        log(`❌ FAIL: ${property.name} - ${result.error}`, 'error');
                    }
                    
                    testResults.iterations += result.iterations || 0;
                    testResults.properties.push({
                        name: property.name,
                        success: result.success,
                        iterations: result.iterations || 0,
                        details: result.details || ''
                    });
                    
                } catch (error) {
                    testResults.failed++;
                    log(`❌ ERROR: ${property.name} - ${error.message}`, 'error');
                }
            }

            updateMetrics();
            displayResults();
            log('=== All Property Tests Completed ===', 'info');
        }

        // Individual property test functions
        async function testValidDailyPeriods() {
            let iterations = 0;
            let failures = 0;
            
            // Generate random dates and test validation
            for (let i = 0; i < 100; i++) {
                iterations++;
                const randomDate = new Date(2020 + Math.random() * 10, Math.random() * 12, Math.random() * 28 + 1);
                const periodData = { date: randomDate };
                const isValid = validatePeriod('daily', periodData);
                
                if (!isValid) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} valid dates failed validation` : null,
                details: `Tested ${iterations} random dates, ${failures} failures`
            };
        }

        async function testValidMonthlyPeriods() {
            let iterations = 0;
            let failures = 0;
            
            // Test all valid month/year combinations
            for (let year = 2020; year <= 2030; year++) {
                for (let month = 1; month <= 12; month++) {
                    iterations++;
                    const periodData = { month, year };
                    const isValid = validatePeriod('monthly', periodData);
                    
                    if (!isValid) {
                        failures++;
                    }
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} valid month/year combinations failed` : null,
                details: `Tested ${iterations} month/year combinations, ${failures} failures`
            };
        }

        async function testValidYearlyPeriods() {
            let iterations = 0;
            let failures = 0;
            
            // Test all valid years
            for (let year = 2020; year <= 2030; year++) {
                iterations++;
                const periodData = { year };
                const isValid = validatePeriod('yearly', periodData);
                
                if (!isValid) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} valid years failed validation` : null,
                details: `Tested ${iterations} years, ${failures} failures`
            };
        }

        async function testInvalidPeriodTypes() {
            let iterations = 0;
            let failures = 0;
            
            const invalidTypes = ['weekly', 'quarterly', 'invalid', '', null, undefined, 123, {}];
            
            for (const invalidType of invalidTypes) {
                iterations++;
                const periodData = { date: new Date(), month: 6, year: 2024 };
                const isValid = validatePeriod(invalidType, periodData);
                
                if (isValid) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} invalid types incorrectly passed validation` : null,
                details: `Tested ${iterations} invalid types, ${failures} incorrect passes`
            };
        }

        async function testValidationConsistency() {
            let iterations = 0;
            let failures = 0;
            
            // Test consistency across multiple calls
            const testCases = [
                { type: 'daily', data: { date: new Date('2024-12-11') } },
                { type: 'monthly', data: { month: 12, year: 2024 } },
                { type: 'yearly', data: { year: 2024 } }
            ];
            
            for (const testCase of testCases) {
                for (let i = 0; i < 10; i++) {
                    iterations++;
                    const result1 = validatePeriod(testCase.type, testCase.data);
                    const result2 = validatePeriod(testCase.type, testCase.data);
                    const result3 = validatePeriod(testCase.type, testCase.data);
                    
                    if (result1 !== result2 || result2 !== result3) {
                        failures++;
                    }
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} inconsistent validation results` : null,
                details: `Tested ${iterations} consistency checks, ${failures} inconsistencies`
            };
        }

        async function testDataAvailabilityConsistency() {
            let iterations = 0;
            let failures = 0;
            
            const testCases = [
                { type: 'daily', data: { date: new Date('2024-01-01') } },
                { type: 'monthly', data: { month: 1, year: 2024 } },
                { type: 'yearly', data: { year: 2024 } }
            ];
            
            for (const testCase of testCases) {
                iterations++;
                const isValidPeriod = validatePeriod(testCase.type, testCase.data);
                const hasAvailableData = getAvailableData(testCase.type, testCase.data);
                
                // Both should be true for past dates
                if (isValidPeriod && !hasAvailableData) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} data availability inconsistencies` : null,
                details: `Tested ${iterations} availability checks, ${failures} inconsistencies`
            };
        }

        async function testEdgeCases() {
            let iterations = 0;
            let failures = 0;
            
            const edgeCases = [
                { type: 'daily', data: { date: null } },
                { type: 'daily', data: { date: undefined } },
                { type: 'daily', data: { date: new Date('invalid') } },
                { type: 'monthly', data: { month: 0, year: 2024 } },
                { type: 'monthly', data: { month: 13, year: 2024 } },
                { type: 'yearly', data: { year: 2019 } },
                { type: 'yearly', data: { year: 2031 } },
                { type: null, data: { date: new Date() } },
                { type: '', data: { month: 6, year: 2024 } }
            ];
            
            for (const edgeCase of edgeCases) {
                iterations++;
                const result = validatePeriod(edgeCase.type, edgeCase.data);
                
                if (result) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} edge cases incorrectly passed` : null,
                details: `Tested ${iterations} edge cases, ${failures} incorrect passes`
            };
        }

        async function testMissingFields() {
            let iterations = 0;
            let failures = 0;
            
            const types = ['daily', 'monthly', 'yearly'];
            
            for (const type of types) {
                iterations++;
                const emptyData = {};
                const result = validatePeriod(type, emptyData);
                
                if (result) {
                    failures++;
                }
            }
            
            return {
                success: failures === 0,
                iterations,
                error: failures > 0 ? `${failures} empty data incorrectly passed` : null,
                details: `Tested ${iterations} empty data cases, ${failures} incorrect passes`
            };
        }

        // Display functions
        function updateMetrics() {
            document.getElementById('totalPassed').textContent = testResults.passed;
            document.getElementById('totalFailed').textContent = testResults.failed;
            document.getElementById('totalIterations').textContent = testResults.iterations;
        }

        function displayResults() {
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';
            
            if (testResults.properties.length === 0) {
                resultsContainer.innerHTML = '<div class="text-muted">Belum ada hasil test...</div>';
                return;
            }
            
            testResults.properties.forEach(property => {
                const resultElement = document.createElement('div');
                resultElement.className = `alert ${property.success ? 'alert-success test-success' : 'alert-danger test-error'} py-2 mb-2`;
                resultElement.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <span><i class="fas ${property.success ? 'fa-check' : 'fa-times'} me-2"></i>${property.name}</span>
                        <span class="badge ${property.success ? 'bg-success' : 'bg-danger'}">${property.success ? 'PASS' : 'FAIL'}</span>
                    </div>
                    <small class="text-muted">${property.details}</small>
                `;
                resultsContainer.appendChild(resultElement);
            });
        }

        // Utility functions
        function runSingleProperty() {
            log('Running single property test...', 'info');
            testValidDailyPeriods().then(result => {
                log(`Single property result: ${result.success ? 'PASS' : 'FAIL'}`, result.success ? 'success' : 'error');
            });
        }

        function runEdgeCases() {
            log('Running edge cases test...', 'info');
            testEdgeCases().then(result => {
                log(`Edge cases result: ${result.success ? 'PASS' : 'FAIL'}`, result.success ? 'success' : 'error');
            });
        }

        function clearResults() {
            testResults = { passed: 0, failed: 0, iterations: 0, properties: [] };
            updateMetrics();
            document.getElementById('testResults').innerHTML = '<div class="text-muted">Hasil property tests akan muncul di sini...</div>';
            log('Results cleared', 'info');
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '<div class="text-muted">Test execution log akan muncul di sini...</div>';
        }

        // Auto-run tests after 2 seconds
        setTimeout(() => {
            log('Auto-starting property tests...', 'info');
            runAllTests();
        }, 2000);
    </script>
</body>
</html>