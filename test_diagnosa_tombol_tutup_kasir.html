<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Diagnosa Tombol Tutup Kasir</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .test-section {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-pass {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .test-fail {
            border-color: #dc3545;
            background-color: #fff8f8;
        }
        .test-warning {
            border-color: #ffc107;
            background-color: #fffdf5;
        }
        .pos-header-simulation {
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .visibility-test {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">
            <i class="bi bi-bug me-2"></i>Diagnosa Tombol Tutup Kasir POS
        </h1>

        <!-- Test 1: Session Storage Check -->
        <div class="test-section" id="sessionTest">
            <h3><i class="bi bi-database me-2"></i>Test 1: Session Storage Validation</h3>
            <p>Memeriksa apakah data buka kas tersedia di sessionStorage</p>
            <div id="sessionResult"></div>
            <button class="btn btn-primary" onclick="testSessionStorage()">Test Session Storage</button>
            <button class="btn btn-success ms-2" onclick="simulateBukaKas()">Simulasi Buka Kas</button>
            <button class="btn btn-danger ms-2" onclick="clearSession()">Clear Session</button>
        </div>

        <!-- Test 2: Button Visibility Simulation -->
        <div class="test-section" id="visibilityTest">
            <h3><i class="bi bi-eye me-2"></i>Test 2: Simulasi Header POS</h3>
            <p>Simulasi tampilan header POS dengan tombol tutup kasir</p>
            
            <div class="pos-header-simulation">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-1"><i class="bi bi-shop me-2"></i>Point of Sales</h4>
                        <p class="mb-0 opacity-75">Sistem Kasir Koperasi Karyawan</p>
                    </div>
                    <div class="text-end">
                        <div class="d-flex gap-2 align-items-center">
                            <small class="opacity-75">F1: Search | ESC: Exit | F12: Clear</small>
                            <button class="btn btn-warning btn-sm me-2" id="tutupKasirBtn" onclick="testTutupKasirModal()">
                                <i class="bi bi-calculator me-1"></i>Tutup Kasir
                            </button>
                            <button class="btn btn-outline-light btn-sm">
                                <i class="bi bi-arrow-left me-1"></i>Kembali ke Menu
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="visibilityResult"></div>
            <button class="btn btn-primary" onclick="testButtonVisibility()">Test Visibility</button>
        </div>

        <!-- Test 3: CSS and Styling Check -->
        <div class="test-section" id="stylingTest">
            <h3><i class="bi bi-palette me-2"></i>Test 3: CSS dan Styling</h3>
            <p>Memeriksa styling dan positioning tombol</p>
            <div id="stylingResult"></div>
            <button class="btn btn-primary" onclick="testStyling()">Test Styling</button>
        </div>

        <!-- Test 4: Responsive Design Check -->
        <div class="test-section" id="responsiveTest">
            <h3><i class="bi bi-phone me-2"></i>Test 4: Responsive Design</h3>
            <p>Memeriksa visibilitas di berbagai ukuran layar</p>
            <div id="responsiveResult"></div>
            <button class="btn btn-primary" onclick="testResponsive()">Test Responsive</button>
        </div>

        <!-- Test 5: Function Availability -->
        <div class="test-section" id="functionTest">
            <h3><i class="bi bi-code me-2"></i>Test 5: Function Availability</h3>
            <p>Memeriksa apakah fungsi showTutupKasirModal tersedia</p>
            <div id="functionResult"></div>
            <button class="btn btn-primary" onclick="testFunctions()">Test Functions</button>
        </div>

        <!-- Test Results Summary -->
        <div class="test-section" id="summaryTest">
            <h3><i class="bi bi-clipboard-check me-2"></i>Ringkasan Hasil Test</h3>
            <div id="summaryResult"></div>
            <button class="btn btn-success" onclick="runAllTests()">Run All Tests</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testResults = {};

        // Test 1: Session Storage
        function testSessionStorage() {
            const bukaKas = sessionStorage.getItem('bukaKas');
            const result = document.getElementById('sessionResult');
            
            if (bukaKas) {
                try {
                    const data = JSON.parse(bukaKas);
                    result.innerHTML = `
                        <div class="alert alert-success">
                            <h5>‚úÖ Session Data Ditemukan</h5>
                            <p><strong>Kasir:</strong> ${data.kasir || 'N/A'}</p>
                            <p><strong>Modal Awal:</strong> ${data.modalAwal || 'N/A'}</p>
                            <p><strong>Waktu Buka:</strong> ${data.waktuBuka || 'N/A'}</p>
                        </div>
                    `;
                    testResults.session = 'pass';
                } catch (e) {
                    result.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>‚ùå Session Data Corrupt</h5>
                            <p>Data buka kas ada tapi tidak valid JSON</p>
                        </div>
                    `;
                    testResults.session = 'fail';
                }
            } else {
                result.innerHTML = `
                    <div class="alert alert-warning">
                        <h5>‚ö†Ô∏è Session Data Tidak Ditemukan</h5>
                        <p>Tidak ada data buka kas di sessionStorage</p>
                    </div>
                `;
                testResults.session = 'warning';
            }
            
            document.getElementById('sessionTest').className = 
                'test-section test-' + (testResults.session === 'pass' ? 'pass' : 
                testResults.session === 'fail' ? 'fail' : 'warning');
        }

        function simulateBukaKas() {
            const bukaKasData = {
                id: 'test-shift-' + Date.now(),
                kasir: 'Test Kasir',
                kasirId: 'test-kasir-001',
                modalAwal: 500000,
                waktuBuka: new Date().toISOString(),
                tanggal: new Date().toISOString().split('T')[0]
            };
            
            sessionStorage.setItem('bukaKas', JSON.stringify(bukaKasData));
            sessionStorage.setItem('shiftId', bukaKasData.id);
            
            alert('Simulasi buka kas berhasil!');
            testSessionStorage();
        }

        function clearSession() {
            sessionStorage.removeItem('bukaKas');
            sessionStorage.removeItem('shiftId');
            alert('Session cleared!');
            testSessionStorage();
        }

        // Test 2: Button Visibility
        function testButtonVisibility() {
            const button = document.getElementById('tutupKasirBtn');
            const result = document.getElementById('visibilityResult');
            
            const computedStyle = window.getComputedStyle(button);
            const isVisible = computedStyle.display !== 'none' && 
                             computedStyle.visibility !== 'hidden' && 
                             computedStyle.opacity !== '0';
            
            const rect = button.getBoundingClientRect();
            const isInViewport = rect.width > 0 && rect.height > 0;
            
            if (isVisible && isInViewport) {
                result.innerHTML = `
                    <div class="alert alert-success">
                        <h5>‚úÖ Tombol Terlihat</h5>
                        <p>Display: ${computedStyle.display}</p>
                        <p>Visibility: ${computedStyle.visibility}</p>
                        <p>Opacity: ${computedStyle.opacity}</p>
                        <p>Dimensions: ${rect.width}x${rect.height}</p>
                    </div>
                `;
                testResults.visibility = 'pass';
            } else {
                result.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>‚ùå Tombol Tidak Terlihat</h5>
                        <p>Display: ${computedStyle.display}</p>
                        <p>Visibility: ${computedStyle.visibility}</p>
                        <p>Opacity: ${computedStyle.opacity}</p>
                        <p>Dimensions: ${rect.width}x${rect.height}</p>
                    </div>
                `;
                testResults.visibility = 'fail';
            }
            
            document.getElementById('visibilityTest').className = 
                'test-section test-' + testResults.visibility;
        }

        // Test 3: Styling
        function testStyling() {
            const button = document.getElementById('tutupKasirBtn');
            const result = document.getElementById('stylingResult');
            const computedStyle = window.getComputedStyle(button);
            
            const issues = [];
            
            // Check z-index
            const zIndex = computedStyle.zIndex;
            if (zIndex === 'auto' || parseInt(zIndex) < 1) {
                issues.push('Z-index mungkin terlalu rendah: ' + zIndex);
            }
            
            // Check position
            const position = computedStyle.position;
            if (position === 'absolute' || position === 'fixed') {
                const top = computedStyle.top;
                const left = computedStyle.left;
                if (top === 'auto' && left === 'auto') {
                    issues.push('Position absolute/fixed tanpa koordinat yang jelas');
                }
            }
            
            // Check overflow
            const overflow = computedStyle.overflow;
            if (overflow === 'hidden') {
                issues.push('Overflow hidden mungkin memotong tombol');
            }
            
            if (issues.length === 0) {
                result.innerHTML = `
                    <div class="alert alert-success">
                        <h5>‚úÖ Styling OK</h5>
                        <p>Z-index: ${zIndex}</p>
                        <p>Position: ${position}</p>
                        <p>Overflow: ${overflow}</p>
                    </div>
                `;
                testResults.styling = 'pass';
            } else {
                result.innerHTML = `
                    <div class="alert alert-warning">
                        <h5>‚ö†Ô∏è Potential Styling Issues</h5>
                        <ul>
                            ${issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                    </div>
                `;
                testResults.styling = 'warning';
            }
            
            document.getElementById('stylingTest').className = 
                'test-section test-' + testResults.styling;
        }

        // Test 4: Responsive
        function testResponsive() {
            const button = document.getElementById('tutupKasirBtn');
            const result = document.getElementById('responsiveResult');
            
            const breakpoints = [
                { name: 'Mobile', width: 576 },
                { name: 'Tablet', width: 768 },
                { name: 'Desktop', width: 992 },
                { name: 'Large', width: 1200 }
            ];
            
            let responsiveResults = [];
            
            breakpoints.forEach(bp => {
                // Simulate different screen sizes
                const mediaQuery = window.matchMedia(`(min-width: ${bp.width}px)`);
                responsiveResults.push({
                    name: bp.name,
                    matches: mediaQuery.matches,
                    width: bp.width
                });
            });
            
            result.innerHTML = `
                <div class="alert alert-info">
                    <h5>üì± Responsive Test Results</h5>
                    <p>Current window width: ${window.innerWidth}px</p>
                    ${responsiveResults.map(r => 
                        `<p>${r.name} (${r.width}px+): ${r.matches ? '‚úÖ' : '‚ùå'}</p>`
                    ).join('')}
                </div>
            `;
            
            testResults.responsive = 'pass';
            document.getElementById('responsiveTest').className = 'test-section test-pass';
        }

        // Test 5: Functions
        function testFunctions() {
            const result = document.getElementById('functionResult');
            const functions = [
                'showTutupKasirModal',
                'prosesTutupKasir',
                'printLaporanTutupKasir'
            ];
            
            let functionResults = [];
            
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                functionResults.push({
                    name: funcName,
                    exists: exists
                });
            });
            
            const allExist = functionResults.every(f => f.exists);
            
            result.innerHTML = `
                <div class="alert alert-${allExist ? 'success' : 'danger'}">
                    <h5>${allExist ? '‚úÖ' : '‚ùå'} Function Availability</h5>
                    ${functionResults.map(f => 
                        `<p>${f.name}: ${f.exists ? '‚úÖ Available' : '‚ùå Missing'}</p>`
                    ).join('')}
                </div>
            `;
            
            testResults.functions = allExist ? 'pass' : 'fail';
            document.getElementById('functionTest').className = 
                'test-section test-' + testResults.functions;
        }

        // Test Modal Function
        function testTutupKasirModal() {
            if (typeof showTutupKasirModal === 'function') {
                try {
                    showTutupKasirModal();
                } catch (e) {
                    alert('Error calling showTutupKasirModal: ' + e.message);
                }
            } else {
                alert('Function showTutupKasirModal tidak tersedia');
            }
        }

        // Run All Tests
        function runAllTests() {
            testSessionStorage();
            setTimeout(() => testButtonVisibility(), 100);
            setTimeout(() => testStyling(), 200);
            setTimeout(() => testResponsive(), 300);
            setTimeout(() => testFunctions(), 400);
            setTimeout(() => showSummary(), 500);
        }

        function showSummary() {
            const result = document.getElementById('summaryResult');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === 'pass').length;
            const failed = Object.values(testResults).filter(r => r === 'fail').length;
            const warnings = Object.values(testResults).filter(r => r === 'warning').length;
            
            result.innerHTML = `
                <div class="alert alert-info">
                    <h5>üìä Test Summary</h5>
                    <p>Total Tests: ${total}</p>
                    <p>‚úÖ Passed: ${passed}</p>
                    <p>‚ùå Failed: ${failed}</p>
                    <p>‚ö†Ô∏è Warnings: ${warnings}</p>
                    
                    <h6>Recommendations:</h6>
                    <ul>
                        ${failed > 0 ? '<li>Ada masalah kritis yang perlu diperbaiki</li>' : ''}
                        ${warnings > 0 ? '<li>Ada potensi masalah yang perlu diperhatikan</li>' : ''}
                        ${testResults.session !== 'pass' ? '<li>Pastikan buka kas dilakukan sebelum akses POS</li>' : ''}
                        ${testResults.functions !== 'pass' ? '<li>Load file js/pos.js dengan benar</li>' : ''}
                    </ul>
                </div>
            `;
        }

        // Auto-run basic tests on load
        window.onload = function() {
            testSessionStorage();
            testButtonVisibility();
        };
    </script>
</body>
</html>