<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 8.1 - Responsive Dashboard Layouts Test</title>
    <link rel="stylesheet" href="css/dashboard-responsive.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }
        
        .test-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .info-item {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .breakpoint-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
        }
        
        /* Sample widget styles for testing */
        .sample-widget {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .sample-widget h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .sample-widget .value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
        }
        
        .sample-widget .trend {
            font-size: 0.9rem;
            color: #666;
        }
        
        .sample-widget.financial-health { border-left: 4px solid #28a745; }
        .sample-widget.cash-balance { border-left: 4px solid #007bff; }
        .sample-widget.member-growth { border-left: 4px solid #ffc107; }
        .sample-widget.transaction-volume { border-left: 4px solid #dc3545; }
        .sample-widget.savings-total { border-left: 4px solid #17a2b8; }
        .sample-widget.loans-outstanding { border-left: 4px solid #6f42c1; }
        
        .test-controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #f8f9fa;
        }
        
        .test-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .layout-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .layout-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .layout-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        
        .layout-detail {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .touch-test-area {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .touch-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .touch-btn {
            min-width: 44px;
            min-height: 44px;
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .touch-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .touch-btn:active {
            background: #004085;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="breakpoint-indicator" id="breakpointIndicator">
        Loading...
    </div>
    
    <div class="test-header">
        <h1>Task 8.1 - Responsive Dashboard Layouts Test</h1>
        <p>Testing mobile-first responsive design with touch optimization for dashboard widgets.</p>
        
        <div class="test-info">
            <div class="info-item">
                <strong>Screen:</strong> <span id="screenSize">-</span>
            </div>
            <div class="info-item">
                <strong>Device:</strong> <span id="deviceType">-</span>
            </div>
            <div class="info-item">
                <strong>Touch:</strong> <span id="touchSupport">-</span>
            </div>
            <div class="info-item">
                <strong>Orientation:</strong> <span id="orientation">-</span>
            </div>
        </div>
    </div>
    
    <div class="test-controls">
        <button class="test-btn" onclick="simulateBreakpoint('xs')">Mobile (XS)</button>
        <button class="test-btn" onclick="simulateBreakpoint('sm')">Mobile (SM)</button>
        <button class="test-btn" onclick="simulateBreakpoint('md')">Tablet (MD)</button>
        <button class="test-btn" onclick="simulateBreakpoint('lg')">Desktop (LG)</button>
        <button class="test-btn" onclick="simulateBreakpoint('xl')">Desktop (XL)</button>
        <button class="test-btn" onclick="togglePerformanceMode()">Toggle Performance Mode</button>
        <button class="test-btn" onclick="toggleTouchMode()">Toggle Touch Mode</button>
    </div>
    
    <div class="layout-info">
        <h4>Current Layout Configuration</h4>
        <div class="layout-details" id="layoutDetails">
            <!-- Layout details will be populated by JavaScript -->
        </div>
    </div>
    
    <div class="touch-test-area">
        <h4>Touch Interaction Test</h4>
        <p>Test touch-friendly buttons and interactions (minimum 44px touch targets):</p>
        <div class="touch-buttons">
            <button class="touch-btn" onclick="showTouchFeedback(this)">Touch Me</button>
            <button class="touch-btn" onclick="showTouchFeedback(this)">Tap Test</button>
            <button class="touch-btn" onclick="showTouchFeedback(this)">Press Here</button>
            <button class="touch-btn" onclick="showTouchFeedback(this)">Click Me</button>
        </div>
        <div id="touchFeedback" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; display: none;">
            Touch feedback will appear here...
        </div>
    </div>
    
    <!-- Dashboard Container -->
    <div class="dashboard-container" id="dashboardContainer">
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Sample widgets for testing responsive layout -->
            <div class="dashboard-widget sample-widget financial-health" data-widget-id="financial-health">
                <h3>Financial Health</h3>
                <div class="value">85%</div>
                <div class="trend">↗ +5% from last month</div>
            </div>
            
            <div class="dashboard-widget sample-widget cash-balance" data-widget-id="cash-balance">
                <h3>Cash Balance</h3>
                <div class="value">Rp 125M</div>
                <div class="trend">↗ +12% from last month</div>
            </div>
            
            <div class="dashboard-widget sample-widget member-growth" data-widget-id="member-growth">
                <h3>Member Growth</h3>
                <div class="value">1,247</div>
                <div class="trend">↗ +23 new members</div>
            </div>
            
            <div class="dashboard-widget sample-widget transaction-volume" data-widget-id="transaction-volume">
                <h3>Transaction Volume</h3>
                <div class="value">Rp 45M</div>
                <div class="trend">↗ +8% from last month</div>
            </div>
            
            <div class="dashboard-widget sample-widget savings-total" data-widget-id="savings-total">
                <h3>Total Savings</h3>
                <div class="value">Rp 890M</div>
                <div class="trend">↗ +15% from last month</div>
            </div>
            
            <div class="dashboard-widget sample-widget loans-outstanding" data-widget-id="loans-outstanding">
                <h3>Loans Outstanding</h3>
                <div class="value">Rp 234M</div>
                <div class="trend">↘ -3% from last month</div>
            </div>
        </div>
    </div>

    <!-- Load ResponsiveLayoutManager -->
    <script src="js/dashboard/ResponsiveLayoutManager.js"></script>
    
    <script>
        // Mock DashboardController for testing
        class MockDashboardController {
            constructor() {
                this.container = document.getElementById('dashboardContainer');
                this.widgets = new Map();
                
                // Initialize mock widgets
                const widgetElements = document.querySelectorAll('[data-widget-id]');
                widgetElements.forEach(element => {
                    const id = element.getAttribute('data-widget-id');
                    this.widgets.set(id, {
                        id: id,
                        element: element,
                        type: 'kpi',
                        config: {
                            size: { width: 3, height: 1 }
                        },
                        handleResize: () => {
                            console.log(`Widget ${id} resized`);
                        }
                    });
                });
            }
        }
        
        // Initialize responsive layout manager
        let dashboardController;
        let responsiveManager;
        
        async function initializeTest() {
            try {
                dashboardController = new MockDashboardController();
                responsiveManager = new ResponsiveLayoutManager(dashboardController);
                
                await responsiveManager.initialize();
                
                // Update UI with current state
                updateLayoutInfo();
                updateDeviceInfo();
                
                console.log('Responsive layout test initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize responsive layout test:', error);
            }
        }
        
        function updateLayoutInfo() {
            if (!responsiveManager) return;
            
            const state = responsiveManager.getResponsiveState();
            const layoutDetails = document.getElementById('layoutDetails');
            const breakpointIndicator = document.getElementById('breakpointIndicator');
            
            // Update breakpoint indicator
            breakpointIndicator.textContent = `${state.breakpoint.toUpperCase()} - ${window.innerWidth}x${window.innerHeight}`;
            
            // Update layout details
            layoutDetails.innerHTML = `
                <div class="layout-detail">
                    <strong>Breakpoint:</strong> ${state.breakpoint}
                </div>
                <div class="layout-detail">
                    <strong>Layout Type:</strong> ${state.isMobile ? 'Mobile' : state.isTablet ? 'Tablet' : 'Desktop'}
                </div>
                <div class="layout-detail">
                    <strong>Columns:</strong> ${state.layoutConfig.columns}
                </div>
                <div class="layout-detail">
                    <strong>Widget Spacing:</strong> ${state.layoutConfig.widgetSpacing}px
                </div>
                <div class="layout-detail">
                    <strong>Container Padding:</strong> ${state.layoutConfig.containerPadding}px
                </div>
                <div class="layout-detail">
                    <strong>Chart Height:</strong> ${state.layoutConfig.chartHeight}px
                </div>
                <div class="layout-detail">
                    <strong>Animations:</strong> ${state.performanceSettings.enableAnimations ? 'Enabled' : 'Disabled'}
                </div>
                <div class="layout-detail">
                    <strong>Shadows:</strong> ${state.performanceSettings.enableShadows ? 'Enabled' : 'Disabled'}
                </div>
            `;
        }
        
        function updateDeviceInfo() {
            if (!responsiveManager) return;
            
            const state = responsiveManager.getResponsiveState();
            
            document.getElementById('screenSize').textContent = `${window.innerWidth}x${window.innerHeight}`;
            document.getElementById('deviceType').textContent = state.isMobile ? 'Mobile' : state.isTablet ? 'Tablet' : 'Desktop';
            document.getElementById('touchSupport').textContent = state.isTouch ? 'Yes' : 'No';
            document.getElementById('orientation').textContent = window.innerWidth > window.innerHeight ? 'Landscape' : 'Portrait';
        }
        
        function simulateBreakpoint(breakpoint) {
            const breakpointWidths = {
                'xs': 400,
                'sm': 600,
                'md': 800,
                'lg': 1000,
                'xl': 1300
            };
            
            const width = breakpointWidths[breakpoint];
            if (width) {
                // Simulate window resize
                Object.defineProperty(window, 'innerWidth', {
                    writable: true,
                    configurable: true,
                    value: width
                });
                
                // Trigger resize event
                window.dispatchEvent(new Event('resize'));
                
                // Update active button
                document.querySelectorAll('.test-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                // Update info
                setTimeout(() => {
                    updateLayoutInfo();
                    updateDeviceInfo();
                }, 100);
            }
        }
        
        function togglePerformanceMode() {
            const container = document.getElementById('dashboardContainer');
            container.classList.toggle('performance-mode');
            
            const isEnabled = container.classList.contains('performance-mode');
            event.target.textContent = isEnabled ? 'Disable Performance Mode' : 'Enable Performance Mode';
            event.target.classList.toggle('active', isEnabled);
        }
        
        function toggleTouchMode() {
            const container = document.getElementById('dashboardContainer');
            container.classList.toggle('is-touch');
            
            const isEnabled = container.classList.contains('is-touch');
            event.target.textContent = isEnabled ? 'Disable Touch Mode' : 'Enable Touch Mode';
            event.target.classList.toggle('active', isEnabled);
        }
        
        function showTouchFeedback(button) {
            const feedback = document.getElementById('touchFeedback');
            const rect = button.getBoundingClientRect();
            
            feedback.style.display = 'block';
            feedback.innerHTML = `
                <strong>Touch Event Detected!</strong><br>
                Button: "${button.textContent}"<br>
                Size: ${rect.width.toFixed(0)}x${rect.height.toFixed(0)}px<br>
                Touch Target: ${rect.width >= 44 && rect.height >= 44 ? '✅ Adequate' : '❌ Too Small'}<br>
                Timestamp: ${new Date().toLocaleTimeString()}
            `;
            
            // Add visual feedback
            button.classList.add('touch-active');
            setTimeout(() => {
                button.classList.remove('touch-active');
            }, 200);
        }
        
        // Event listeners
        window.addEventListener('resize', () => {
            updateLayoutInfo();
            updateDeviceInfo();
        });
        
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateLayoutInfo();
                updateDeviceInfo();
            }, 100);
        });
        
        // Listen for responsive layout events
        document.addEventListener('responsive:layoutChanged', (event) => {
            console.log('Layout changed:', event.detail);
            updateLayoutInfo();
        });
        
        document.addEventListener('responsive:orientationChanged', (event) => {
            console.log('Orientation changed:', event.detail);
            updateDeviceInfo();
        });
        
        document.addEventListener('responsive:tap', (event) => {
            console.log('Tap detected:', event.detail);
        });
        
        // Initialize test when page loads
        document.addEventListener('DOMContentLoaded', initializeTest);
        
        // Test functions for console
        window.testResponsive = {
            getState: () => responsiveManager ? responsiveManager.getResponsiveState() : null,
            simulateBreakpoint: simulateBreakpoint,
            togglePerformanceMode: togglePerformanceMode,
            toggleTouchMode: toggleTouchMode
        };
    </script>
</body>
</html>