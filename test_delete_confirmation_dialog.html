<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Delete Confirmation Dialog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Delete Confirmation Dialog</h1>
        <p>This page tests the delete confirmation dialog for journal entries.</p>
        
        <div class="card mb-3">
            <div class="card-header">
                <h5>Test Scenarios</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-2" onclick="setupTestData()">1. Setup Test Data</button>
                <button class="btn btn-warning mb-2" onclick="testNormalEntry()">2. Test Normal Entry</button>
                <button class="btn btn-danger mb-2" onclick="testReconciledEntry()">3. Test Reconciled Entry (Should Block)</button>
                <button class="btn btn-info mb-2" onclick="testClosedPeriodEntry()">4. Test Closed Period Entry (SuperAdmin)</button>
                <button class="btn btn-secondary mb-2" onclick="testMultipleAccounts()">5. Test Multiple Accounts</button>
            </div>
        </div>
        
        <div id="output" class="alert alert-info">
            <strong>Status:</strong> Ready to test
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { 
            showDeleteJurnalConfirmation,
            initializeJurnalDataStructures
        } from './js/filterHapusJurnal.js';
        
        // Make functions available globally
        window.showDeleteJurnalConfirmation = showDeleteJurnalConfirmation;
        
        // Initialize
        initializeJurnalDataStructures();
        
        window.setupTestData = function() {
            // Setup COA
            const coa = [
                { kode: '1-1000', nama: 'Kas', tipe: 'Aset', saldo: 10000000 },
                { kode: '1-1100', nama: 'Bank', tipe: 'Aset', saldo: 50000000 },
                { kode: '4-1000', nama: 'Pendapatan Penjualan', tipe: 'Pendapatan', saldo: 0 },
                { kode: '5-1000', nama: 'Beban Gaji', tipe: 'Beban', saldo: 0 },
                { kode: '2-1000', nama: 'Hutang Usaha', tipe: 'Kewajiban', saldo: 0 }
            ];
            localStorage.setItem('coa', JSON.stringify(coa));
            
            // Setup test journal entries
            const jurnal = [
                {
                    id: 'test-normal-1',
                    tanggal: '2024-01-15',
                    keterangan: 'Penjualan Tunai',
                    entries: [
                        { akun: '1-1000', debit: 5000000, kredit: 0 },
                        { akun: '4-1000', debit: 0, kredit: 5000000 }
                    ],
                    reconciled: false,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                },
                {
                    id: 'test-reconciled-1',
                    tanggal: '2024-01-10',
                    keterangan: 'Pembayaran Gaji (Sudah Direkonsiliasi)',
                    entries: [
                        { akun: '5-1000', debit: 3000000, kredit: 0 },
                        { akun: '1-1100', debit: 0, kredit: 3000000 }
                    ],
                    reconciled: true,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                },
                {
                    id: 'test-closed-1',
                    tanggal: '2023-12-31',
                    keterangan: 'Jurnal Penutup (Periode Tertutup)',
                    entries: [
                        { akun: '4-1000', debit: 10000000, kredit: 0 },
                        { akun: '5-1000', debit: 0, kredit: 10000000 }
                    ],
                    reconciled: false,
                    periodClosed: true,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                },
                {
                    id: 'test-multiple-1',
                    tanggal: '2024-01-20',
                    keterangan: 'Transaksi Kompleks dengan Banyak Akun',
                    entries: [
                        { akun: '1-1000', debit: 2000000, kredit: 0 },
                        { akun: '1-1100', debit: 3000000, kredit: 0 },
                        { akun: '4-1000', debit: 0, kredit: 4000000 },
                        { akun: '2-1000', debit: 0, kredit: 1000000 }
                    ],
                    reconciled: false,
                    periodClosed: false,
                    deletedAt: null,
                    deletedBy: null,
                    deletedReason: null
                }
            ];
            localStorage.setItem('jurnal', JSON.stringify(jurnal));
            
            // Setup current user as admin
            const user = {
                id: 'user-1',
                username: 'admin',
                role: 'administrator'
            };
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            document.getElementById('output').innerHTML = '<strong>Success:</strong> Test data has been set up!';
        };
        
        window.testNormalEntry = function() {
            document.getElementById('output').innerHTML = '<strong>Testing:</strong> Normal entry (should show dialog)';
            showDeleteJurnalConfirmation('test-normal-1');
        };
        
        window.testReconciledEntry = function() {
            document.getElementById('output').innerHTML = '<strong>Testing:</strong> Reconciled entry (should be blocked)';
            showDeleteJurnalConfirmation('test-reconciled-1');
        };
        
        window.testClosedPeriodEntry = function() {
            // Set user as SuperAdmin
            const user = {
                id: 'user-1',
                username: 'superadmin',
                role: 'SuperAdmin'
            };
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            document.getElementById('output').innerHTML = '<strong>Testing:</strong> Closed period entry as SuperAdmin (should show extra confirmation)';
            showDeleteJurnalConfirmation('test-closed-1');
        };
        
        window.testMultipleAccounts = function() {
            document.getElementById('output').innerHTML = '<strong>Testing:</strong> Entry with multiple accounts';
            showDeleteJurnalConfirmation('test-multiple-1');
        };
        
        // Helper functions for dialog
        window.formatRupiah = function(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        };
        
        window.formatDate = function(date) {
            return new Date(date).toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };
        
        window.showAlert = function(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`;
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        };
    </script>
</body>
</html>
