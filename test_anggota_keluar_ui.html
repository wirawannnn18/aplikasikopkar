<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Anggota Keluar UI - Task 7</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Test Anggota Keluar UI - Task 7</h2>
        
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Task 7.1: Anggota Keluar Button</h5>
            </div>
            <div class="card-body">
                <p>Test: Button "Anggota Keluar" should appear in action column for active members only</p>
                <button class="btn btn-primary" onclick="setupTestData()">Setup Test Data</button>
                <button class="btn btn-success" onclick="renderTestTable()">Render Table</button>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Task 7.2: Anggota Keluar Modal</h5>
            </div>
            <div class="card-body">
                <p>Test: Modal should show anggota details and form for tanggal keluar and alasan</p>
                <button class="btn btn-warning" onclick="testShowModal()">Test Show Modal</button>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Task 7.3: Status Display</h5>
            </div>
            <div class="card-body">
                <p>Test: Anggota with status "Keluar" should have badge and different row color</p>
                <div id="testResults"></div>
            </div>
        </div>
        
        <!-- Test Table -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Master Anggota (Test)</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>NIK</th>
                            <th>Nama</th>
                            <th>No Kartu</th>
                            <th>Departemen</th>
                            <th>Tipe</th>
                            <th>Status</th>
                            <th>Tanggal Daftar</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyAnggota">
                        <tr>
                            <td colspan="8" class="text-center">Klik "Setup Test Data" dan "Render Table"</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Load required modules -->
    <script src="js/utils.js"></script>
    <script src="js/anggotaKeluarRepository.js"></script>
    <script src="js/anggotaKeluarManager.js"></script>
    <script src="js/anggotaKeluarUI.js"></script>
    <script src="js/koperasi.js"></script>
    
    <script>
        // Test setup
        function setupTestData() {
            localStorage.clear();
            
            // Create test anggota data
            const testAnggota = [
                {
                    id: 'test-001',
                    nik: '1234567890123456',
                    nama: 'Budi Santoso',
                    noKartu: 'K001',
                    departemen: 'IT',
                    tipeAnggota: 'Anggota',
                    status: 'Aktif',
                    statusKeanggotaan: 'Aktif',
                    tanggalDaftar: '2024-01-15'
                },
                {
                    id: 'test-002',
                    nik: '1234567890123457',
                    nama: 'Siti Aminah',
                    noKartu: 'K002',
                    departemen: 'Finance',
                    tipeAnggota: 'Anggota',
                    status: 'Aktif',
                    statusKeanggotaan: 'Aktif',
                    tanggalDaftar: '2024-02-20'
                },
                {
                    id: 'test-003',
                    nik: '1234567890123458',
                    nama: 'Ahmad Wijaya',
                    noKartu: 'K003',
                    departemen: 'HR',
                    tipeAnggota: 'Anggota',
                    status: 'Aktif',
                    statusKeanggotaan: 'Keluar',
                    tanggalKeluar: '2024-11-30',
                    alasanKeluar: 'Pindah ke kota lain',
                    pengembalianStatus: 'Pending',
                    tanggalDaftar: '2023-06-10'
                }
            ];
            
            localStorage.setItem('anggota', JSON.stringify(testAnggota));
            localStorage.setItem('currentUser', JSON.stringify({ 
                id: 'test-user', 
                username: 'Test User',
                role: 'administrator'
            }));
            
            alert('Test data berhasil dibuat!\n\n' +
                  '- Budi Santoso (Aktif) - should show "Anggota Keluar" button\n' +
                  '- Siti Aminah (Aktif) - should show "Anggota Keluar" button\n' +
                  '- Ahmad Wijaya (Keluar) - should NOT show "Anggota Keluar" button, has badge "Keluar"');
        }
        
        function renderTestTable() {
            if (typeof renderTableAnggota === 'function') {
                renderTableAnggota();
                
                // Check results
                const tbody = document.getElementById('tbodyAnggota');
                const rows = tbody.querySelectorAll('tr');
                
                let results = '<h6>Test Results:</h6><ul>';
                results += `<li>Total rows: ${rows.length}</li>`;
                
                // Check for "Anggota Keluar" buttons
                const keluarButtons = tbody.querySelectorAll('button[onclick*="showAnggotaKeluarModal"]');
                results += `<li>Anggota Keluar buttons found: ${keluarButtons.length} (expected: 2)</li>`;
                
                // Check for "Keluar" badges
                const keluarBadges = tbody.querySelectorAll('.badge.bg-danger');
                results += `<li>Keluar badges found: ${keluarBadges.length} (expected: 1)</li>`;
                
                // Check for disabled buttons
                const disabledButtons = tbody.querySelectorAll('button[disabled]');
                results += `<li>Disabled buttons found: ${disabledButtons.length} (expected: 2 - edit and delete for keluar member)</li>`;
                
                // Check for table-secondary class
                const secondaryRows = tbody.querySelectorAll('tr.table-secondary');
                results += `<li>Rows with table-secondary class: ${secondaryRows.length} (expected: 1)</li>`;
                
                results += '</ul>';
                
                document.getElementById('testResults').innerHTML = results;
            } else {
                alert('renderTableAnggota function not found!');
            }
        }
        
        function testShowModal() {
            const anggota = JSON.parse(localStorage.getItem('anggota') || '[]');
            if (anggota.length === 0) {
                alert('Please setup test data first!');
                return;
            }
            
            // Test with first active anggota
            const activeAnggota = anggota.find(a => a.statusKeanggotaan !== 'Keluar');
            if (activeAnggota) {
                showAnggotaKeluarModal(activeAnggota.id);
            } else {
                alert('No active anggota found!');
            }
        }
        
        // Test on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Test page loaded');
            console.log('Available functions:', {
                renderTableAnggota: typeof renderTableAnggota,
                showAnggotaKeluarModal: typeof showAnggotaKeluarModal,
                handleMarkKeluar: typeof handleMarkKeluar,
                markAnggotaKeluar: typeof markAnggotaKeluar
            });
        });
    </script>
</body>
</html>
