<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 4 - Balance Sheet Report Display</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .bg-gradient {
            background: linear-gradient(135deg, #2d6a4f 0%, #52b788 100%) !important;
        }
        
        .test-section {
            border-left: 4px solid #28a745;
            padding-left: 1rem;
            margin-bottom: 2rem;
        }
        
        .feature-check {
            color: #28a745;
            font-weight: bold;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-3">
                <!-- Test Control Panel -->
                <div class="card sticky-top">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-gear me-2"></i>Test Controls
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" onclick="setupTestData()">
                                <i class="bi bi-database me-1"></i>Setup Test Data
                            </button>
                            <button class="btn btn-primary" onclick="testBalanceSheetDisplay()">
                                <i class="bi bi-play-circle me-1"></i>Test Display
                            </button>
                            <button class="btn btn-info" onclick="testResponsiveDesign()">
                                <i class="bi bi-phone me-1"></i>Test Responsive
                            </button>
                            <button class="btn btn-warning" onclick="testErrorHandling()">
                                <i class="bi bi-exclamation-triangle me-1"></i>Test Errors
                            </button>
                            <button class="btn btn-secondary" onclick="clearTestData()">
                                <i class="bi bi-trash me-1"></i>Clear Data
                            </button>
                        </div>
                        
                        <hr>
                        
                        <h6>Test Scenarios:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="testBalanced" checked>
                            <label class="form-check-label" for="testBalanced">
                                Balanced Sheet
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="testUnbalanced">
                            <label class="form-check-label" for="testUnbalanced">
                                Unbalanced Sheet
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="testEmptyData">
                            <label class="form-check-label" for="testEmptyData">
                                Empty Sections
                            </label>
                        </div>
                        
                        <hr>
                        
                        <div id="testStatus" class="small"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <!-- Test Results Area -->
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="bi bi-file-earmark-bar-graph me-2" style="color: #28a745;"></i>
                            Test Task 4 - Enhanced Balance Sheet Display
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Testing:</strong> Enhanced balance sheet report display with professional formatting, 
                            improved layout, responsive design, and better user experience features.
                        </div>
                        
                        <!-- Feature Checklist -->
                        <div class="test-section">
                            <h5>Task 4 Features to Test:</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><span class="feature-check">‚úÖ</span> Enhanced HTML template layout</li>
                                        <li><span class="feature-check">‚úÖ</span> Professional report formatting</li>
                                        <li><span class="feature-check">‚úÖ</span> Color-coded sections</li>
                                        <li><span class="feature-check">‚úÖ</span> Improved balance equation display</li>
                                        <li><span class="feature-check">‚úÖ</span> Company header information</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><span class="feature-check">‚úÖ</span> Enhanced action buttons</li>
                                        <li><span class="feature-check">‚úÖ</span> Responsive design</li>
                                        <li><span class="feature-check">‚úÖ</span> Better error handling display</li>
                                        <li><span class="feature-check">‚úÖ</span> Standard balance sheet format</li>
                                        <li><span class="feature-check">‚úÖ</span> Report metadata and summary</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Test Results Display -->
                        <div id="testResults">
                            <div class="alert alert-secondary">
                                <i class="bi bi-arrow-up me-2"></i>
                                Click "Setup Test Data" and then "Test Display" to see the enhanced balance sheet display.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Load required JS files -->
    <script src="js/utils.js"></script>
    <script src="js/reports.js"></script>
    
    <script>
        function setupTestData() {
            updateTestStatus('Setting up comprehensive test data...', 'info');
            
            setTimeout(() => {
                try {
                    // Setup comprehensive COA for balance sheet testing
                    const testCOA = [
                        // Current Assets
                        { kode: '1-1000', nama: 'Kas', tipe: 'Aset', saldo: 15000000 },
                        { kode: '1-1100', nama: 'Bank BCA', tipe: 'Aset', saldo: 25000000 },
                        { kode: '1-1200', nama: 'Piutang Anggota', tipe: 'Aset', saldo: 8000000 },
                        { kode: '1-1300', nama: 'Piutang Karyawan', tipe: 'Aset', saldo: 2000000 },
                        
                        // Fixed Assets
                        { kode: '1-2000', nama: 'Persediaan Barang', tipe: 'Aset', saldo: 12000000 },
                        { kode: '1-2100', nama: 'Peralatan Kantor', tipe: 'Aset', saldo: 5000000 },
                        { kode: '1-2200', nama: 'Kendaraan', tipe: 'Aset', saldo: 18000000 },
                        { kode: '1-2300', nama: 'Bangunan', tipe: 'Aset', saldo: 35000000 },
                        
                        // Current Liabilities
                        { kode: '2-1000', nama: 'Hutang Supplier', tipe: 'Kewajiban', saldo: 3000000 },
                        { kode: '2-1100', nama: 'Simpanan Pokok', tipe: 'Kewajiban', saldo: 15000000 },
                        { kode: '2-1200', nama: 'Simpanan Wajib', tipe: 'Kewajiban', saldo: 25000000 },
                        { kode: '2-1300', nama: 'Simpanan Sukarela', tipe: 'Kewajiban', saldo: 8000000 },
                        { kode: '2-1400', nama: 'Hutang Pajak', tipe: 'Kewajiban', saldo: 2000000 },
                        
                        // Long-term Liabilities
                        { kode: '2-2000', nama: 'Hutang Bank Jangka Panjang', tipe: 'Kewajiban', saldo: 20000000 },
                        { kode: '2-2100', nama: 'Hutang Obligasi', tipe: 'Kewajiban', saldo: 10000000 },
                        
                        // Equity
                        { kode: '3-1000', nama: 'Modal Koperasi', tipe: 'Modal', saldo: 15000000 },
                        { kode: '3-1100', nama: 'Modal Cadangan', tipe: 'Modal', saldo: 5000000 },
                        { kode: '3-2000', nama: 'Laba Ditahan', tipe: 'Modal', saldo: 2000000 }
                    ];
                    
                    // Setup test journal entries
                    const testJournal = [
                        {
                            id: 'J001',
                            tanggal: '2023-01-15',
                            keterangan: 'Penerimaan simpanan pokok anggota baru',
                            entries: [
                                { akun: '1-1000', debit: 2000000, kredit: 0 },
                                { akun: '2-1100', debit: 0, kredit: 2000000 }
                            ]
                        },
                        {
                            id: 'J002',
                            tanggal: '2023-06-30',
                            keterangan: 'Pembelian peralatan kantor',
                            entries: [
                                { akun: '1-2100', debit: 3000000, kredit: 0 },
                                { akun: '1-1100', debit: 0, kredit: 3000000 }
                            ]
                        },
                        {
                            id: 'J003',
                            tanggal: '2023-09-15',
                            keterangan: 'Pembayaran hutang supplier',
                            entries: [
                                { akun: '2-1000', debit: 1000000, kredit: 0 },
                                { akun: '1-1000', debit: 0, kredit: 1000000 }
                            ]
                        },
                        {
                            id: 'J004',
                            tanggal: '2023-12-31',
                            keterangan: 'Pembagian SHU ke laba ditahan',
                            entries: [
                                { akun: '3-2000', debit: 0, kredit: 3000000 },
                                { akun: '1-1000', debit: 3000000, kredit: 0 }
                            ]
                        }
                    ];
                    
                    // Setup company information
                    const testKoperasi = {
                        nama: 'Koperasi Sejahtera Bersama',
                        alamat: 'Jl. Merdeka No. 123, Jakarta',
                        telepon: '021-12345678',
                        email: 'info@koperasisejahtera.co.id'
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('coa', JSON.stringify(testCOA));
                    localStorage.setItem('jurnal', JSON.stringify(testJournal));
                    localStorage.setItem('koperasi', JSON.stringify(testKoperasi));
                    
                    updateTestStatus(`‚úÖ Test data berhasil disetup! COA: ${testCOA.length} akun, Jurnal: ${testJournal.length} entri`, 'success');
                    
                } catch (error) {
                    updateTestStatus(`‚ùå Error setup data: ${error.message}`, 'danger');
                }
            }, 500);
        }
        
        function testBalanceSheetDisplay() {
            updateTestStatus('Testing enhanced balance sheet display...', 'info');
            
            try {
                const coa = JSON.parse(localStorage.getItem('coa') || '[]');
                if (coa.length === 0) {
                    updateTestStatus('‚ùå No test data found. Please setup test data first.', 'warning');
                    return;
                }
                
                // Test different scenarios based on checkboxes
                const testBalanced = document.getElementById('testBalanced').checked;
                const testUnbalanced = document.getElementById('testUnbalanced').checked;
                const testEmptyData = document.getElementById('testEmptyData').checked;
                
                let testData = JSON.parse(localStorage.getItem('coa'));
                
                if (testUnbalanced) {
                    // Modify data to create unbalanced sheet
                    testData[0].saldo += 5000000; // Add to assets without corresponding liability/equity
                    localStorage.setItem('coa', JSON.stringify(testData));
                    updateTestStatus('üîß Modified data to create unbalanced sheet for testing', 'warning');
                }
                
                if (testEmptyData) {
                    // Create minimal data with empty sections
                    const minimalCOA = [
                        { kode: '1-1000', nama: 'Kas', tipe: 'Aset', saldo: 1000000 },
                        { kode: '3-1000', nama: 'Modal', tipe: 'Modal', saldo: 1000000 }
                    ];
                    localStorage.setItem('coa', JSON.stringify(minimalCOA));
                    updateTestStatus('üîß Using minimal data to test empty sections', 'info');
                }
                
                // Create enhanced period object for testing
                const enhancedPeriod = {
                    message: 'Tahunan - 2023',
                    periodType: 'yearly',
                    endDate: new Date('2023-12-31'),
                    dataInfo: {
                        coaCount: testData.length,
                        journalCount: JSON.parse(localStorage.getItem('jurnal') || '[]').length,
                        hasJournalEntries: true
                    }
                };
                
                // Calculate balance sheet
                const balanceSheetData = calculateBalanceSheet(new Date('2023-12-31'));
                
                // Create test results container
                const testResults = document.getElementById('testResults');
                testResults.innerHTML = `
                    <div class="alert alert-success">
                        <h6><i class="bi bi-check-circle me-2"></i>Balance Sheet Display Test Results</h6>
                        <p><strong>‚úÖ Test Passed:</strong> Enhanced balance sheet display rendered successfully!</p>
                        <div class="row">
                            <div class="col-md-6">
                                <small>
                                    <strong>Assets:</strong> ${formatRupiah(balanceSheetData.totals.totalAssets)}<br>
                                    <strong>Liabilities:</strong> ${formatRupiah(balanceSheetData.totals.totalLiabilities)}<br>
                                    <strong>Equity:</strong> ${formatRupiah(balanceSheetData.totals.totalEquity)}
                                </small>
                            </div>
                            <div class="col-md-6">
                                <small>
                                    <strong>Balance Status:</strong> ${balanceSheetData.totals.balanceSheetBalanced ? '‚úÖ Balanced' : '‚ö†Ô∏è Unbalanced'}<br>
                                    <strong>Difference:</strong> ${formatRupiah(Math.abs(balanceSheetData.totals.balanceDifference))}<br>
                                    <strong>Period:</strong> ${enhancedPeriod.periodType}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display the actual enhanced balance sheet -->
                    <div id="neracaReportContent"></div>
                `;
                
                // Display the enhanced balance sheet
                displayCalculatedBalanceSheet(balanceSheetData, enhancedPeriod);
                
                updateTestStatus('‚úÖ Enhanced balance sheet display test completed successfully!', 'success');
                
                // Scroll to results
                document.getElementById('testResults').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                updateTestStatus(`‚ùå Test failed: ${error.message}`, 'danger');
                console.error('Balance sheet display test error:', error);
            }
        }
        
        function testResponsiveDesign() {
            updateTestStatus('Testing responsive design...', 'info');
            
            // Test different viewport sizes
            const viewports = [
                { name: 'Mobile', width: '375px' },
                { name: 'Tablet', width: '768px' },
                { name: 'Desktop', width: '1200px' }
            ];
            
            let testIndex = 0;
            
            function testNextViewport() {
                if (testIndex < viewports.length) {
                    const viewport = viewports[testIndex];
                    updateTestStatus(`üì± Testing ${viewport.name} view (${viewport.width})...`, 'info');
                    
                    // Simulate viewport change
                    document.body.style.maxWidth = viewport.width;
                    document.body.style.margin = '0 auto';
                    
                    setTimeout(() => {
                        testIndex++;
                        testNextViewport();
                    }, 2000);
                } else {
                    // Reset to full width
                    document.body.style.maxWidth = '';
                    document.body.style.margin = '';
                    updateTestStatus('‚úÖ Responsive design test completed! Check how layout adapts to different screen sizes.', 'success');
                }
            }
            
            testNextViewport();
        }
        
        function testErrorHandling() {
            updateTestStatus('Testing error handling scenarios...', 'warning');
            
            try {
                // Test with invalid data
                localStorage.setItem('coa', '[]'); // Empty COA
                
                const enhancedPeriod = {
                    message: 'Test Error Scenario',
                    periodType: 'daily',
                    endDate: new Date(),
                    dataInfo: {
                        coaCount: 0,
                        journalCount: 0,
                        hasJournalEntries: false
                    }
                };
                
                try {
                    const balanceSheetData = calculateBalanceSheet(new Date());
                    updateTestStatus('‚ùå Error handling test failed - should have thrown error for empty COA', 'danger');
                } catch (error) {
                    updateTestStatus('‚úÖ Error handling test passed - correctly caught empty COA error', 'success');
                    
                    // Test error display
                    const testResults = document.getElementById('testResults');
                    testResults.innerHTML = `
                        <div class="alert alert-warning">
                            <h6><i class="bi bi-exclamation-triangle me-2"></i>Error Handling Test</h6>
                            <p><strong>‚úÖ Test Passed:</strong> Error handling works correctly!</p>
                            <p><strong>Error Message:</strong> ${error.message}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                updateTestStatus(`‚ùå Error handling test failed: ${error.message}`, 'danger');
            }
        }
        
        function clearTestData() {
            localStorage.removeItem('coa');
            localStorage.removeItem('jurnal');
            localStorage.removeItem('koperasi');
            
            document.getElementById('testResults').innerHTML = `
                <div class="alert alert-secondary">
                    <i class="bi bi-info-circle me-2"></i>
                    Test data cleared. Click "Setup Test Data" to start testing again.
                </div>
            `;
            
            updateTestStatus('üóëÔ∏è Test data cleared from localStorage', 'secondary');
        }
        
        function updateTestStatus(message, type = 'info') {
            const statusDiv = document.getElementById('testStatus');
            const timestamp = new Date().toLocaleTimeString();
            
            const alertClass = {
                'info': 'alert-info',
                'success': 'alert-success',
                'warning': 'alert-warning',
                'danger': 'alert-danger',
                'secondary': 'alert-secondary'
            }[type] || 'alert-info';
            
            statusDiv.innerHTML = `
                <div class="alert ${alertClass} py-2 mb-2">
                    <small><strong>${timestamp}:</strong> ${message}</small>
                </div>
            ` + statusDiv.innerHTML;
            
            // Keep only last 5 status messages
            const alerts = statusDiv.querySelectorAll('.alert');
            if (alerts.length > 5) {
                for (let i = 5; i < alerts.length; i++) {
                    alerts[i].remove();
                }
            }
        }
        
        // Initialize test environment
        document.addEventListener('DOMContentLoaded', function() {
            updateTestStatus('Task 4 Balance Sheet Display Test Environment Ready', 'info');
            
            // Check if test data exists
            const coa = JSON.parse(localStorage.getItem('coa') || '[]');
            if (coa.length === 0) {
                updateTestStatus('No test data found. Click "Setup Test Data" to create test data.', 'warning');
            } else {
                updateTestStatus(`Existing data found: ${coa.length} COA accounts`, 'info');
            }
        });
    </script>
</body>
</html>