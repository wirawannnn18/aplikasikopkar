<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Master Barang Search & Filter System - Task 4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.25rem;
        }
        .test-success {
            background-color: #d1edff;
            border-left: 4px solid #0d6efd;
        }
        .test-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .test-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .search-demo {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
        }
        .filter-demo {
            background-color: #e9ecef;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
        }
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
        .results-table {
            max-height: 400px;
            overflow-y: auto;
        }
        .pagination-info {
            background-color: #e7f3ff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-search"></i>
                    Test Master Barang Search & Filter System - Task 4
                </h1>
                
                <!-- Test Controls -->
                <div class="test-section">
                    <h3>Test Controls</h3>
                    <div class="row">
                        <div class="col-md-3">
                            <button class="btn btn-primary w-100" onclick="runAllTests()">
                                <i class="fas fa-play"></i> Run All Tests
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-success w-100" onclick="generateSampleData()">
                                <i class="fas fa-database"></i> Generate Sample Data
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-info w-100" onclick="testSearchEngine()">
                                <i class="fas fa-search"></i> Test Search Engine
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-warning w-100" onclick="testFilterManager()">
                                <i class="fas fa-filter"></i> Test Filter Manager
                            </button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-4">
                            <button class="btn btn-secondary w-100" onclick="testQueryBuilder()">
                                <i class="fas fa-cogs"></i> Test Query Builder
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-dark w-100" onclick="testIntegration()">
                                <i class="fas fa-link"></i> Test Integration
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-danger w-100" onclick="clearResults()">
                                <i class="fas fa-trash"></i> Clear Results
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Interactive Demo -->
                <div class="test-section">
                    <h3>Interactive Search & Filter Demo</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Search Term:</label>
                            <input type="text" id="searchInput" class="form-control" placeholder="Search barang..." onkeyup="performInteractiveSearch()">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Category Filter:</label>
                            <select id="categoryFilter" class="form-select" onchange="performInteractiveSearch()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Unit Filter:</label>
                            <select id="unitFilter" class="form-select" onchange="performInteractiveSearch()">
                                <option value="">All Units</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Status Filter:</label>
                            <select id="statusFilter" class="form-select" onchange="performInteractiveSearch()">
                                <option value="">All Status</option>
                                <option value="aktif">Aktif</option>
                                <option value="nonaktif">Non-aktif</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Low Stock:</label>
                            <select id="lowStockFilter" class="form-select" onchange="performInteractiveSearch()">
                                <option value="">All Items</option>
                                <option value="true">Low Stock Only</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-2">
                            <label class="form-label">Sort By:</label>
                            <select id="sortBy" class="form-select" onchange="performInteractiveSearch()">
                                <option value="nama">Nama</option>
                                <option value="kode">Kode</option>
                                <option value="kategori_nama">Kategori</option>
                                <option value="harga_jual">Harga Jual</option>
                                <option value="stok">Stok</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Sort Order:</label>
                            <select id="sortOrder" class="form-select" onchange="performInteractiveSearch()">
                                <option value="asc">Ascending</option>
                                <option value="desc">Descending</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Items per Page:</label>
                            <select id="itemsPerPage" class="form-select" onchange="performInteractiveSearch()">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20" selected>20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Page:</label>
                            <input type="number" id="currentPage" class="form-control" value="1" min="1" onchange="performInteractiveSearch()">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Actions:</label>
                            <div class="btn-group w-100">
                                <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear Filters</button>
                                <button class="btn btn-outline-info" onclick="showQueryStats()">Show Stats</button>
                            </div>
                        </div>
                    </div>

                    <!-- Results Display -->
                    <div id="interactiveResults" class="mt-3"></div>
                </div>

                <!-- Test Results -->
                <div id="testResults"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { SearchEngine } from './js/master-barang/SearchEngine.js';
        import { FilterManager } from './js/master-barang/FilterManager.js';
        import { QueryBuilder } from './js/master-barang/QueryBuilder.js';

        // Global variables
        window.searchEngine = new SearchEngine();
        window.filterManager = new FilterManager();
        window.queryBuilder = new QueryBuilder();
        window.sampleData = [];

        // Generate sample data
        window.generateSampleData = function() {
            const categories = [
                { id: 'cat1', nama: 'Elektronik' },
                { id: 'cat2', nama: 'Makanan' },
                { id: 'cat3', nama: 'Minuman' },
                { id: 'cat4', nama: 'Pakaian' },
                { id: 'cat5', nama: 'Alat Tulis' }
            ];

            const units = [
                { id: 'unit1', nama: 'PCS' },
                { id: 'unit2', nama: 'DUS' },
                { id: 'unit3', nama: 'KG' },
                { id: 'unit4', nama: 'LITER' },
                { id: 'unit5', nama: 'PACK' }
            ];

            const barangNames = [
                'Laptop Gaming', 'Mouse Wireless', 'Keyboard Mechanical', 'Monitor LED',
                'Nasi Goreng', 'Mie Ayam', 'Bakso', 'Soto Ayam',
                'Air Mineral', 'Teh Botol', 'Kopi Susu', 'Jus Jeruk',
                'Kaos Polo', 'Celana Jeans', 'Jaket Hoodie', 'Sepatu Sneakers',
                'Pulpen Gel', 'Pensil 2B', 'Penghapus', 'Penggaris'
            ];

            window.sampleData = [];
            
            for (let i = 0; i < 50; i++) {
                const category = categories[Math.floor(Math.random() * categories.length)];
                const unit = units[Math.floor(Math.random() * units.length)];
                const baseName = barangNames[Math.floor(Math.random() * barangNames.length)];
                
                const item = {
                    id: `brg${i + 1}`,
                    kode: `BRG${String(i + 1).padStart(3, '0')}`,
                    nama: `${baseName} ${i + 1}`,
                    kategori_id: category.id,
                    kategori_nama: category.nama,
                    satuan_id: unit.id,
                    satuan_nama: unit.nama,
                    harga_beli: Math.floor(Math.random() * 500000) + 10000,
                    harga_jual: Math.floor(Math.random() * 750000) + 15000,
                    stok: Math.floor(Math.random() * 100),
                    stok_minimum: Math.floor(Math.random() * 10) + 5,
                    deskripsi: `Deskripsi untuk ${baseName} ${i + 1}`,
                    status: Math.random() > 0.1 ? 'aktif' : 'nonaktif',
                    created_at: Date.now() - Math.floor(Math.random() * 30 * 24 * 60 * 60 * 1000),
                    updated_at: Date.now() - Math.floor(Math.random() * 7 * 24 * 60 * 60 * 1000)
                };

                window.sampleData.push(item);
            }

            // Populate filter dropdowns
            populateFilterDropdowns();
            
            addTestResult('Sample Data Generated', `Generated ${window.sampleData.length} sample barang items`, 'success');
        };

        // Populate filter dropdowns
        function populateFilterDropdowns() {
            const categories = [...new Set(window.sampleData.map(item => item.kategori_nama))];
            const units = [...new Set(window.sampleData.map(item => item.satuan_nama))];

            const categorySelect = document.getElementById('categoryFilter');
            const unitSelect = document.getElementById('unitFilter');

            categorySelect.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(cat => {
                categorySelect.innerHTML += `<option value="${cat}">${cat}</option>`;
            });

            unitSelect.innerHTML = '<option value="">All Units</option>';
            units.forEach(unit => {
                unitSelect.innerHTML += `<option value="${unit}">${unit}</option>`;
            });
        }

        // Test SearchEngine
        window.testSearchEngine = function() {
            if (window.sampleData.length === 0) {
                generateSampleData();
            }

            const tests = [
                {
                    name: 'Basic Search Test',
                    test: () => {
                        const results = window.searchEngine.search(window.sampleData, 'laptop');
                        return results.length > 0 && results.every(item => 
                            item.nama.toLowerCase().includes('laptop') ||
                            item.kode.toLowerCase().includes('laptop') ||
                            item.kategori_nama.toLowerCase().includes('laptop')
                        );
                    }
                },
                {
                    name: 'Case Insensitive Search',
                    test: () => {
                        const results1 = window.searchEngine.search(window.sampleData, 'LAPTOP');
                        const results2 = window.searchEngine.search(window.sampleData, 'laptop');
                        return results1.length === results2.length;
                    }
                },
                {
                    name: 'Empty Search Returns All',
                    test: () => {
                        const results = window.searchEngine.search(window.sampleData, '');
                        return results.length === window.sampleData.length;
                    }
                },
                {
                    name: 'Search with Highlighting',
                    test: () => {
                        const results = window.searchEngine.searchWithHighlight(window.sampleData, 'laptop');
                        return results.length > 0 && results.some(item => 
                            item._highlights && Object.keys(item._highlights).length > 0
                        );
                    }
                },
                {
                    name: 'Search Suggestions',
                    test: () => {
                        const suggestions = window.searchEngine.getSuggestions(window.sampleData, 'lap', 3);
                        return Array.isArray(suggestions) && suggestions.length <= 3;
                    }
                }
            ];

            runTestSuite('SearchEngine Tests', tests);
        };

        // Test FilterManager
        window.testFilterManager = function() {
            if (window.sampleData.length === 0) {
                generateSampleData();
            }

            const tests = [
                {
                    name: 'Set and Get Filter',
                    test: () => {
                        window.filterManager.setFilter('kategori', 'Elektronik');
                        return window.filterManager.getFilter('kategori') === 'Elektronik';
                    }
                },
                {
                    name: 'Apply Category Filter',
                    test: () => {
                        window.filterManager.clearAllFilters();
                        window.filterManager.setFilter('kategori', 'Elektronik');
                        const results = window.filterManager.applyFilters(window.sampleData);
                        return results.every(item => item.kategori_nama === 'Elektronik');
                    }
                },
                {
                    name: 'Apply Status Filter',
                    test: () => {
                        window.filterManager.clearAllFilters();
                        window.filterManager.setFilter('status', 'aktif');
                        const results = window.filterManager.applyFilters(window.sampleData);
                        return results.every(item => item.status === 'aktif');
                    }
                },
                {
                    name: 'Apply Low Stock Filter',
                    test: () => {
                        window.filterManager.clearAllFilters();
                        window.filterManager.setFilter('low_stock', true);
                        const results = window.filterManager.applyFilters(window.sampleData);
                        return results.every(item => item.stok <= item.stok_minimum && item.stok > 0);
                    }
                },
                {
                    name: 'Multiple Filters',
                    test: () => {
                        window.filterManager.clearAllFilters();
                        window.filterManager.setFilter('kategori', 'Elektronik');
                        window.filterManager.setFilter('status', 'aktif');
                        const results = window.filterManager.applyFilters(window.sampleData);
                        return results.every(item => 
                            item.kategori_nama === 'Elektronik' && item.status === 'aktif'
                        );
                    }
                }
            ];

            runTestSuite('FilterManager Tests', tests);
        };

        // Test QueryBuilder
        window.testQueryBuilder = function() {
            if (window.sampleData.length === 0) {
                generateSampleData();
            }

            const tests = [
                {
                    name: 'Basic Query Execution',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            searchTerm: 'laptop',
                            page: 1,
                            limit: 10
                        });
                        return result.data && result.pagination && result.query;
                    }
                },
                {
                    name: 'Query with Filters',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            filters: { kategori: 'Elektronik' },
                            page: 1,
                            limit: 10
                        });
                        return result.data.every(item => item.kategori_nama === 'Elektronik');
                    }
                },
                {
                    name: 'Query with Sorting',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            sortBy: 'nama',
                            sortOrder: 'asc',
                            page: 1,
                            limit: 10
                        });
                        const names = result.data.map(item => item.nama);
                        const sortedNames = [...names].sort();
                        return JSON.stringify(names) === JSON.stringify(sortedNames);
                    }
                },
                {
                    name: 'Pagination Metadata',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            page: 2,
                            limit: 5
                        });
                        return result.pagination.page === 2 && 
                               result.pagination.limit === 5 &&
                               result.pagination.totalItems > 0;
                    }
                },
                {
                    name: 'Search Suggestions',
                    test: () => {
                        const suggestions = window.queryBuilder.getSearchSuggestions(window.sampleData, 'lap');
                        return Array.isArray(suggestions);
                    }
                }
            ];

            runTestSuite('QueryBuilder Tests', tests);
        };

        // Test Integration
        window.testIntegration = function() {
            if (window.sampleData.length === 0) {
                generateSampleData();
            }

            const tests = [
                {
                    name: 'Search + Filter Integration',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            searchTerm: 'laptop',
                            filters: { status: 'aktif' },
                            page: 1,
                            limit: 10
                        });
                        return result.data.every(item => 
                            item.status === 'aktif' && 
                            (item.nama.toLowerCase().includes('laptop') ||
                             item.kode.toLowerCase().includes('laptop') ||
                             item.kategori_nama.toLowerCase().includes('laptop'))
                        );
                    }
                },
                {
                    name: 'Complex Query with All Features',
                    test: () => {
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            searchTerm: 'gaming',
                            filters: { 
                                kategori: 'Elektronik',
                                status: 'aktif'
                            },
                            sortBy: 'harga_jual',
                            sortOrder: 'desc',
                            page: 1,
                            limit: 5
                        });
                        
                        return result.data.length <= 5 &&
                               result.pagination.page === 1 &&
                               result.query.searchTerm === 'gaming';
                    }
                },
                {
                    name: 'Filter Options Generation',
                    test: () => {
                        const categoryOptions = window.queryBuilder.getFilterOptions('kategori', window.sampleData);
                        const statusOptions = window.queryBuilder.getFilterOptions('status', window.sampleData);
                        
                        return Array.isArray(categoryOptions) && 
                               Array.isArray(statusOptions) &&
                               categoryOptions.length > 0;
                    }
                },
                {
                    name: 'Active Filters Summary',
                    test: () => {
                        window.queryBuilder.clearAllFilters();
                        window.queryBuilder.filterManager.setFilter('kategori', 'Elektronik');
                        window.queryBuilder.filterManager.setFilter('status', 'aktif');
                        
                        const summary = window.queryBuilder.getActiveFiltersSummary();
                        return Array.isArray(summary) && summary.length === 2;
                    }
                },
                {
                    name: 'Performance with Large Dataset',
                    test: () => {
                        const startTime = performance.now();
                        const result = window.queryBuilder.executeQuery(window.sampleData, {
                            searchTerm: 'test',
                            filters: { status: 'aktif' },
                            sortBy: 'nama',
                            page: 1,
                            limit: 20
                        });
                        const endTime = performance.now();
                        
                        return (endTime - startTime) < 100 && result.data !== undefined; // Should complete in under 100ms
                    }
                }
            ];

            runTestSuite('Integration Tests', tests);
        };

        // Interactive search function
        window.performInteractiveSearch = function() {
            if (window.sampleData.length === 0) {
                generateSampleData();
            }

            const searchTerm = document.getElementById('searchInput').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const unitFilter = document.getElementById('unitFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const lowStockFilter = document.getElementById('lowStockFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            const sortOrder = document.getElementById('sortOrder').value;
            const limit = parseInt(document.getElementById('itemsPerPage').value);
            const page = parseInt(document.getElementById('currentPage').value);

            const filters = {};
            if (categoryFilter) filters.kategori = categoryFilter;
            if (unitFilter) filters.satuan = unitFilter;
            if (statusFilter) filters.status = statusFilter;
            if (lowStockFilter === 'true') filters.low_stock = true;

            const result = window.queryBuilder.executeQuery(window.sampleData, {
                searchTerm,
                filters,
                sortBy,
                sortOrder,
                page,
                limit
            });

            displayInteractiveResults(result);
        };

        // Display interactive results
        function displayInteractiveResults(result) {
            const container = document.getElementById('interactiveResults');
            
            let html = `
                <div class="pagination-info">
                    <strong>Results:</strong> ${result.pagination.startIndex}-${result.pagination.endIndex} of ${result.pagination.totalItems} items
                    (Page ${result.pagination.page} of ${result.pagination.totalPages})
                </div>
            `;

            if (result.data.length > 0) {
                html += `
                    <div class="results-table">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama</th>
                                    <th>Kategori</th>
                                    <th>Satuan</th>
                                    <th>Harga Jual</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                result.data.forEach(item => {
                    const stockClass = item.stok <= item.stok_minimum ? 'text-danger' : '';
                    const statusClass = item.status === 'aktif' ? 'text-success' : 'text-muted';
                    
                    html += `
                        <tr>
                            <td><code>${item.kode}</code></td>
                            <td>${item.nama}</td>
                            <td><span class="badge bg-secondary">${item.kategori_nama}</span></td>
                            <td><span class="badge bg-info">${item.satuan_nama}</span></td>
                            <td>Rp ${item.harga_jual.toLocaleString()}</td>
                            <td class="${stockClass}">${item.stok} / ${item.stok_minimum}</td>
                            <td class="${statusClass}">${item.status}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                // Pagination controls
                if (result.pagination.totalPages > 1) {
                    html += `
                        <nav>
                            <ul class="pagination justify-content-center">
                                <li class="page-item ${!result.pagination.hasPreviousPage ? 'disabled' : ''}">
                                    <button class="page-link" onclick="goToPage(${result.pagination.page - 1})" ${!result.pagination.hasPreviousPage ? 'disabled' : ''}>Previous</button>
                                </li>
                    `;

                    for (let i = 1; i <= result.pagination.totalPages; i++) {
                        if (i === result.pagination.page) {
                            html += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
                        } else if (Math.abs(i - result.pagination.page) <= 2 || i === 1 || i === result.pagination.totalPages) {
                            html += `<li class="page-item"><button class="page-link" onclick="goToPage(${i})">${i}</button></li>`;
                        } else if (Math.abs(i - result.pagination.page) === 3) {
                            html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                        }
                    }

                    html += `
                                <li class="page-item ${!result.pagination.hasNextPage ? 'disabled' : ''}">
                                    <button class="page-link" onclick="goToPage(${result.pagination.page + 1})" ${!result.pagination.hasNextPage ? 'disabled' : ''}>Next</button>
                                </li>
                            </ul>
                        </nav>
                    `;
                }
            } else {
                html += `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        No items found matching your search criteria.
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Go to page function
        window.goToPage = function(page) {
            document.getElementById('currentPage').value = page;
            performInteractiveSearch();
        };

        // Clear filters
        window.clearFilters = function() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('unitFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('lowStockFilter').value = '';
            document.getElementById('currentPage').value = '1';
            performInteractiveSearch();
        };

        // Show query stats
        window.showQueryStats = function() {
            const stats = window.queryBuilder.getQueryStats();
            const statsHtml = `
                <div class="alert alert-info">
                    <h5>Query Statistics</h5>
                    <ul>
                        <li>Query Cache Size: ${stats.queryCacheSize}</li>
                        <li>Search Cache Size: ${stats.searchStats.cacheSize}</li>
                        <li>Filter Cache Size: ${stats.filterStats.cacheSize}</li>
                        <li>Active Filters: ${stats.filterStats.activeFiltersCount}</li>
                        <li>Last Search Term: "${stats.searchStats.lastSearchTerm}"</li>
                        <li>Last Results Count: ${stats.searchStats.lastResultsCount}</li>
                    </ul>
                </div>
            `;
            
            const container = document.getElementById('interactiveResults');
            container.innerHTML = statsHtml + container.innerHTML;
        };

        // Run test suite
        function runTestSuite(suiteName, tests) {
            let passedTests = 0;
            let totalTests = tests.length;
            let results = [];

            tests.forEach(test => {
                try {
                    const passed = test.test();
                    if (passed) {
                        passedTests++;
                        results.push(`✅ ${test.name}: PASSED`);
                    } else {
                        results.push(`❌ ${test.name}: FAILED`);
                    }
                } catch (error) {
                    results.push(`❌ ${test.name}: ERROR - ${error.message}`);
                }
            });

            const resultType = passedTests === totalTests ? 'success' : 'error';
            const summary = `${suiteName}: ${passedTests}/${totalTests} tests passed`;
            
            addTestResult(summary, results.join('\n'), resultType);
        }

        // Add test result
        function addTestResult(title, content, type = 'success') {
            const resultsContainer = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result test-${type}`;
            resultDiv.innerHTML = `
                <h5>${title}</h5>
                <pre style="white-space: pre-wrap; margin: 0;">${content}</pre>
            `;
            resultsContainer.appendChild(resultDiv);
        }

        // Run all tests
        window.runAllTests = function() {
            clearResults();
            generateSampleData();
            
            setTimeout(() => testSearchEngine(), 100);
            setTimeout(() => testFilterManager(), 200);
            setTimeout(() => testQueryBuilder(), 300);
            setTimeout(() => testIntegration(), 400);
        };

        // Clear results
        window.clearResults = function() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('interactiveResults').innerHTML = '';
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateSampleData();
            performInteractiveSearch();
        });
    </script>
</body>
</html>