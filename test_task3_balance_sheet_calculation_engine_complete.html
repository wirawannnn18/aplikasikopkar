<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 3 - Balance Sheet Calculation Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .engine-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .balance-sheet {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
        }
        .account-group {
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-left: 3px solid #667eea;
            background-color: #f8f9ff;
        }
        .account-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            border-bottom: 1px dotted #ccc;
        }
        .account-total {
            font-weight: bold;
            border-top: 2px solid #333;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
        }
        .calculation-log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .metric-card {
            text-align: center;
            padding: 1rem;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <div class="test-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0"><i class="fas fa-calculator me-3"></i>Task 3 - Balance Sheet Calculation Engine</h1>
                    <p class="mb-0 mt-2">Engine perhitungan neraca dengan kategorisasi akun dan filtering berdasarkan tanggal</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light" onclick="window.history.back()">
                        <i class="fas fa-arrow-left me-2"></i>Kembali
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Calculation Controls -->
        <div class="card engine-card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Balance Sheet Calculation Controls</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label for="targetDate" class="form-label">Target Date</label>
                        <input type="date" class="form-control" id="targetDate" value="2024-12-11">
                    </div>
                    <div class="col-md-4">
                        <label for="periodType" class="form-label">Period Type</label>
                        <select class="form-select" id="periodType">
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-success me-2" onclick="calculateBalanceSheet()">
                            <i class="fas fa-calculator me-1"></i>Calculate Balance Sheet
                        </button>
                        <button class="btn btn-info" onclick="loadSampleData()">
                            <i class="fas fa-database me-1"></i>Load Sample Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Balance Sheet Display -->
        <div class="card engine-card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Balance Sheet Result</h5>
            </div>
            <div class="card-body">
                <div id="balanceSheetDisplay" class="balance-sheet">
                    <div class="text-muted text-center">Balance sheet akan muncul di sini setelah kalkulasi...</div>
                </div>
            </div>
        </div>

        <!-- Calculation Metrics -->
        <div class="card engine-card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Calculation Metrics</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-success" id="totalAssets">0</div>
                            <div class="text-muted">Total Assets</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-warning" id="totalLiabilities">0</div>
                            <div class="text-muted">Total Liabilities</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value text-info" id="totalEquity">0</div>
                            <div class="text-muted">Total Equity</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="balanceCheck">0</div>
                            <div class="text-muted">Balance Check</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COA Structure -->
        <div class="card engine-card mb-4">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0"><i class="fas fa-sitemap me-2"></i>Chart of Accounts Structure</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-success">Assets (1-xxxx)</h6>
                        <ul class="list-unstyled" id="assetAccounts">
                            <li>Loading...</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-warning">Liabilities (2-xxxx)</h6>
                        <ul class="list-unstyled" id="liabilityAccounts">
                            <li>Loading...</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-info">Equity (3-xxxx)</h6>
                        <ul class="list-unstyled" id="equityAccounts">
                            <li>Loading...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculation Log -->
        <div class="card engine-card mb-4">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>Calculation Log</h5>
                <button class="btn btn-sm btn-outline-light" onclick="clearCalculationLog()">
                    <i class="fas fa-trash me-1"></i>Clear Log
                </button>
            </div>
            <div class="card-body p-0">
                <div id="calculationLog" class="calculation-log">
                    <div class="text-muted">Calculation log akan muncul di sini...</div>
                </div>
            </div>
        </div>

        <!-- Engine Testing -->
        <div class="card engine-card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-vial me-2"></i>Engine Testing</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <button class="btn btn-success me-2" onclick="runEngineTests()">
                            <i class="fas fa-play me-1"></i>Run Engine Tests
                        </button>
                        <button class="btn btn-info me-2" onclick="testAccountCategorization()">
                            <i class="fas fa-tags me-1"></i>Test Categorization
                        </button>
                        <button class="btn btn-warning me-2" onclick="testDateFiltering()">
                            <i class="fas fa-calendar me-1"></i>Test Date Filtering
                        </button>
                        <button class="btn btn-danger me-2" onclick="testBalanceEquation()">
                            <i class="fas fa-balance-scale me-1"></i>Test Balance Equation
                        </button>
                    </div>
                    <div class="col-md-4">
                        <div id="testResults" class="text-muted">
                            Test results akan muncul di sini...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let chartOfAccounts = {};
        let journalEntries = [];
        let balanceSheetData = {};
        let calculationMetrics = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeChartOfAccounts();
            loadSampleJournalEntries();
            displayCOAStructure();
            log('Balance Sheet Calculation Engine initialized', 'info');
        });

        // Initialize Chart of Accounts
        function initializeChartOfAccounts() {
            chartOfAccounts = {
                // Assets (1-xxxx)
                '1-1000': { name: 'Kas', category: 'current_assets', type: 'debit' },
                '1-1100': { name: 'Bank', category: 'current_assets', type: 'debit' },
                '1-1200': { name: 'Piutang Usaha', category: 'current_assets', type: 'debit' },
                '1-1300': { name: 'Persediaan', category: 'current_assets', type: 'debit' },
                '1-2000': { name: 'Peralatan', category: 'fixed_assets', type: 'debit' },
                '1-2100': { name: 'Akumulasi Penyusutan Peralatan', category: 'fixed_assets', type: 'credit' },
                '1-2200': { name: 'Gedung', category: 'fixed_assets', type: 'debit' },
                '1-2300': { name: 'Akumulasi Penyusutan Gedung', category: 'fixed_assets', type: 'credit' },
                
                // Liabilities (2-xxxx)
                '2-1000': { name: 'Hutang Usaha', category: 'current_liabilities', type: 'credit' },
                '2-1100': { name: 'Hutang Gaji', category: 'current_liabilities', type: 'credit' },
                '2-1200': { name: 'Hutang Pajak', category: 'current_liabilities', type: 'credit' },
                '2-2000': { name: 'Hutang Bank Jangka Panjang', category: 'long_term_liabilities', type: 'credit' },
                
                // Equity (3-xxxx)
                '3-1000': { name: 'Modal Saham', category: 'equity', type: 'credit' },
                '3-2000': { name: 'Laba Ditahan', category: 'equity', type: 'credit' },
                '3-3000': { name: 'Laba Tahun Berjalan', category: 'equity', type: 'credit' }
            };
        }

        // Load sample journal entries
        function loadSampleJournalEntries() {
            journalEntries = [
                { date: '2024-01-01', account: '1-1000', debit: 5000000, credit: 0, description: 'Kas awal' },
                { date: '2024-01-01', account: '3-1000', debit: 0, credit: 5000000, description: 'Modal awal' },
                { date: '2024-06-15', account: '1-1100', debit: 10000000, credit: 0, description: 'Setoran bank' },
                { date: '2024-06-15', account: '3-1000', debit: 0, credit: 10000000, description: 'Tambahan modal' },
                { date: '2024-12-01', account: '1-1200', debit: 2000000, credit: 0, description: 'Piutang usaha' },
                { date: '2024-12-01', account: '4-1000', debit: 0, credit: 2000000, description: 'Pendapatan' },
                { date: '2024-12-05', account: '1-1300', debit: 3000000, credit: 0, description: 'Pembelian persediaan' },
                { date: '2024-12-05', account: '2-1000', debit: 0, credit: 3000000, description: 'Hutang usaha' },
                { date: '2024-12-10', account: '1-2000', debit: 8000000, credit: 0, description: 'Pembelian peralatan' },
                { date: '2024-12-10', account: '1-1100', debit: 0, credit: 8000000, description: 'Pembayaran dari bank' },
                { date: '2024-12-11', account: '2-1100', debit: 0, credit: 1500000, description: 'Hutang gaji' },
                { date: '2024-12-11', account: '5-1000', debit: 1500000, credit: 0, description: 'Beban gaji' }
            ];
        }

        // Load sample data button
        function loadSampleData() {
            loadSampleJournalEntries();
            log(`Loaded ${journalEntries.length} sample journal entries`, 'success');
            alert('Sample data loaded successfully!');
        }

        // Main calculation function
        function calculateBalanceSheet() {
            const targetDate = new Date(document.getElementById('targetDate').value);
            const periodType = document.getElementById('periodType').value;
            
            log('=== Starting Balance Sheet Calculation ===', 'info');
            log(`Target Date: ${targetDate.toLocaleDateString('id-ID')}`, 'info');
            log(`Period Type: ${periodType}`, 'info');
            
            // Filter journal entries by date
            const filteredEntries = filterJournalEntriesByDate(journalEntries, targetDate, periodType);
            log(`Filtered ${filteredEntries.length} journal entries`, 'info');
            
            // Calculate account balances
            const accountBalances = calculateAccountBalances(filteredEntries);
            log(`Calculated balances for ${Object.keys(accountBalances).length} accounts`, 'info');
            
            // Categorize accounts
            const categorizedBalances = categorizeAccountBalances(accountBalances);
            log('Categorized account balances', 'info');
            
            // Generate balance sheet
            balanceSheetData = generateBalanceSheetData(categorizedBalances);
            log('Generated balance sheet data', 'info');
            
            // Display results
            displayBalanceSheet(balanceSheetData);
            updateMetrics(balanceSheetData);
            
            log('=== Balance Sheet Calculation Completed ===', 'success');
        }

        // Filter journal entries by date
        function filterJournalEntriesByDate(entries, targetDate, periodType) {
            return entries.filter(entry => {
                const entryDate = new Date(entry.date);
                
                switch (periodType) {
                    case 'daily':
                        return entryDate <= targetDate;
                    case 'monthly':
                        const targetMonthEnd = new Date(targetDate.getFullYear(), targetDate.getMonth() + 1, 0);
                        return entryDate <= targetMonthEnd;
                    case 'yearly':
                        const targetYearEnd = new Date(targetDate.getFullYear(), 11, 31);
                        return entryDate <= targetYearEnd;
                    default:
                        return entryDate <= targetDate;
                }
            });
        }

        // Calculate account balances
        function calculateAccountBalances(entries) {
            const balances = {};
            
            entries.forEach(entry => {
                if (!balances[entry.account]) {
                    balances[entry.account] = { debit: 0, credit: 0, balance: 0 };
                }
                
                balances[entry.account].debit += entry.debit;
                balances[entry.account].credit += entry.credit;
            });
            
            // Calculate net balance for each account
            Object.keys(balances).forEach(accountCode => {
                const account = chartOfAccounts[accountCode];
                if (account) {
                    if (account.type === 'debit') {
                        balances[accountCode].balance = balances[accountCode].debit - balances[accountCode].credit;
                    } else {
                        balances[accountCode].balance = balances[accountCode].credit - balances[accountCode].debit;
                    }
                }
            });
            
            return balances;
        }

        // Categorize account balances
        function categorizeAccountBalances(accountBalances) {
            const categorized = {
                current_assets: {},
                fixed_assets: {},
                current_liabilities: {},
                long_term_liabilities: {},
                equity: {}
            };
            
            Object.keys(accountBalances).forEach(accountCode => {
                const account = chartOfAccounts[accountCode];
                if (account && account.category) {
                    categorized[account.category][accountCode] = {
                        ...accountBalances[accountCode],
                        name: account.name,
                        type: account.type
                    };
                }
            });
            
            return categorized;
        }

        // Generate balance sheet data
        function generateBalanceSheetData(categorizedBalances) {
            const balanceSheet = {
                assets: {
                    current_assets: { accounts: categorizedBalances.current_assets, total: 0 },
                    fixed_assets: { accounts: categorizedBalances.fixed_assets, total: 0 },
                    total: 0
                },
                liabilities: {
                    current_liabilities: { accounts: categorizedBalances.current_liabilities, total: 0 },
                    long_term_liabilities: { accounts: categorizedBalances.long_term_liabilities, total: 0 },
                    total: 0
                },
                equity: {
                    accounts: categorizedBalances.equity,
                    total: 0
                }
            };
            
            // Calculate totals
            balanceSheet.assets.current_assets.total = calculateCategoryTotal(categorizedBalances.current_assets);
            balanceSheet.assets.fixed_assets.total = calculateCategoryTotal(categorizedBalances.fixed_assets);
            balanceSheet.assets.total = balanceSheet.assets.current_assets.total + balanceSheet.assets.fixed_assets.total;
            
            balanceSheet.liabilities.current_liabilities.total = calculateCategoryTotal(categorizedBalances.current_liabilities);
            balanceSheet.liabilities.long_term_liabilities.total = calculateCategoryTotal(categorizedBalances.long_term_liabilities);
            balanceSheet.liabilities.total = balanceSheet.liabilities.current_liabilities.total + balanceSheet.liabilities.long_term_liabilities.total;
            
            balanceSheet.equity.total = calculateCategoryTotal(categorizedBalances.equity);
            
            return balanceSheet;
        }

        // Calculate category total
        function calculateCategoryTotal(categoryAccounts) {
            let total = 0;
            Object.keys(categoryAccounts).forEach(accountCode => {
                total += categoryAccounts[accountCode].balance;
            });
            return total;
        }

        // Display balance sheet
        function displayBalanceSheet(balanceSheet) {
            const displayDiv = document.getElementById('balanceSheetDisplay');
            const targetDate = document.getElementById('targetDate').value;
            
            let html = `
                <div class="text-center mb-3">
                    <h5>NERACA</h5>
                    <p>Per ${new Date(targetDate).toLocaleDateString('id-ID')}</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="account-group">
                            <h6 class="text-success">AKTIVA</h6>
                            
                            <div class="mb-3">
                                <strong>Aktiva Lancar:</strong>
                                ${generateAccountList(balanceSheet.assets.current_assets.accounts)}
                                <div class="account-total">
                                    Total Aktiva Lancar: ${formatRupiah(balanceSheet.assets.current_assets.total)}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <strong>Aktiva Tetap:</strong>
                                ${generateAccountList(balanceSheet.assets.fixed_assets.accounts)}
                                <div class="account-total">
                                    Total Aktiva Tetap: ${formatRupiah(balanceSheet.assets.fixed_assets.total)}
                                </div>
                            </div>
                            
                            <div class="account-total" style="border-top: 3px double #333;">
                                <strong>TOTAL AKTIVA: ${formatRupiah(balanceSheet.assets.total)}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="account-group">
                            <h6 class="text-warning">PASSIVA</h6>
                            
                            <div class="mb-3">
                                <strong>Hutang Lancar:</strong>
                                ${generateAccountList(balanceSheet.liabilities.current_liabilities.accounts)}
                                <div class="account-total">
                                    Total Hutang Lancar: ${formatRupiah(balanceSheet.liabilities.current_liabilities.total)}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <strong>Hutang Jangka Panjang:</strong>
                                ${generateAccountList(balanceSheet.liabilities.long_term_liabilities.accounts)}
                                <div class="account-total">
                                    Total Hutang Jangka Panjang: ${formatRupiah(balanceSheet.liabilities.long_term_liabilities.total)}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <strong>Modal:</strong>
                                ${generateAccountList(balanceSheet.equity.accounts)}
                                <div class="account-total">
                                    Total Modal: ${formatRupiah(balanceSheet.equity.total)}
                                </div>
                            </div>
                            
                            <div class="account-total" style="border-top: 3px double #333;">
                                <strong>TOTAL PASSIVA: ${formatRupiah(balanceSheet.liabilities.total + balanceSheet.equity.total)}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            displayDiv.innerHTML = html;
        }

        // Generate account list HTML
        function generateAccountList(accounts) {
            let html = '';
            Object.keys(accounts).forEach(accountCode => {
                const account = accounts[accountCode];
                if (account.balance !== 0) {
                    html += `
                        <div class="account-item">
                            <span>${account.name}</span>
                            <span>${formatRupiah(Math.abs(account.balance))}</span>
                        </div>
                    `;
                }
            });
            return html || '<div class="text-muted">Tidak ada saldo</div>';
        }

        // Update metrics
        function updateMetrics(balanceSheet) {
            document.getElementById('totalAssets').textContent = formatRupiah(balanceSheet.assets.total);
            document.getElementById('totalLiabilities').textContent = formatRupiah(balanceSheet.liabilities.total);
            document.getElementById('totalEquity').textContent = formatRupiah(balanceSheet.equity.total);
            
            const balanceCheck = balanceSheet.assets.total - (balanceSheet.liabilities.total + balanceSheet.equity.total);
            const balanceCheckElement = document.getElementById('balanceCheck');
            balanceCheckElement.textContent = formatRupiah(Math.abs(balanceCheck));
            
            if (balanceCheck === 0) {
                balanceCheckElement.className = 'metric-value text-success';
                balanceCheckElement.parentElement.querySelector('.text-muted').textContent = 'Balance Check ✓';
            } else {
                balanceCheckElement.className = 'metric-value text-danger';
                balanceCheckElement.parentElement.querySelector('.text-muted').textContent = 'Balance Check ✗';
            }
        }

        // Display COA structure
        function displayCOAStructure() {
            const assetsList = document.getElementById('assetAccounts');
            const liabilitiesList = document.getElementById('liabilityAccounts');
            const equityList = document.getElementById('equityAccounts');
            
            assetsList.innerHTML = '';
            liabilitiesList.innerHTML = '';
            equityList.innerHTML = '';
            
            Object.keys(chartOfAccounts).forEach(code => {
                const account = chartOfAccounts[code];
                const listItem = `<li><small>${code}: ${account.name}</small></li>`;
                
                if (code.startsWith('1-')) {
                    assetsList.innerHTML += listItem;
                } else if (code.startsWith('2-')) {
                    liabilitiesList.innerHTML += listItem;
                } else if (code.startsWith('3-')) {
                    equityList.innerHTML += listItem;
                }
            });
        }

        // Testing functions
        function runEngineTests() {
            log('=== Running Engine Tests ===', 'info');
            
            const tests = [
                testAccountCategorization(),
                testDateFiltering(),
                testBalanceCalculation(),
                testBalanceEquation()
            ];
            
            const passed = tests.filter(t => t.success).length;
            const total = tests.length;
            
            const resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = `
                <div class="alert alert-${passed === total ? 'success' : 'warning'} py-2">
                    <strong>Tests: ${passed}/${total} passed</strong>
                </div>
            `;
            
            log(`Engine tests completed: ${passed}/${total} passed`, passed === total ? 'success' : 'warning');
        }

        function testAccountCategorization() {
            try {
                const testBalances = {
                    '1-1000': { balance: 1000000 },
                    '2-1000': { balance: 500000 },
                    '3-1000': { balance: 500000 }
                };
                
                const categorized = categorizeAccountBalances(testBalances);
                const hasAssets = Object.keys(categorized.current_assets).length > 0;
                const hasLiabilities = Object.keys(categorized.current_liabilities).length > 0;
                const hasEquity = Object.keys(categorized.equity).length > 0;
                
                log(`Account categorization test: ${hasAssets && hasLiabilities && hasEquity ? 'PASS' : 'FAIL'}`, 
                    hasAssets && hasLiabilities && hasEquity ? 'success' : 'error');
                
                return { success: hasAssets && hasLiabilities && hasEquity };
            } catch (error) {
                log(`Account categorization test: ERROR - ${error.message}`, 'error');
                return { success: false };
            }
        }

        function testDateFiltering() {
            try {
                const testEntries = [
                    { date: '2024-01-01', account: '1-1000', debit: 1000, credit: 0 },
                    { date: '2024-06-01', account: '1-1000', debit: 1000, credit: 0 },
                    { date: '2024-12-01', account: '1-1000', debit: 1000, credit: 0 }
                ];
                
                const filtered = filterJournalEntriesByDate(testEntries, new Date('2024-06-30'), 'daily');
                const success = filtered.length === 2;
                
                log(`Date filtering test: ${success ? 'PASS' : 'FAIL'}`, success ? 'success' : 'error');
                return { success };
            } catch (error) {
                log(`Date filtering test: ERROR - ${error.message}`, 'error');
                return { success: false };
            }
        }

        function testBalanceCalculation() {
            try {
                const testEntries = [
                    { account: '1-1000', debit: 1000, credit: 0 },
                    { account: '1-1000', debit: 500, credit: 0 },
                    { account: '1-1000', debit: 0, credit: 200 }
                ];
                
                const balances = calculateAccountBalances(testEntries);
                const expectedBalance = 1300; // 1000 + 500 - 200
                const actualBalance = balances['1-1000'].balance;
                const success = actualBalance === expectedBalance;
                
                log(`Balance calculation test: ${success ? 'PASS' : 'FAIL'}`, success ? 'success' : 'error');
                return { success };
            } catch (error) {
                log(`Balance calculation test: ERROR - ${error.message}`, 'error');
                return { success: false };
            }
        }

        function testBalanceEquation() {
            try {
                calculateBalanceSheet(); // Use current data
                
                const assets = balanceSheetData.assets.total;
                const liabilities = balanceSheetData.liabilities.total;
                const equity = balanceSheetData.equity.total;
                const balanced = Math.abs(assets - (liabilities + equity)) < 0.01;
                
                log(`Balance equation test: ${balanced ? 'PASS' : 'FAIL'}`, balanced ? 'success' : 'error');
                log(`Assets: ${formatRupiah(assets)}, Liabilities + Equity: ${formatRupiah(liabilities + equity)}`, 'info');
                
                return { success: balanced };
            } catch (error) {
                log(`Balance equation test: ERROR - ${error.message}`, 'error');
                return { success: false };
            }
        }

        // Utility functions
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function log(message, type = 'info') {
            const logElement = document.getElementById('calculationLog');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = {
                'info': 'text-info',
                'success': 'text-success',
                'error': 'text-danger',
                'warning': 'text-warning'
            };
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> <span class="${typeClass[type] || 'text-dark'}">${message}</span>`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearCalculationLog() {
            document.getElementById('calculationLog').innerHTML = '<div class="text-muted">Calculation log akan muncul di sini...</div>';
        }

        // Auto-calculate on load
        setTimeout(() => {
            calculateBalanceSheet();
        }, 1000);
    </script>
</body>
</html>