<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Validation Errors - Comprehensive Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .fix-section {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .fix-applied {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .console-output {
            background: #000;
            color: #00ff00;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <h2><i class="bi bi-shield-fill-check me-2"></i>Fix Validation Errors - Comprehensive Final</h2>
                <p class="text-muted">Ultimate solution to completely eliminate validation error spam in transformasi barang</p>
                
                <!-- Fix Status -->
                <div class="fix-section">
                    <h4><i class="bi bi-gear-fill me-2"></i>Fix Status</h4>
                    <div id="fix-status" class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>Ready to apply comprehensive validation error fix
                    </div>
                    
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary" onclick="applyComprehensiveFix()">
                            <i class="bi bi-shield-plus me-1"></i>Apply Comprehensive Fix
                        </button>
                        <button class="btn btn-success" onclick="testFixEffectiveness()">
                            <i class="bi bi-check-circle me-1"></i>Test Fix Effectiveness
                        </button>
                        <button class="btn btn-warning" onclick="injectFixIntoTransformasiBarang()">
                            <i class="bi bi-arrow-right-circle me-1"></i>Inject Fix into Transformasi Barang
                        </button>
                    </div>
                </div>
                
                <!-- Console Monitor -->
                <div class="fix-section">
                    <h4><i class="bi bi-terminal me-2"></i>Console Monitor</h4>
                    <div id="console-output" class="console-output">
                        [SYSTEM] Comprehensive validation error fix tool initialized
                        [STATUS] Ready to apply ultimate fix
                    </div>
                    <button class="btn btn-sm btn-outline-secondary mt-2" onclick="clearConsole()">
                        <i class="bi bi-x-circle me-1"></i>Clear Console
                    </button>
                </div>
                
                <!-- Quick Actions -->
                <div class="fix-section">
                    <h4><i class="bi bi-lightning-fill me-2"></i>Quick Actions</h4>
                    <div class="d-flex gap-2">
                        <a href="transformasi_barang.html" target="_blank" class="btn btn-primary">
                            <i class="bi bi-box-arrow-up-right me-1"></i>Test Transformasi Barang
                        </a>
                        <a href="test_validation_error_suppression_final.html" target="_blank" class="btn btn-info">
                            <i class="bi bi-clipboard-check me-1"></i>Open Suppression Test
                        </a>
                        <button class="btn btn-success" onclick="downloadFinalFix()">
                            <i class="bi bi-download me-1"></i>Download Fix Script
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let consoleMessages = [];
        let fixApplied = false;

        // Console capture
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };

        function captureConsole() {
            console.log = function(...args) {
                const message = args.join(' ');
                consoleMessages.push({ type: 'log', message: message, timestamp: new Date().toLocaleTimeString() });
                updateConsoleOutput();
                originalConsole.log.apply(console, args);
            };

            console.warn = function(...args) {
                const message = args.join(' ');
                consoleMessages.push({ type: 'warn', message: message, timestamp: new Date().toLocaleTimeString() });
                updateConsoleOutput();
                originalConsole.warn.apply(console, args);
            };

            console.error = function(...args) {
                const message = args.join(' ');
                consoleMessages.push({ type: 'error', message: message, timestamp: new Date().toLocaleTimeString() });
                updateConsoleOutput();
                originalConsole.error.apply(console, args);
            };
        }

        function updateConsoleOutput() {
            const consoleOutput = document.getElementById('console-output');
            const colorMap = {
                'log': '#00ff00',
                'warn': '#ffff00',
                'error': '#ff6b6b'
            };
            
            consoleOutput.innerHTML = consoleMessages.slice(-50).map(msg => 
                `<span style="color: ${colorMap[msg.type]}">[${msg.timestamp}] ${msg.type.toUpperCase()}: ${msg.message}</span>`
            ).join('\n');
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleMessages = [];
            document.getElementById('console-output').innerHTML = '[SYSTEM] Console cleared\n[STATUS] Ready for new operations';
        }

        function updateFixStatus(message, type = 'info') {
            const fixStatus = document.getElementById('fix-status');
            const iconClass = type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle';
            fixStatus.className = `alert alert-${type}`;
            fixStatus.innerHTML = `<i class="bi bi-${iconClass} me-2"></i>${message}`;
        }

        function applyComprehensiveFix() {
            console.log('üîß Applying comprehensive validation error fix...');
            updateFixStatus('Applying comprehensive validation error fix...', 'info');
            
            try {
                // Create the ultimate fix script
                const comprehensiveFix = `
// COMPREHENSIVE VALIDATION ERROR FIX - ULTIMATE SOLUTION
(function() {
    'use strict';
    
    console.log('üõ°Ô∏è Loading comprehensive validation error fix...');
    
    // Configuration
    const SUPPRESSION_CONFIG = {
        MAX_REPEATED_ERRORS: 1,
        ERROR_RESET_TIME: 3000,
        THROTTLE_LIMIT: 2000,
        VALIDATION_KEYWORDS: [
            'Preview tidak tersedia',
            'Silakan lengkapi form terlebih dahulu',
            '[VALIDATION]',
            'ErrorHandler.js:575'
        ]
    };
    
    // Error tracking
    let errorTracker 