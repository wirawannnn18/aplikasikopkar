<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Barang - Sistem Koperasi</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/fontawesome.min.css">
    <link rel="stylesheet" href="css/master-barang.css">
</head>
<body>
    <div id="app" class="container-fluid">
        <!-- Navigation Header -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-boxes"></i> Master Barang
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('data-table')">
                                <i class="fas fa-table"></i> Data Barang
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('import-export')">
                                <i class="fas fa-exchange-alt"></i> Import/Export
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('category-management')">
                                <i class="fas fa-tags"></i> Kategori & Satuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('audit-logs')">
                                <i class="fas fa-history"></i> Audit Log
                            </a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user"></i> Admin
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="showHelp()">
                                    <i class="fas fa-question-circle"></i> Bantuan
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="index.html">
                                    <i class="fas fa-home"></i> Dashboard Utama
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div id="main-content">
            <!-- Loading Overlay -->
            <div id="loading-overlay" class="loading-overlay" style="display: none;">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="loading-text">Memproses...</div>
                </div>
            </div>
            <!-- Data Table Section -->
            <div id="data-table-section" class="content-section">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h2><i class="fas fa-table"></i> Data Barang</h2>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-success" onclick="showAddForm()">
                            <i class="fas fa-plus"></i> Tambah Barang
                        </button>
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-primary" onclick="showBulkOperations()">
                                <i class="fas fa-tasks"></i> Operasi Massal
                            </button>
                            <button class="btn btn-outline-info" onclick="refreshData()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Pencarian</label>
                                <div class="input-group">
                                    <input type="text" id="search-input" class="form-control" 
                                           placeholder="Cari kode, nama, atau kategori...">
                                    <button class="btn btn-outline-secondary" onclick="clearSearch()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filter Kategori</label>
                                <select id="category-filter" class="form-select">
                                    <option value="">Semua Kategori</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filter Satuan</label>
                                <select id="unit-filter" class="form-select">
                                    <option value="">Semua Satuan</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <div class="d-grid">
                                    <button class="btn btn-primary" onclick="applyFilters()">
                                        <i class="fas fa-filter"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="barang-table" class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                                        </th>
                                        <th onclick="sortTable('kode')" class="sortable">
                                            Kode <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('nama')" class="sortable">
                                            Nama Barang <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('kategori')" class="sortable">
                                            Kategori <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('satuan')" class="sortable">
                                            Satuan <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('harga')" class="sortable">
                                            Harga <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('stok')" class="sortable">
                                            Stok <i class="fas fa-sort"></i>
                                        </th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="barang-tbody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Pagination">
                            <ul class="pagination justify-content-center" id="pagination">
                                <!-- Pagination will be populated by JavaScript -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <!-- Import/Export Section -->
            <div id="import-export-section" class="content-section" style="display: none;">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h2><i class="fas fa-exchange-alt"></i> Import/Export Data</h2>
                    </div>
                </div>

                <div class="row">
                    <!-- Import Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-upload"></i> Import Data</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Download Template</label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-success" onclick="downloadTemplate('excel')">
                                            <i class="fas fa-file-excel"></i> Template Excel
                                        </button>
                                        <button class="btn btn-outline-info" onclick="downloadTemplate('csv')">
                                            <i class="fas fa-file-csv"></i> Template CSV
                                        </button>
                                    </div>
                                </div>
                                
                                <hr>
                                
                                <div class="mb-3">
                                    <label for="import-file" class="form-label">Upload File</label>
                                    <input type="file" id="import-file" class="form-control" 
                                           accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
                                    <div class="form-text">
                                        Format yang didukung: Excel (.xlsx, .xls) dan CSV (.csv)
                                    </div>
                                </div>
                                
                                <div id="import-preview" style="display: none;">
                                    <h6>Preview Data:</h6>
                                    <div class="table-responsive" style="max-height: 300px;">
                                        <table class="table table-sm table-bordered">
                                            <thead id="preview-header"></thead>
                                            <tbody id="preview-body"></tbody>
                                        </table>
                                    </div>
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button class="btn btn-secondary" onclick="cancelImport()">Batal</button>
                                        <button class="btn btn-primary" onclick="processImport()">
                                            <i class="fas fa-check"></i> Proses Import
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-download"></i> Export Data</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Format Export</label>
                                    <select id="export-format" class="form-select">
                                        <option value="excel">Excel (.xlsx)</option>
                                        <option value="csv">CSV (.csv)</option>
                                        <option value="json">JSON (.json)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Filter Export</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="export-all" checked>
                                        <label class="form-check-label" for="export-all">
                                            Export semua data
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="export-filtered">
                                        <label class="form-check-label" for="export-filtered">
                                            Export data yang difilter saja
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button class="btn btn-success" onclick="exportData()">
                                        <i class="fas fa-download"></i> Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import Progress -->
                <div id="import-progress" class="mt-3" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <h6>Progress Import:</h6>
                            <div class="progress mb-2">
                                <div id="import-progress-bar" class="progress-bar" role="progressbar" 
                                     style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                            </div>
                            <div id="import-status" class="text-muted">Memulai import...</div>
                        </div>
                    </div>
                </div>
            </div>