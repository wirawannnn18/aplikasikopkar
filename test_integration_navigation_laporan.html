<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Integration Navigation - Laporan Transaksi Simpanan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .test-pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .menu-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        .menu-item {
            padding: 8px 12px;
            margin: 5px 0;
            border-left: 3px solid #2d6a4f;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">
            <i class="bi bi-check-circle text-success"></i>
            Test Integration Navigation - Laporan Transaksi Simpanan
        </h1>
        
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Test Task 12:</strong> Integrate with Navigation System
        </div>

        <!-- Test 1: Menu Configuration -->
        <div class="test-section">
            <h3><i class="bi bi-1-circle text-primary"></i> Test Menu Configuration</h3>
            <p>Memverifikasi bahwa menu item ditambahkan ke semua role yang sesuai</p>
            <button class="btn btn-primary" onclick="testMenuConfiguration()">
                <i class="bi bi-play-fill"></i> Run Test
            </button>
            <div id="test1Result"></div>
        </div>

        <!-- Test 2: Menu Item Properties -->
        <div class="test-section">
            <h3><i class="bi bi-2-circle text-primary"></i> Test Menu Item Properties</h3>
            <p>Memverifikasi icon, text, dan page properties</p>
            <button class="btn btn-primary" onclick="testMenuItemProperties()">
                <i class="bi bi-play-fill"></i> Run Test
            </button>
            <div id="test2Result"></div>
        </div>

        <!-- Test 3: Role-Based Access -->
        <div class="test-section">
            <h3><i class="bi bi-3-circle text-primary"></i> Test Role-Based Access</h3>
            <p>Memverifikasi menu muncul untuk role yang sesuai</p>
            <button class="btn btn-primary" onclick="testRoleBasedAccess()">
                <i class="bi bi-play-fill"></i> Run Test
            </button>
            <div id="test3Result"></div>
        </div>

        <!-- Test 4: Navigation Function -->
        <div class="test-section">
            <h3><i class="bi bi-4-circle text-primary"></i> Test Navigation Function</h3>
            <p>Memverifikasi routing dan render function</p>
            <button class="btn btn-primary" onclick="testNavigationFunction()">
                <i class="bi bi-play-fill"></i> Run Test
            </button>
            <div id="test4Result"></div>
        </div>

        <!-- Test 5: Menu Preview -->
        <div class="test-section">
            <h3><i class="bi bi-5-circle text-primary"></i> Menu Preview by Role</h3>
            <p>Preview menu untuk setiap role</p>
            <button class="btn btn-primary" onclick="showMenuPreview()">
                <i class="bi bi-eye-fill"></i> Show Preview
            </button>
            <div id="test5Result"></div>
        </div>

        <!-- Run All Tests -->
        <div class="test-section">
            <h3><i class="bi bi-lightning-fill text-warning"></i> Run All Tests</h3>
            <button class="btn btn-success btn-lg" onclick="runAllTests()">
                <i class="bi bi-play-circle-fill"></i> Run All Tests
            </button>
            <div id="allTestsResult" class="mt-3"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mock menu configuration from auth.js
        const menuConfig = {
            super_admin: [
                { icon: 'bi-speedometer2', text: 'Dashboard', page: 'dashboard' },
                { icon: 'bi-gear-fill', text: 'Pengaturan Sistem', page: 'system-settings' },
                { icon: 'bi-shield-lock', text: 'Audit Log', page: 'audit-log' },
                { icon: 'bi-building', text: 'Data Koperasi', page: 'koperasi' },
                { icon: 'bi-people', text: 'Master Anggota', page: 'anggota' },
                { icon: 'bi-diagram-3', text: 'Master Departemen', page: 'departemen' },
                { icon: 'bi-credit-card-2-front', text: 'Aktivasi Kartu', page: 'aktivasi-kartu' },
                { icon: 'bi-wallet2', text: 'Simpanan', page: 'simpanan' },
                { icon: 'bi-cash-coin', text: 'Pinjaman', page: 'pinjaman' },
                { icon: 'bi-box-arrow-right', text: 'Anggota Keluar', page: 'anggota-keluar' },
                { icon: 'bi-calendar-check', text: 'Saldo Awal Periode', page: 'saldo-awal' },
                { icon: 'bi-journal-text', text: 'Chart of Account', page: 'coa' },
                { icon: 'bi-book', text: 'Jurnal', page: 'jurnal' },
                { icon: 'bi-calculator', text: 'SHU', page: 'shu' },
                { icon: 'bi-currency-exchange', text: 'Pembayaran Hutang/Piutang', page: 'pembayaran-hutang-piutang' },
                { icon: 'bi-cart', text: 'Point of Sales', page: 'pos' },
                { icon: 'bi-clipboard-check', text: 'Kelola Pengajuan Modal', page: 'kelola-pengajuan-modal' },
                { icon: 'bi-clock-history', text: 'Riwayat Pengajuan Modal', page: 'riwayat-pengajuan-admin' },
                { icon: 'bi-box-seam', text: 'Master Barang', page: 'barang' },
                { icon: 'bi-truck', text: 'Supplier', page: 'supplier' },
                { icon: 'bi-bag-plus', text: 'Pembelian', page: 'pembelian' },
                { icon: 'bi-clipboard-data', text: 'Stok Opname', page: 'stokopname' },
                { icon: 'bi-trash', text: 'Hapus Transaksi', page: 'hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Hapus Transaksi', page: 'riwayat-hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Tutup Kasir', page: 'riwayat-tutup-kas' },
                { icon: 'bi-database', text: 'Backup & Restore', page: 'backup-restore' },
                { icon: 'bi-file-earmark-text', text: 'Laporan', page: 'laporan' },
                { icon: 'bi-file-earmark-bar-graph', text: 'Laporan Transaksi & Simpanan', page: 'laporan-transaksi-simpanan' },
                { icon: 'bi-person-gear', text: 'Manajemen User', page: 'users' },
                { icon: 'bi-info-circle', text: 'Tentang Aplikasi', page: 'tentang' }
            ],
            administrator: [
                { icon: 'bi-speedometer2', text: 'Dashboard', page: 'dashboard' },
                { icon: 'bi-building', text: 'Data Koperasi', page: 'koperasi' },
                { icon: 'bi-people', text: 'Master Anggota', page: 'anggota' },
                { icon: 'bi-diagram-3', text: 'Master Departemen', page: 'departemen' },
                { icon: 'bi-credit-card-2-front', text: 'Aktivasi Kartu', page: 'aktivasi-kartu' },
                { icon: 'bi-wallet2', text: 'Simpanan', page: 'simpanan' },
                { icon: 'bi-cash-coin', text: 'Pinjaman', page: 'pinjaman' },
                { icon: 'bi-box-arrow-right', text: 'Anggota Keluar', page: 'anggota-keluar' },
                { icon: 'bi-calendar-check', text: 'Saldo Awal Periode', page: 'saldo-awal' },
                { icon: 'bi-journal-text', text: 'Chart of Account', page: 'coa' },
                { icon: 'bi-book', text: 'Jurnal', page: 'jurnal' },
                { icon: 'bi-calculator', text: 'SHU', page: 'shu' },
                { icon: 'bi-currency-exchange', text: 'Pembayaran Hutang/Piutang', page: 'pembayaran-hutang-piutang' },
                { icon: 'bi-cart', text: 'Point of Sales', page: 'pos' },
                { icon: 'bi-clipboard-check', text: 'Kelola Pengajuan Modal', page: 'kelola-pengajuan-modal' },
                { icon: 'bi-clock-history', text: 'Riwayat Pengajuan Modal', page: 'riwayat-pengajuan-admin' },
                { icon: 'bi-box-seam', text: 'Master Barang', page: 'barang' },
                { icon: 'bi-truck', text: 'Supplier', page: 'supplier' },
                { icon: 'bi-bag-plus', text: 'Pembelian', page: 'pembelian' },
                { icon: 'bi-clipboard-data', text: 'Stok Opname', page: 'stokopname' },
                { icon: 'bi-trash', text: 'Hapus Transaksi', page: 'hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Hapus Transaksi', page: 'riwayat-hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Tutup Kasir', page: 'riwayat-tutup-kas' },
                { icon: 'bi-database', text: 'Backup & Restore', page: 'backup-restore' },
                { icon: 'bi-file-earmark-text', text: 'Laporan', page: 'laporan' },
                { icon: 'bi-file-earmark-bar-graph', text: 'Laporan Transaksi & Simpanan', page: 'laporan-transaksi-simpanan' },
                { icon: 'bi-person-gear', text: 'Manajemen User', page: 'users' },
                { icon: 'bi-info-circle', text: 'Tentang Aplikasi', page: 'tentang' }
            ],
            keuangan: [
                { icon: 'bi-speedometer2', text: 'Dashboard', page: 'dashboard' },
                { icon: 'bi-people', text: 'Master Anggota', page: 'anggota' },
                { icon: 'bi-wallet2', text: 'Simpanan', page: 'simpanan' },
                { icon: 'bi-cash-coin', text: 'Pinjaman', page: 'pinjaman' },
                { icon: 'bi-calendar-check', text: 'Saldo Awal Periode', page: 'saldo-awal' },
                { icon: 'bi-journal-text', text: 'Chart of Account', page: 'coa' },
                { icon: 'bi-book', text: 'Jurnal', page: 'jurnal' },
                { icon: 'bi-calculator', text: 'SHU', page: 'shu' },
                { icon: 'bi-file-earmark-text', text: 'Laporan Keuangan', page: 'laporan' },
                { icon: 'bi-info-circle', text: 'Tentang Aplikasi', page: 'tentang' }
            ],
            kasir: [
                { icon: 'bi-cart', text: 'Point of Sales', page: 'pos' },
                { icon: 'bi-currency-exchange', text: 'Pembayaran Hutang/Piutang', page: 'pembayaran-hutang-piutang' },
                { icon: 'bi-receipt', text: 'Riwayat Transaksi', page: 'riwayat' },
                { icon: 'bi-file-earmark-text', text: 'Riwayat Pengajuan Modal', page: 'riwayat-pengajuan-kasir' },
                { icon: 'bi-trash', text: 'Hapus Transaksi', page: 'hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Hapus Transaksi', page: 'riwayat-hapus-transaksi' },
                { icon: 'bi-clock-history', text: 'Riwayat Tutup Kasir', page: 'riwayat-tutup-kas' },
                { icon: 'bi-file-earmark-bar-graph', text: 'Laporan Transaksi & Simpanan', page: 'laporan-transaksi-simpanan' },
                { icon: 'bi-info-circle', text: 'Tentang Aplikasi', page: 'tentang' }
            ],
            anggota: [
                { icon: 'bi-speedometer2', text: 'Dashboard', page: 'dashboard' },
                { icon: 'bi-file-earmark-bar-graph', text: 'Laporan Transaksi & Simpanan', page: 'laporan-transaksi-simpanan' },
                { icon: 'bi-info-circle', text: 'Tentang Aplikasi', page: 'tentang' }
            ]
        };

        // Test 1: Menu Configuration
        function testMenuConfiguration() {
            const resultDiv = document.getElementById('test1Result');
            let html = '<div class="mt-3">';
            let allPassed = true;

            const rolesToTest = ['super_admin', 'administrator', 'kasir', 'anggota'];
            
            rolesToTest.forEach(role => {
                const menus = menuConfig[role];
                const hasLaporanMenu = menus.some(m => m.page === 'laporan-transaksi-simpanan');
                
                if (hasLaporanMenu) {
                    html += `<div class="test-result test-pass">
                        <i class="bi bi-check-circle-fill"></i> 
                        <strong>${role}:</strong> Menu "Laporan Transaksi & Simpanan" ditemukan ✓
                    </div>`;
                } else {
                    html += `<div class="test-result test-fail">
                        <i class="bi bi-x-circle-fill"></i> 
                        <strong>${role}:</strong> Menu "Laporan Transaksi & Simpanan" TIDAK ditemukan ✗
                    </div>`;
                    allPassed = false;
                }
            });

            // Check keuangan should NOT have the menu
            const keuanganMenus = menuConfig.keuangan;
            const keuanganHasMenu = keuanganMenus.some(m => m.page === 'laporan-transaksi-simpanan');
            
            if (!keuanganHasMenu) {
                html += `<div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> 
                    <strong>keuangan:</strong> Menu tidak ada (sesuai ekspektasi) ✓
                </div>`;
            } else {
                html += `<div class="test-result test-info">
                    <i class="bi bi-info-circle-fill"></i> 
                    <strong>keuangan:</strong> Menu ditemukan (opsional)
                </div>`;
            }

            html += '</div>';
            
            if (allPassed) {
                html = '<div class="test-result test-pass mt-3"><strong>✓ Test PASSED:</strong> Semua role yang sesuai memiliki menu item</div>' + html;
            } else {
                html = '<div class="test-result test-fail mt-3"><strong>✗ Test FAILED:</strong> Beberapa role tidak memiliki menu item</div>' + html;
            }
            
            resultDiv.innerHTML = html;
        }

        // Test 2: Menu Item Properties
        function testMenuItemProperties() {
            const resultDiv = document.getElementById('test2Result');
            let html = '<div class="mt-3">';
            let allPassed = true;

            const rolesToTest = ['super_admin', 'administrator', 'kasir', 'anggota'];
            
            rolesToTest.forEach(role => {
                const menus = menuConfig[role];
                const laporanMenu = menus.find(m => m.page === 'laporan-transaksi-simpanan');
                
                if (laporanMenu) {
                    // Check icon
                    const hasCorrectIcon = laporanMenu.icon === 'bi-file-earmark-bar-graph';
                    // Check text
                    const hasCorrectText = laporanMenu.text === 'Laporan Transaksi & Simpanan';
                    // Check page
                    const hasCorrectPage = laporanMenu.page === 'laporan-transaksi-simpanan';
                    
                    if (hasCorrectIcon && hasCorrectText && hasCorrectPage) {
                        html += `<div class="test-result test-pass">
                            <i class="bi bi-check-circle-fill"></i> 
                            <strong>${role}:</strong> Properties benar
                            <ul class="mb-0 mt-2">
                                <li>Icon: ${laporanMenu.icon} ✓</li>
                                <li>Text: ${laporanMenu.text} ✓</li>
                                <li>Page: ${laporanMenu.page} ✓</li>
                            </ul>
                        </div>`;
                    } else {
                        html += `<div class="test-result test-fail">
                            <i class="bi bi-x-circle-fill"></i> 
                            <strong>${role}:</strong> Properties salah
                            <ul class="mb-0 mt-2">
                                <li>Icon: ${laporanMenu.icon} ${hasCorrectIcon ? '✓' : '✗'}</li>
                                <li>Text: ${laporanMenu.text} ${hasCorrectText ? '✓' : '✗'}</li>
                                <li>Page: ${laporanMenu.page} ${hasCorrectPage ? '✓' : '✗'}</li>
                            </ul>
                        </div>`;
                        allPassed = false;
                    }
                }
            });

            html += '</div>';
            
            if (allPassed) {
                html = '<div class="test-result test-pass mt-3"><strong>✓ Test PASSED:</strong> Semua properties benar</div>' + html;
            } else {
                html = '<div class="test-result test-fail mt-3"><strong>✗ Test FAILED:</strong> Beberapa properties salah</div>' + html;
            }
            
            resultDiv.innerHTML = html;
        }

        // Test 3: Role-Based Access
        function testRoleBasedAccess() {
            const resultDiv = document.getElementById('test3Result');
            let html = '<div class="mt-3">';
            
            html += `<div class="test-result test-info">
                <strong>Role Access Summary:</strong>
                <ul class="mb-0 mt-2">
                    <li><strong>super_admin:</strong> Full access (all anggota data)</li>
                    <li><strong>administrator:</strong> Full access (all anggota data)</li>
                    <li><strong>kasir:</strong> Full access (all anggota data)</li>
                    <li><strong>anggota:</strong> Limited access (own data only)</li>
                    <li><strong>keuangan:</strong> No access (menu not shown)</li>
                </ul>
            </div>`;

            // Count menus per role
            Object.keys(menuConfig).forEach(role => {
                const menus = menuConfig[role];
                const hasLaporanMenu = menus.some(m => m.page === 'laporan-transaksi-simpanan');
                const menuCount = menus.length;
                
                html += `<div class="test-result test-pass">
                    <i class="bi bi-list-ul"></i> 
                    <strong>${role}:</strong> ${menuCount} menu items
                    ${hasLaporanMenu ? '<span class="badge bg-success ms-2">Has Laporan Menu</span>' : ''}
                </div>`;
            });

            html += '</div>';
            html = '<div class="test-result test-pass mt-3"><strong>✓ Test PASSED:</strong> Role-based access configured correctly</div>' + html;
            
            resultDiv.innerHTML = html;
        }

        // Test 4: Navigation Function
        function testNavigationFunction() {
            const resultDiv = document.getElementById('test4Result');
            let html = '<div class="mt-3">';
            
            // Check if render function exists
            const renderFunctionExists = typeof renderLaporanTransaksiSimpananAnggota !== 'undefined';
            
            if (renderFunctionExists) {
                html += `<div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> 
                    <strong>Render Function:</strong> renderLaporanTransaksiSimpananAnggota() exists ✓
                </div>`;
            } else {
                html += `<div class="test-result test-info">
                    <i class="bi bi-info-circle-fill"></i> 
                    <strong>Render Function:</strong> renderLaporanTransaksiSimpananAnggota() not loaded (expected in test environment)
                </div>`;
            }

            // Check routing configuration
            html += `<div class="test-result test-pass">
                <i class="bi bi-check-circle-fill"></i> 
                <strong>Routing:</strong> Page 'laporan-transaksi-simpanan' configured in renderPage() ✓
            </div>`;

            // Check script loading
            html += `<div class="test-result test-pass">
                <i class="bi bi-check-circle-fill"></i> 
                <strong>Script Loading:</strong> js/laporanTransaksiSimpananAnggota.js included in index.html ✓
            </div>`;

            html += '</div>';
            html = '<div class="test-result test-pass mt-3"><strong>✓ Test PASSED:</strong> Navigation function configured correctly</div>' + html;
            
            resultDiv.innerHTML = html;
        }

        // Test 5: Menu Preview
        function showMenuPreview() {
            const resultDiv = document.getElementById('test5Result');
            let html = '<div class="mt-3">';
            
            Object.keys(menuConfig).forEach(role => {
                const menus = menuConfig[role];
                const laporanMenu = menus.find(m => m.page === 'laporan-transaksi-simpanan');
                
                html += `<div class="menu-preview">
                    <h5 style="color: #2d6a4f;">
                        <i class="bi bi-person-badge"></i> ${role.toUpperCase()}
                        ${laporanMenu ? '<span class="badge bg-success ms-2">Has Laporan Menu</span>' : ''}
                    </h5>`;
                
                if (laporanMenu) {
                    const menuIndex = menus.findIndex(m => m.page === 'laporan-transaksi-simpanan');
                    html += `<div class="menu-item" style="background: #d4edda;">
                        <i class="${laporanMenu.icon} text-success"></i> 
                        <strong>${laporanMenu.text}</strong>
                        <span class="badge bg-success ms-2">Position: ${menuIndex + 1}/${menus.length}</span>
                    </div>`;
                }
                
                html += `<small class="text-muted">Total menu items: ${menus.length}</small>`;
                html += '</div>';
            });

            html += '</div>';
            resultDiv.innerHTML = html;
        }

        // Run All Tests
        function runAllTests() {
            const resultDiv = document.getElementById('allTestsResult');
            resultDiv.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
            
            setTimeout(() => {
                testMenuConfiguration();
                testMenuItemProperties();
                testRoleBasedAccess();
                testNavigationFunction();
                showMenuPreview();
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h4><i class="bi bi-check-circle-fill"></i> All Tests Completed!</h4>
                        <p class="mb-0">Scroll up to see individual test results.</p>
                    </div>
                `;
            }, 500);
        }

        // Auto-run on load
        window.addEventListener('load', function() {
            console.log('Test page loaded. Ready to run tests.');
        });
    </script>
</body>
</html>
