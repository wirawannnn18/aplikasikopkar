<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Template Manager - Task 7</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Test Template Manager - Task 7</h2>
        <p class="text-muted">Testing template management functionality</p>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Template Download</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Format:</label>
                            <select id="templateFormat" class="form-select">
                                <option value="csv">CSV</option>
                                <option value="xlsx">Excel</option>
                            </select>
                        </div>
                        <button id="downloadTemplateBtn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Template
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Template Information</h5>
                    </div>
                    <div class="card-body">
                        <div id="templateInfo"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Template Instructions</h5>
                    </div>
                    <div class="card-body">
                        <div id="instructionsContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { TemplateManager } from './js/master-barang/TemplateManager.js';

        // Initialize template manager
        const templateManager = new TemplateManager();

        // Test results container
        const testResults = document.getElementById('testResults');
        const templateInfo = document.getElementById('templateInfo');
        const instructionsContainer = document.getElementById('instructionsContainer');

        function addTestResult(test, result, details = '') {
            const alertClass = result ? 'alert-success' : 'alert-danger';
            const icon = result ? '✓' : '✗';
            testResults.innerHTML += `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <strong>${icon} ${test}</strong><br>
                    ${details}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        function runTests() {
            testResults.innerHTML = '<h6>Running Tests...</h6>';

            try {
                // Test 1: Template data generation
                const templateData = templateManager.generateTemplateData();
                const hasHeaders = templateData.headers && templateData.headers.length > 0;
                const hasData = templateData.data && templateData.data.length > 0;
                addTestResult(
                    'Template Data Generation', 
                    hasHeaders && hasData,
                    `Headers: ${templateData.headers?.length || 0}, Sample rows: ${templateData.data?.length || 0}`
                );

                // Test 2: File name generation
                const csvFileName = templateManager.generateTemplateFileName('csv');
                const xlsxFileName = templateManager.generateTemplateFileName('xlsx');
                const validCsvName = csvFileName.includes('template_master_barang') && csvFileName.endsWith('.csv');
                const validXlsxName = xlsxFileName.includes('template_master_barang') && xlsxFileName.endsWith('.xlsx');
                addTestResult(
                    'File Name Generation',
                    validCsvName && validXlsxName,
                    `CSV: ${csvFileName}<br>Excel: ${xlsxFileName}`
                );

                // Test 3: Format validation
                const validFormats = ['csv', 'xlsx', 'CSV', 'XLSX'].every(f => templateManager.validateTemplateFormat(f));
                const invalidFormats = ['pdf', 'doc', 'txt', ''].every(f => !templateManager.validateTemplateFormat(f));
                addTestResult(
                    'Format Validation',
                    validFormats && invalidFormats,
                    'Valid formats accepted, invalid formats rejected'
                );

                // Test 4: Template instructions
                const instructions = templateManager.getTemplateInstructions();
                const hasInstructions = instructions.title && instructions.instructions && instructions.columns;
                addTestResult(
                    'Template Instructions',
                    hasInstructions,
                    `Title: ${instructions.title ? 'Present' : 'Missing'}`
                );

                // Display template information
                templateInfo.innerHTML = `
                    <p><strong>Headers:</strong> ${templateData.headers.join(', ')}</p>
                    <p><strong>Sample Data Rows:</strong> ${templateData.data.length}</p>
                    <p><strong>Supported Formats:</strong> CSV, Excel</p>
                `;

                // Display instructions
                instructionsContainer.innerHTML = `
                    <h6>${instructions.title}</h6>
                    <ul>
                        ${instructions.instructions.map(inst => `<li>${inst}</li>`).join('')}
                    </ul>
                    <h6>Column Descriptions:</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Column</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${instructions.columns.map(col => `
                                    <tr>
                                        <td><strong>${col.name}</strong></td>
                                        <td>${col.required ? '<span class="badge bg-danger">Required</span>' : '<span class="badge bg-secondary">Optional</span>'}</td>
                                        <td>${col.description}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

            } catch (error) {
                addTestResult('Test Execution', false, `Error: ${error.message}`);
            }
        }

        // Download template button
        document.getElementById('downloadTemplateBtn').addEventListener('click', () => {
            const format = document.getElementById('templateFormat').value;
            try {
                templateManager.downloadTemplate(format);
                addTestResult('Template Download', true, `${format.toUpperCase()} template download initiated`);
            } catch (error) {
                addTestResult('Template Download', false, `Error: ${error.message}`);
            }
        });

        // Run tests on page load
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>