<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test POS Fix Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .test-success {
            background-color: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        .test-error {
            background-color: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2><i class="bi bi-check-circle me-2"></i>Test POS Fix Verification</h2>
        <p class="text-muted">Verifikasi bahwa POS sudah berfungsi dengan baik setelah perbaikan syntax error</p>

        <div class="test-section">
            <h5>1. Test Load POS JavaScript</h5>
            <button class="btn btn-primary" onclick="testLoadPOS()">Test Load POS</button>
            <div id="testLoadResult" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h5>2. Test POS Functions</h5>
            <button class="btn btn-primary" onclick="testPOSFunctions()">Test Functions</button>
            <div id="testFunctionsResult" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h5>3. Test POS Rendering (Simulation)</h5>
            <button class="btn btn-primary" onclick="testPOSRendering()">Test Rendering</button>
            <div id="testRenderingResult" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h5>4. Test Actual POS Menu</h5>
            <p class="text-muted">Klik tombol ini untuk membuka POS yang sudah diperbaiki</p>
            <button class="btn btn-success" onclick="openActualPOS()">Buka POS Menu</button>
            <div id="testActualResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Include required dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mock required functions and variables -->
    <script>
        // Mock global variables and functions for testing
        let currentUser = { name: 'Test Kasir', id: 'test123' };
        let cart = [];
        
        function generateId() {
            return 'test_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID');
        }
        
        function showAlert(message, type = 'info') {
            console.log(`Alert (${type}): ${message}`);
            alert(message);
        }
        
        function navigateTo(page) {
            console.log(`Navigate to: ${page}`);
        }
        
        function validateAnggotaForPOS(anggotaId) {
            return { valid: true, anggota: { id: anggotaId, nama: 'Test Member' } };
        }
        
        // Mock localStorage data
        localStorage.setItem('barang', JSON.stringify([
            { id: '1', nama: 'Test Product 1', hargaJual: 10000, stok: 50, barcode: '123456' },
            { id: '2', nama: 'Test Product 2', hargaJual: 15000, stok: 30, barcode: '789012' }
        ]));
        
        localStorage.setItem('anggota', JSON.stringify([
            { id: '1', nama: 'Test Member 1', nik: '1234567890', statusKeanggotaan: 'Aktif' },
            { id: '2', nama: 'Test Member 2', nik: '0987654321', statusKeanggotaan: 'Aktif' }
        ]));
        
        localStorage.setItem('koperasi', JSON.stringify({
            nama: 'Test Koperasi',
            alamat: 'Test Address',
            telepon: '021-12345678'
        }));
        
        // Set mock buka kas session
        sessionStorage.setItem('bukaKas', JSON.stringify({
            id: 'test_shift_123',
            kasir: 'Test Kasir',
            modalAwal: 500000,
            waktuBuka: new Date().toISOString()
        }));
    </script>
    
    <!-- Load the fixed POS script -->
    <script src="js/pos.js"></script>
    
    <script>
        function testLoadPOS() {
            const resultDiv = document.getElementById('testLoadResult');
            resultDiv.style.display = 'block';
            
            try {
                // Check if main POS functions exist
                const requiredFunctions = [
                    'renderPOS',
                    'exitPOSFullscreen', 
                    'initializePOSFullscreen',
                    'loadProductsPOS',
                    'addToCartPOS',
                    'processPayment',
                    'selectPaymentMethod'
                ];
                
                const missingFunctions = [];
                requiredFunctions.forEach(func => {
                    if (typeof window[func] !== 'function') {
                        missingFunctions.push(func);
                    }
                });
                
                if (missingFunctions.length === 0) {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.innerHTML = '<i class="bi bi-check-circle me-2"></i>✅ Semua fungsi POS berhasil dimuat!';
                } else {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `<i class="bi bi-x-circle me-2"></i>❌ Fungsi yang hilang: ${missingFunctions.join(', ')}`;
                }
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="bi bi-x-circle me-2"></i>❌ Error loading POS: ${error.message}`;
            }
        }
        
        function testPOSFunctions() {
            const resultDiv = document.getElementById('testFunctionsResult');
            resultDiv.style.display = 'block';
            
            try {
                let testResults = [];
                
                // Test cart functions
                cart = [];
                addToCartPOS('1');
                if (cart.length === 1) {
                    testResults.push('✅ addToCartPOS works');
                } else {
                    testResults.push('❌ addToCartPOS failed');
                }
                
                // Test payment method selection
                selectPaymentMethod('cash');
                if (selectedPaymentMethod === 'cash') {
                    testResults.push('✅ selectPaymentMethod works');
                } else {
                    testResults.push('❌ selectPaymentMethod failed');
                }
                
                // Test calculation functions
                if (typeof calculateChangePOS === 'function') {
                    testResults.push('✅ calculateChangePOS exists');
                } else {
                    testResults.push('❌ calculateChangePOS missing');
                }
                
                resultDiv.className = 'test-result test-success';
                resultDiv.innerHTML = '<i class="bi bi-check-circle me-2"></i>' + testResults.join('<br>');
                
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="bi bi-x-circle me-2"></i>❌ Error testing functions: ${error.message}`;
            }
        }
        
        function testPOSRendering() {
            const resultDiv = document.getElementById('testRenderingResult');
            resultDiv.style.display = 'block';
            
            try {
                // Create a temporary container for testing
                const testContainer = document.createElement('div');
                testContainer.id = 'mainContent';
                testContainer.style.display = 'none';
                document.body.appendChild(testContainer);
                
                // Create mock sidebar and navbar
                const sidebar = document.createElement('div');
                sidebar.id = 'sidebar';
                document.body.appendChild(sidebar);
                
                const navbar = document.createElement('div');
                navbar.className = 'navbar';
                document.body.appendChild(navbar);
                
                // Test rendering
                renderPOS();
                
                // Check if POS container was created
                const posContainer = testContainer.querySelector('.pos-container');
                if (posContainer) {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.innerHTML = '<i class="bi bi-check-circle me-2"></i>✅ POS rendering berhasil! Container dibuat dengan benar.';
                } else {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = '<i class="bi bi-x-circle me-2"></i>❌ POS container tidak ditemukan setelah rendering.';
                }
                
                // Cleanup
                testContainer.remove();
                sidebar.remove();
                navbar.remove();
                
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="bi bi-x-circle me-2"></i>❌ Error testing rendering: ${error.message}`;
            }
        }
        
        function openActualPOS() {
            const resultDiv = document.getElementById('testActualResult');
            resultDiv.style.display = 'block';
            
            try {
                // Open the actual POS in a new window
                const posWindow = window.open('index.html', '_blank', 'width=1200,height=800');
                
                resultDiv.className = 'test-result test-success';
                resultDiv.innerHTML = '<i class="bi bi-check-circle me-2"></i>✅ POS menu dibuka di window baru. Silakan test langsung di aplikasi utama.';
                
                // Instructions
                setTimeout(() => {
                    resultDiv.innerHTML += '<br><br><strong>Instruksi:</strong><br>' +
                        '1. Login ke aplikasi<br>' +
                        '2. Klik menu "Point of Sales"<br>' +
                        '3. Pastikan tidak ada error "Terjadi kesalahan saat memuat halaman"<br>' +
                        '4. POS harus terbuka dalam mode fullscreen dengan interface yang bagus';
                }, 1000);
                
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="bi bi-x-circle me-2"></i>❌ Error opening POS: ${error.message}`;
            }
        }
        
        // Auto-run basic tests on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                testLoadPOS();
            }, 500);
        });
    </script>
</body>
</html>