<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Pembayaran Hutang/Piutang - INSTANT SOLUTION</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <div class="alert alert-info">
            <h4><i class="bi bi-tools"></i> Instant Fix untuk Menu Pembayaran Hutang/Piutang</h4>
            <p>Memperbaiki masalah menu yang tidak bisa dibuka dengan solusi langsung.</p>
            <button class="btn btn-primary" onclick="applyInstantFix()">
                <i class="bi bi-lightning"></i> Apply Instant Fix
            </button>
            <button class="btn btn-success ms-2" onclick="testMenu()" id="testBtn" disabled>
                <i class="bi bi-check"></i> Test Menu
            </button>
        </div>
        
        <div class="alert alert-secondary" id="status">
            <i class="bi bi-clock"></i> Siap untuk menerapkan perbaikan...
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const icons = {
                'info': 'bi-info-circle',
                'success': 'bi-check-circle',
                'error': 'bi-x-circle',
                'warning': 'bi-exclamation-triangle'
            };
            
            status.className = `alert alert-${type}`;
            status.innerHTML = `<i class="bi ${icons[type]}"></i> ${message}`;
        }

        function applyInstantFix() {
            updateStatus('Menerapkan perbaikan instant...', 'info');
            
            try {
                // Fix 1: Create robust renderPembayaranHutangPiutangIntegrated function
                window.renderPembayaranHutangPiutangIntegrated = function() {
                    console.log('üîÑ Integrated payment interface called');
                    
                    const content = document.getElementById('mainContent');
                    if (!content) {
                        console.error('Main content element not found');
                        return;
                    }
                    
                    // Show loading first
                    content.innerHTML = `
                        <div class="container-fluid py-4">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3">Memuat interface pembayaran...</p>
                            </div>
                        </div>
                    `;
                    
                    // Try integrated interface first
                    setTimeout(() => {
                        try {
                            if (typeof window.PembayaranHutangPiutangIntegrated === 'function') {
                                console.log('‚úÖ Using integrated interface');
                                const controller = new window.PembayaranHutangPiutangIntegrated();
                                controller.initialize().catch(error => {
                                    console.warn('Integrated interface failed, using fallback:', error);
                                    useFallback();
                                });
                            } else {
                                console.log('‚ö†Ô∏è Integrated interface not available, using fallback');
                                useFallback();
                            }
                        } catch (error) {
                            console.error('Error with integrated interface:', error);
                            useFallback();
                        }
                    }, 500);
                    
                    function useFallback() {
                        if (typeof window.renderPembayaranHutangPiutang === 'function') {
                            console.log('‚úÖ Using manual payment fallback');
                            window.renderPembayaranHutangPiutang();
                        } else {
                            console.error('‚ùå No fallback available');
                            showErrorInterface();
                        }
                    }
                    
                    function showErrorInterface() {
                        content.innerHTML = `
                            <div class="container-fluid py-4">
                                <div class="alert alert-warning">
                                    <h4><i class="bi bi-exclamation-triangle"></i> Interface Loading Issue</h4>
                                    <p>Sedang memuat interface pembayaran. Jika masalah berlanjut, silakan refresh halaman.</p>
                                    <div class="mt-3">
                                        <button class="btn btn-primary" onclick="location.reload()">
                                            <i class="bi bi-arrow-clockwise"></i> Refresh Halaman
                                        </button>
                                        <button class="btn btn-secondary ms-2" onclick="window.renderPembayaranHutangPiutangIntegrated()">
                                            <i class="bi bi-arrow-repeat"></i> Coba Lagi
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                };
                
                // Fix 2: Ensure navigation routing works
                if (typeof window.renderPage === 'function') {
                    const originalRenderPage = window.renderPage;
                    window.renderPage = function(page) {
                        if (page === 'pembayaran-hutang-piutang-integrated') {
                            console.log('üîÑ Routing to integrated payment');
                            window.renderPembayaranHutangPiutangIntegrated();
                        } else {
                            originalRenderPage(page);
                        }
                    };
                }
                
                // Fix 3: Ensure navigateTo works
                if (typeof window.navigateTo === 'function') {
                    const originalNavigateTo = window.navigateTo;
                    window.navigateTo = function(page) {
                        if (page === 'pembayaran-hutang-piutang-integrated') {
                            console.log('üîÑ Navigating to integrated payment');
                            window.renderPembayaranHutangPiutangIntegrated();
                        } else {
                            originalNavigateTo(page);
                        }
                    };
                }
                
                updateStatus('‚úÖ Perbaikan berhasil diterapkan! Menu sekarang dapat diakses.', 'success');
                document.getElementById('testBtn').disabled = false;
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`, 'error');
                console.error('Fix error:', error);
            }
        }
        
        function testMenu() {
            updateStatus('üß™ Testing menu access...', 'info');
            
            try {
                // Test the function
                if (typeof window.renderPembayaranHutangPiutangIntegrated === 'function') {
                    window.renderPembayaranHutangPiutangIntegrated();
                    updateStatus('‚úÖ Menu test berhasil! Interface telah dimuat.', 'success');
                } else {
                    updateStatus('‚ùå Function tidak ditemukan setelah fix', 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå Test error: ${error.message}`, 'error');
            }
        }
        
        // Auto-apply fix if needed
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.renderPembayaranHutangPiutangIntegrated !== 'function') {
                updateStatus('‚ö†Ô∏è Menu function tidak ditemukan. Menerapkan fix otomatis...', 'warning');
                setTimeout(applyInstantFix, 1000);
            } else {
                updateStatus('‚úÖ Menu function sudah tersedia.', 'success');
                document.getElementById('testBtn').disabled = false;
            }
        });
    </script>
</body>
</html>