<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Syntax Errors - Comprehensive Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 50%, #52b788 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .fix-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .error-card {
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #fff5f5;
        }
        .success-card {
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #f8fff9;
        }
        .warning-card {
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #fffdf5;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .log-info { color: #0c5460; }
        .log-success { color: #155724; background-color: #d4edda; }
        .log-error { color: #721c24; background-color: #f8d7da; }
        .log-warning { color: #856404; background-color: #fff3cd; }
        .script-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-loading { background: #ffc107; color: #000; }
        .status-success { background: #28a745; color: #fff; }
        .status-error { background: #dc3545; color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="fix-container">
            <div class="text-center mb-4">
                <h1 style="color: #2d6a4f;">
                    <i class="bi bi-bug-fill me-3"></i>JavaScript Syntax Error Fix
                </h1>
                <p class="lead">Comprehensive test for JavaScript syntax error resolution</p>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="error-card">
                        <h4><i class="bi bi-exclamation-triangle me-2"></i>Identified Errors</h4>
                        <ul>
                            <li><strong>Duplicate currentUser declaration:</strong> Both js/app.js and js/auth.js declared the same variable</li>
                            <li><strong>ES6 export syntax error:</strong> js/pembayaranHutangPiutang.js used export syntax in non-module context</li>
                            <li><strong>Missing favicon:</strong> 404 error for favicon.ico (minor issue)</li>
                        </ul>
                    </div>

                    <div class="success-card">
                        <h4><i class="bi bi-check-circle me-2"></i>Applied Fixes</h4>
                        <ul>
                            <li>✅ Removed duplicate currentUser declaration from js/auth.js</li>
                            <li>✅ Replaced ES6 export with conditional module export in js/pembayaranHutangPiutang.js</li>
                            <li>✅ Added proper comments explaining the changes</li>
                        </ul>
                    </div>

                    <div class="warning-card">
                        <h4><i class="bi bi-gear me-2"></i>Test Controls</h4>
                        <button class="btn btn-primary me-2" onclick="testScriptLoading()">
                            <i class="bi bi-play-circle me-1"></i>Test Script Loading
                        </button>
                        <button class="btn btn-info me-2" onclick="testVariableDeclarations()">
                            <i class="bi bi-search me-1"></i>Test Variables
                        </button>
                        <button class="btn btn-success me-2" onclick="testFunctionality()">
                            <i class="bi bi-check-square me-1"></i>Test Functionality
                        </button>
                        <button class="btn btn-secondary" onclick="clearLog()">
                            <i class="bi bi-trash me-1"></i>Clear Log
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-list-check me-2"></i>Script Loading Status</h5>
                        </div>
                        <div class="card-body">
                            <div id="scriptStatus">
                                <div class="mb-2">
                                    <span class="script-status status-loading">js/utils.js</span>
                                    <span class="script-status status-loading">js/app.js</span>
                                    <span class="script-status status-loading">js/auth.js</span>
                                    <span class="script-status status-loading">js/pembayaranHutangPiutang.js</span>
                                </div>
                                <small class="text-muted">Click "Test Script Loading" to check status</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-terminal me-2"></i>Test Log
                        </div>
                        <div class="card-body p-0">
                            <div id="testLog" class="log-area">
                                <div class="log-info">Ready to test syntax fixes...</div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-sm btn-secondary" onclick="clearLog()">
                                <i class="bi bi-trash me-1"></i>Clear Log
                            </button>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-header bg-info text-white">
                            <i class="bi bi-info-circle me-2"></i>Error Details
                        </div>
                        <div class="card-body">
                            <h6>Original Errors:</h6>
                            <div class="small">
                                <code>Uncaught SyntaxError: Identifier 'currentUser' has already been declared</code>
                            </div>
                            <div class="small mt-2">
                                <code>Uncaught SyntaxError: Unexpected token 'export'</code>
                            </div>
                            
                            <h6 class="mt-3">Root Causes:</h6>
                            <ul class="small">
                                <li>Global variable conflicts between files</li>
                                <li>ES6 module syntax in non-module context</li>
                                <li>Script loading order issues</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Test script loading -->
    <script>
        let testLog = document.getElementById('testLog');
        let scriptErrors = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            testLog.appendChild(logEntry);
            testLog.scrollTop = testLog.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            testLog.innerHTML = '<div class="log-info">Log cleared...</div>';
        }
        
        function updateScriptStatus(scriptName, status) {
            const statusArea = document.getElementById('scriptStatus');
            const statusElements = statusArea.querySelectorAll('.script-status');
            
            statusElements.forEach(el => {
                if (el.textContent === scriptName) {
                    el.className = `script-status status-${status}`;
                }
            });
        }
        
        function testScriptLoading() {
            log('Testing script loading...', 'info');
            
            const scripts = [
                'js/utils.js',
                'js/app.js', 
                'js/auth.js',
                'js/pembayaranHutangPiutang.js'
            ];
            
            scripts.forEach(scriptPath => {
                const script = document.createElement('script');
                script.src = scriptPath;
                
                script.onload = function() {
                    log(`✓ ${scriptPath} loaded successfully`, 'success');
                    updateScriptStatus(scriptPath, 'success');
                };
                
                script.onerror = function() {
                    log(`✗ ${scriptPath} failed to load`, 'error');
                    updateScriptStatus(scriptPath, 'error');
                    scriptErrors.push(scriptPath);
                };
                
                // Don't actually append to avoid conflicts, just test the loading
                // document.head.appendChild(script);
                
                // Simulate loading test
                setTimeout(() => {
                    // Check if script would cause syntax errors
                    fetch(scriptPath)
                        .then(response => response.text())
                        .then(content => {
                            // Basic syntax checks
                            if (content.includes('let currentUser') && scriptPath === 'js/auth.js') {
                                log(`⚠ ${scriptPath} may have currentUser conflict`, 'warning');
                                updateScriptStatus(scriptPath, 'error');
                            } else if (content.includes('export {') && !content.includes('typeof module')) {
                                log(`⚠ ${scriptPath} may have ES6 export syntax error`, 'warning');
                                updateScriptStatus(scriptPath, 'error');
                            } else {
                                log(`✓ ${scriptPath} syntax appears clean`, 'success');
                                updateScriptStatus(scriptPath, 'success');
                            }
                        })
                        .catch(error => {
                            log(`✗ ${scriptPath} not found or inaccessible`, 'error');
                            updateScriptStatus(scriptPath, 'error');
                        });
                }, 100 * (scripts.indexOf(scriptPath) + 1));
            });
        }
        
        function testVariableDeclarations() {
            log('Testing variable declarations...', 'info');
            
            // Test currentUser availability
            if (typeof window.currentUser !== 'undefined') {
                log('✓ currentUser is available globally', 'success');
            } else {
                log('⚠ currentUser not found in global scope', 'warning');
            }
            
            // Test for duplicate declarations (would cause syntax error)
            try {
                // This would fail if there are duplicate declarations
                eval('var testVar = "test";');
                log('✓ Variable declaration test passed', 'success');
            } catch (error) {
                log('✗ Variable declaration test failed: ' + error.message, 'error');
            }
            
            // Test module exports
            if (typeof window.PembayaranHutangPiutangModule !== 'undefined') {
                log('✓ PembayaranHutangPiutangModule is available', 'success');
            } else {
                log('⚠ PembayaranHutangPiutangModule not found', 'warning');
            }
        }
        
        function testFunctionality() {
            log('Testing core functionality...', 'info');
            
            // Test authentication functions
            const authFunctions = ['handleLogin', 'showMainApp', 'navigateTo'];
            authFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`✓ Function ${funcName} is available`, 'success');
                } else {
                    log(`✗ Function ${funcName} not found`, 'error');
                }
            });
            
            // Test if we can create a user without conflicts
            try {
                const testUser = { id: 1, name: 'Test User', role: 'admin' };
                if (typeof window.currentUser !== 'undefined') {
                    window.currentUser = testUser;
                    log('✓ currentUser assignment successful', 'success');
                } else {
                    log('⚠ currentUser not available for assignment', 'warning');
                }
            } catch (error) {
                log('✗ currentUser assignment failed: ' + error.message, 'error');
            }
            
            log('Functionality test completed', 'info');
        }
        
        // Capture any JavaScript errors
        window.addEventListener('error', function(event) {
            log(`JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}`, 'error');
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('Syntax error fix test page loaded', 'success');
            log('Click "Test Script Loading" to verify fixes', 'info');
        });
    </script>
</body>
</html>